!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sdk_core={})}(this,(function(e){"use strict";const t=parseInt("1.2.7+291".split("+").pop(),10)||0;function i(){return"hyprmx.com"}function r(){return"/v1/initialization"}function s(){return 3600}function n(e){return null==e||"string"==typeof e&&0===e.trim().length}function o(e,t){return"string"==typeof e&&"string"==typeof t&&e.toUpperCase()===t.toUpperCase()}function a(e){return new RegExp(/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-/]))?/).test(e)}function l(e){return JSON.parse(JSON.stringify(e))}globalThis.version=function(){return t};const d=e=>e&&"object"==typeof e&&!Array.isArray(e),c=(e,...t)=>{if(!t.length)return e;const i=t.shift();if(d(e)&&d(i))for(const t in i)d(i[t])?(e[t]||Object.assign(e,{[t]:{}}),c(e[t],i[t])):Object.assign(e,{[t]:i[t]});return c(e,...t)};globalThis.HYPREventController=void 0,globalThis.HYPRRequestParameterManager=void 0,globalThis.HYPRBiddingController=void 0,globalThis.HYPRPlacementController=void 0,globalThis.HYPRAudioEventPublisher=void 0;const h="persistent_id",u="ad_id_opted_out";globalThis.defaultUIComponents={};const p="mraid",g="web_traffic",m="banner",f="display",b="vpaid",_="next_button_text",v="finish_button_text",w="title_text",y="countdown_text",P=["http","https","about","file","data"],A="text/html",S="utf-8",T={CONSENT_STATUS_UNKNOWN:0,CONSENT_GIVEN:1,CONSENT_DECLINED:2},C={COMPLETED:"COMPLETED",PAYOUT_COMPLETE:"PAYOUT_COMPLETE",BACKGROUNDED:"BACKGROUNDED",IN_PROGRESS:"IN_PROGRESS"},E={BACK_PRESS:"BACK_PRESS",PRESENT_DIALOG_OK:"PRESENT_DIALOG_OK",ERROR_DIALOG_OK:"ERROR_DIALOG_OK",CANCELLATION_DIALOG_OK:"CANCELLATION_DIALOG_OK",ABORT:"ABORT",NATIVE_CLOSE_BUTTON:"NATIVE_CLOSE_BUTTON",COMPLETE_NO_THANK_YOU:"COMPLETE_NO_THANK_YOU",MRAID_CLOSE:"MRAID_CLOSE",CLOSE_AD:"CLOSE_AD",CRASHED:"CRASHED",WEBVIEW_CRASH:"WEBVIEW_CRASH",UNKNOWN:"UNKNOWN"};globalThis.PRESENTATION_STATES={BROWSER:"presentingHyprMXBrowser",OUTSIDE_APP:"presentingDeepLinkOutsideApplication",APP_STORE:"presentingAppStoreOverlay"};const R={TOKEN:"token",USER_ID:"uid",VIEWING_ID:"viewing_id",REWARD_TOKEN:"reward_token",DISTRIBUTOR_ID:"distributor_id",DURATION:"duration"},k={LOADED:"loaded",TIMED_OUT:"timed_out"};globalThis.COMPLETION_URL="",globalThis.DURATION_URL="",globalThis.AVAILABLE_FOR=3600,globalThis.IS_IOS=!0;class x{constructor(e,t,i,r){this.followRedirect=e,this.readTimeout=t,this.connectionTimeout=i,this.headers=r}}const N="application/json",O=`${N};charset=UTF-8`,I=6e4,M=6e4,V={"Content-Type":O},D=new x(!0,I,M,V),F=new x(!0,2e4,2e4,V),B=new x(!0,I,M,{}),U=["app_bound_domains"];class ${static compact(e){const t=JSON.parse(JSON.stringify(e));$.compactHelper(t);for(const i of U)void 0!==e[i]&&(t[i]=e[i]);return t}static compactHelper(e){null!=e&&(this.compactJsonArray(e),Object.keys(e).forEach((t=>{(this.isObject(e[t])||Array.isArray(e[t]))&&this.compactHelper(e[t]),this.isEmpty(e[t])&&delete e[t]})))}static compactJsonArray(e){if(Array.isArray(e)){e.forEach((e=>this.compactHelper(e)));for(let t=Object.keys(e).length-1;t>=0;t-=1)this.isEmpty(e[t])&&e.splice(t,1)}}static isEmpty(e){return!!(null==e||Array.isArray(e)&&0===e.length||this.isObject(e)&&0===Object.keys(e).length||""===e)}static isObject(e){return"[object Object]"===Object.prototype.toString.call(e)}}const L="__CANCELLED__";class W{constructor(){this._rejection=void 0,this.abortHandler=()=>{}}set reject(e){this._rejection=()=>{this.abortHandler(),e(L)}}cancel(){void 0!==this._rejection?this._rejection():console.error("no reject handler set")}}const q="GET",z="POST",H="PATCH",J="PUT",Y=".a.hyprmx.",j="jungroup-pbs.relevant-digital.com";class K{constructor(e=globalThis.HYPRRequestParamListener){this.requestMap=new Map,this.requestId=0,this.nativeParams=e}transform(e,t=[Y,j],i=this.nativeParams?.getPlatform()){if("iOS"===i&&!0===this.nativeParams.getAdIdOptedOut())for(const i of t)if(e.includes(i)){if(i===Y)return e.replace(Y,".b.hyprmx.");if(i===j)return e.replace(j,"jungroup-pbs-nt.relevant-digital.com")}return e}request(e,t,i,r,s=(()=>{})){const n=this.transform(e),o=this.requestId.toString();return this.prettyLogEvent(!0,o,n,JSON.parse(t||"{}")),this.requestId+=1,HYPRNativeNetworkController.request(o,n,t,i,JSON.stringify(r),"HYPRNetworkController.onNetworkResponse"),this.requestMap[o]=s,o}get(e,t=(()=>{}),i=B){return this.request(e,void 0,q,i,t)}async getAsync(e,t=B){return await new Promise((i=>{this.get(e,((e,t,r,s)=>{i({response:e,body:t,error:r,headers:s})}),t)}))}post(e,t,i=(()=>{}),r=!0,s=D){let n;return n=r?JSON.stringify($.compact(t)):JSON.stringify(t),this.request(e,n,z,s,i)}async postAsync(e,t,i=D){const{promise:r}=this.cancellableAsyncPost(e,t,i);return await r}cancellableAsyncPost(e,t,i=D){const r=new W;return{promise:new Promise(((s,n)=>{r.reject=n;const o=this.post(e,t,((e,t,i,r)=>{s({response:e,body:t,error:i,headers:r})}),!0,i);r.abortHandler=()=>{this.abortRequest(o)}})),canceller:r}}put(e,t,i=(()=>{}),r=!0,s=D){let n;return n=r?JSON.stringify($.compact(t)):JSON.stringify(t),this.request(e,n,J,s,i)}abortRequest(e){console.debug(`Network request aborted for ${e}`),HYPRNativeNetworkController.abortRequest(e),this.requestMap[e]=null}onNetworkResponse(e,t){K.validJSONType(t.headers)?this.prettyLogEvent(!1,e,"",JSON.parse(t.body||"{}"),t.headers):console.debug(`Network response received for id: ${e}`);const i=this.requestMap[e];this.requestMap[e]=null,"function"==typeof i&&i(t.code,t.body,t.error,t.headers)}prettyLogEvent(e,t,i,r={},s=void 0){const n=JSON.stringify(r,null,2);let o="";"object"==typeof s&&(o=`\nHeaders: ${JSON.stringify(s,null,2)}`);const a=e?`URL: ${i}`:"";console.debug(`\n\nNetwork ${e?"Request":"Response"}: ${t}\n${a}\n Body:\n${n}${o}\n`)}static validResponseStatus(e){return!(e>=400||0===e)}static validXMLType(e){return void 0!==e&&"string"==typeof e["Content-Type"]&&e["Content-Type"].includes("application/xml")}static validHtmlType(e){return void 0!==e&&"string"==typeof e["Content-Type"]&&e["Content-Type"].includes("text/html")}static validJSONType(e){return void 0!==e&&"string"==typeof e["Content-Type"]&&e["Content-Type"].includes("application/json")}static validateResponseBody(e){if(void 0===e)return"Response data not parseable."}}function G(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Z,X={exports:{}},Q=X.exports;
/*!
   * validate.js 0.13.1
   * http://validatejs.org/
   * (c) 2013-2015 Nicklas Ansman, 2013 Wrapp
   * validate.js may be freely distributed under the MIT license.
  */var ee=(Z||(Z=1,function(e,t){(function(e,t,i){var r=function(e,t,i){i=s.extend({},s.options,i);var n=s.runValidations(e,t,i);if(n.some((function(e){return s.isPromise(e.error)})))throw new Error("Use validate.async if you want support for promises");return r.processValidationResults(n,i)},s=r;s.extend=function(e){return[].slice.call(arguments,1).forEach((function(t){for(var i in t)e[i]=t[i]})),e},s.extend(r,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var e=s.format("%{major}.%{minor}.%{patch}",s.version);return s.isEmpty(s.version.metadata)||(e+="+"+s.version.metadata),e}},Promise:"undefined"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(e,t,i){var r,n,o,a,l,d,c,h=[];for(r in(s.isDomElement(e)||s.isJqueryElement(e))&&(e=s.collectFormValues(e)),t)for(n in o=s.getDeepObjectValue(e,r),a=s.result(t[r],o,e,r,i,t)){if(!(l=s.validators[n]))throw c=s.format("Unknown validator %{name}",{name:n}),new Error(c);d=a[n],(d=s.result(d,o,e,r,i,t))&&h.push({attribute:r,value:o,validator:n,globalOptions:i,attributes:e,options:d,error:l.call(l,o,d,r,e,i)})}return h},processValidationResults:function(e,t){e=s.pruneEmptyErrors(e,t),e=s.expandMultipleErrors(e,t),e=s.convertErrorMessages(e,t);var i=t.format||"grouped";if("function"!=typeof s.formatters[i])throw new Error(s.format("Unknown format %{format}",t));return e=s.formatters[i](e),s.isEmpty(e)?void 0:e},async:function(e,t,i){var r=(i=s.extend({},s.async.options,i)).wrapErrors||function(e){return e};!1!==i.cleanAttributes&&(e=s.cleanAttributes(e,t));var n=s.runValidations(e,t,i);return new s.Promise((function(o,a){s.waitForResults(n).then((function(){var l=s.processValidationResults(n,i);l?a(new r(l,i,e,t)):o(e)}),(function(e){a(e)}))}))},single:function(e,t,i){return i=s.extend({},s.single.options,i,{format:"flat",fullMessages:!1}),s({single:e},{single:t},i)},waitForResults:function(e){return e.reduce((function(e,t){return s.isPromise(t.error)?e.then((function(){return t.error.then((function(e){t.error=e||null}))})):e}),new s.Promise((function(e){e()})))},result:function(e){var t=[].slice.call(arguments,1);return"function"==typeof e&&(e=e.apply(null,t)),e},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},isFunction:function(e){return"function"==typeof e},isInteger:function(e){return s.isNumber(e)&&e%1==0},isBoolean:function(e){return"boolean"==typeof e},isObject:function(e){return e===Object(e)},isDate:function(e){return e instanceof Date},isDefined:function(e){return null!=e},isPromise:function(e){return!!e&&s.isFunction(e.then)},isJqueryElement:function(e){return e&&s.isString(e.jquery)},isDomElement:function(e){return!!e&&!(!e.querySelectorAll||!e.querySelector)&&(!(!s.isObject(document)||e!==document)||("object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName))},isEmpty:function(e){var t;if(!s.isDefined(e))return!0;if(s.isFunction(e))return!1;if(s.isString(e))return s.EMPTY_STRING_REGEXP.test(e);if(s.isArray(e))return 0===e.length;if(s.isDate(e))return!1;if(s.isObject(e)){for(t in e)return!1;return!0}return!1},format:s.extend((function(e,t){return s.isString(e)?e.replace(s.format.FORMAT_REGEXP,(function(e,i,r){return"%"===i?"%{"+r+"}":String(t[r])})):e}),{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(e){return s.isNumber(e)?100*e%1==0?""+e:parseFloat(Math.round(100*e)/100).toFixed(2):s.isArray(e)?e.map((function(e){return s.prettify(e)})).join(", "):s.isObject(e)?s.isDefined(e.toString)?e.toString():JSON.stringify(e):(e=""+e).replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,(function(e,t,i){return t+" "+i.toLowerCase()})).toLowerCase()},stringifyValue:function(e,t){return(t&&t.prettify||s.prettify)(e)},isString:function(e){return"string"==typeof e},isArray:function(e){return"[object Array]"==={}.toString.call(e)},isHash:function(e){return s.isObject(e)&&!s.isArray(e)&&!s.isFunction(e)},contains:function(e,t){return!!s.isDefined(e)&&(s.isArray(e)?-1!==e.indexOf(t):t in e)},unique:function(e){return s.isArray(e)?e.filter((function(e,t,i){return i.indexOf(e)==t})):e},forEachKeyInKeypath:function(e,t,i){if(s.isString(t)){var r,n="",o=!1;for(r=0;r<t.length;++r)switch(t[r]){case".":o?(o=!1,n+="."):(e=i(e,n,!1),n="");break;case"\\":o?(o=!1,n+="\\"):o=!0;break;default:o=!1,n+=t[r]}return i(e,n,!0)}},getDeepObjectValue:function(e,t){if(s.isObject(e))return s.forEachKeyInKeypath(e,t,(function(e,t){if(s.isObject(e))return e[t]}))},collectFormValues:function(e,t){var i,r,n,o,a,l,d={};if(s.isJqueryElement(e)&&(e=e[0]),!e)return d;for(t=t||{},o=e.querySelectorAll("input[name], textarea[name]"),i=0;i<o.length;++i)if(n=o.item(i),!s.isDefined(n.getAttribute("data-ignored"))){var c=n.name.replace(/\./g,"\\\\.");l=s.sanitizeFormValue(n.value,t),"number"===n.type?l=l?+l:null:"checkbox"===n.type?n.attributes.value?n.checked||(l=d[c]||null):l=n.checked:"radio"===n.type&&(n.checked||(l=d[c]||null)),d[c]=l}for(o=e.querySelectorAll("select[name]"),i=0;i<o.length;++i)if(n=o.item(i),!s.isDefined(n.getAttribute("data-ignored"))){if(n.multiple)for(r in l=[],n.options)(a=n.options[r])&&a.selected&&l.push(s.sanitizeFormValue(a.value,t));else{var h=void 0!==n.options[n.selectedIndex]?n.options[n.selectedIndex].value:"";l=s.sanitizeFormValue(h,t)}d[n.name]=l}return d},sanitizeFormValue:function(e,t){return t.trim&&s.isString(e)&&(e=e.trim()),!1!==t.nullify&&""===e?null:e},capitalize:function(e){return s.isString(e)?e[0].toUpperCase()+e.slice(1):e},pruneEmptyErrors:function(e){return e.filter((function(e){return!s.isEmpty(e.error)}))},expandMultipleErrors:function(e){var t=[];return e.forEach((function(e){s.isArray(e.error)?e.error.forEach((function(i){t.push(s.extend({},e,{error:i}))})):t.push(e)})),t},convertErrorMessages:function(e,t){var i=[],r=(t=t||{}).prettify||s.prettify;return e.forEach((function(e){var n=s.result(e.error,e.value,e.attribute,e.options,e.attributes,e.globalOptions);return s.isString(n)?("^"===n[0]?n=n.slice(1):!1!==t.fullMessages&&(n=s.capitalize(r(e.attribute))+" "+n),n=n.replace(/\\\^/g,"^"),n=s.format(n,{value:s.stringifyValue(e.value,t)}),void i.push(s.extend({},e,{error:n}))):void i.push(e)})),i},groupErrorsByAttribute:function(e){var t={};return e.forEach((function(e){var i=t[e.attribute];i?i.push(e):t[e.attribute]=[e]})),t},flattenErrorsToArray:function(e){return e.map((function(e){return e.error})).filter((function(e,t,i){return i.indexOf(e)===t}))},cleanAttributes:function(e,t){function i(e,t,i){return s.isObject(e[t])?e[t]:e[t]=!!i||{}}return s.isObject(t)&&s.isObject(e)?(t=function(e){var t,r={};for(t in e)e[t]&&s.forEachKeyInKeypath(r,t,i);return r}(t),function e(t,i){if(!s.isObject(t))return t;var r,n,o=s.extend({},t);for(n in t)r=i[n],s.isObject(r)?o[n]=e(o[n],r):r||delete o[n];return o}(e,t)):{}},exposeModule:function(e,t,i,r,s){i?(r&&r.exports&&(i=r.exports=e),i.validate=e):(t.validate=e,e.isFunction(s)&&s.amd&&s([],(function(){return e})))},warn:function(e){"undefined"!=typeof console&&console.warn&&console.warn("[validate.js] "+e)},error:function(e){"undefined"!=typeof console&&console.error&&console.error("[validate.js] "+e)}}),r.validators={presence:function(e,t){if(!1!==(t=s.extend({},this.options,t)).allowEmpty?!s.isDefined(e):s.isEmpty(e))return t.message||this.message||"can't be blank"},length:function(e,t,i){if(s.isDefined(e)){var r,n=(t=s.extend({},this.options,t)).is,o=t.maximum,a=t.minimum,l=t.tokenizer||function(e){return e},d=[],c=(e=l(e)).length;return s.isNumber(c)?(s.isNumber(n)&&c!==n&&(r=t.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",d.push(s.format(r,{count:n}))),s.isNumber(a)&&c<a&&(r=t.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",d.push(s.format(r,{count:a}))),s.isNumber(o)&&c>o&&(r=t.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",d.push(s.format(r,{count:o}))),d.length>0?t.message||d:void 0):t.message||this.notValid||"has an incorrect length"}},numericality:function(e,t,i,r,n){if(s.isDefined(e)){var o,a,l=[],d={greaterThan:function(e,t){return e>t},greaterThanOrEqualTo:function(e,t){return e>=t},equalTo:function(e,t){return e===t},lessThan:function(e,t){return e<t},lessThanOrEqualTo:function(e,t){return e<=t},divisibleBy:function(e,t){return e%t==0}},c=(t=s.extend({},this.options,t)).prettify||n&&n.prettify||s.prettify;if(s.isString(e)&&t.strict){var h="^-?(0|[1-9]\\d*)";if(t.onlyInteger||(h+="(\\.\\d+)?"),h+="$",!new RegExp(h).test(e))return t.message||t.notValid||this.notValid||this.message||"must be a valid number"}if(!0!==t.noStrings&&s.isString(e)&&!s.isEmpty(e)&&(e=+e),!s.isNumber(e))return t.message||t.notValid||this.notValid||this.message||"is not a number";if(t.onlyInteger&&!s.isInteger(e))return t.message||t.notInteger||this.notInteger||this.message||"must be an integer";for(o in d)if(a=t[o],s.isNumber(a)&&!d[o](e,a)){var u="not"+s.capitalize(o),p=t[u]||this[u]||this.message||"must be %{type} %{count}";l.push(s.format(p,{count:a,type:c(o)}))}return t.odd&&e%2!=1&&l.push(t.notOdd||this.notOdd||this.message||"must be odd"),t.even&&e%2!=0&&l.push(t.notEven||this.notEven||this.message||"must be even"),l.length?t.message||l:void 0}},datetime:s.extend((function(e,t){if(!s.isFunction(this.parse)||!s.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(s.isDefined(e)){var i,r=[],n=(t=s.extend({},this.options,t)).earliest?this.parse(t.earliest,t):NaN,o=t.latest?this.parse(t.latest,t):NaN;return e=this.parse(e,t),isNaN(e)||t.dateOnly&&e%864e5!=0?(i=t.notValid||t.message||this.notValid||"must be a valid date",s.format(i,{value:arguments[0]})):(!isNaN(n)&&e<n&&(i=t.tooEarly||t.message||this.tooEarly||"must be no earlier than %{date}",i=s.format(i,{value:this.format(e,t),date:this.format(n,t)}),r.push(i)),!isNaN(o)&&e>o&&(i=t.tooLate||t.message||this.tooLate||"must be no later than %{date}",i=s.format(i,{date:this.format(o,t),value:this.format(e,t)}),r.push(i)),r.length?s.unique(r):void 0)}}),{parse:null,format:null}),date:function(e,t){return t=s.extend({},t,{dateOnly:!0}),s.validators.datetime.call(s.validators.datetime,e,t)},format:function(e,t){(s.isString(t)||t instanceof RegExp)&&(t={pattern:t});var i,r=(t=s.extend({},this.options,t)).message||this.message||"is invalid",n=t.pattern;if(s.isDefined(e))return s.isString(e)?(s.isString(n)&&(n=new RegExp(t.pattern,t.flags)),(i=n.exec(e))&&i[0].length==e.length?void 0:r):r},inclusion:function(e,t){if(s.isDefined(e)&&(s.isArray(t)&&(t={within:t}),t=s.extend({},this.options,t),!s.contains(t.within,e))){var i=t.message||this.message||"^%{value} is not included in the list";return s.format(i,{value:e})}},exclusion:function(e,t){if(s.isDefined(e)&&(s.isArray(t)&&(t={within:t}),t=s.extend({},this.options,t),s.contains(t.within,e))){var i=t.message||this.message||"^%{value} is restricted";return s.isString(t.within[e])&&(e=t.within[e]),s.format(i,{value:e})}},email:s.extend((function(e,t){var i=(t=s.extend({},this.options,t)).message||this.message||"is not a valid email";if(s.isDefined(e))return s.isString(e)&&this.PATTERN.exec(e)?void 0:i}),{PATTERN:/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(e,t,i,r,n){if(s.isDefined(e)){s.isString(t)&&(t={attribute:t});var o=(t=s.extend({},this.options,t)).message||this.message||"is not equal to %{attribute}";if(s.isEmpty(t.attribute)||!s.isString(t.attribute))throw new Error("The attribute must be a non empty string");var a=s.getDeepObjectValue(r,t.attribute),l=t.comparator||function(e,t){return e===t},d=t.prettify||n&&n.prettify||s.prettify;return l(e,a,t,i,r)?void 0:s.format(o,{attribute:d(t.attribute)})}},url:function(e,t){if(s.isDefined(e)){var i=(t=s.extend({},this.options,t)).message||this.message||"is not a valid url",r=t.schemes||this.schemes||["http","https"],n=t.allowLocal||this.allowLocal||!1,o=t.allowDataUrl||this.allowDataUrl||!1;if(!s.isString(e))return i;var a="^(?:(?:"+r.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",l="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";return n?l+="?":a+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",a+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+l+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",o&&(a="(?:"+a+")|(?:^data:(?:\\w+\\/[-+.\\w]+(?:;[\\w=]+)*)?(?:;base64)?,[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*$)"),new RegExp(a,"i").exec(e)?void 0:i}},type:s.extend((function(e,t,i,r,n){if(s.isString(t)&&(t={type:t}),s.isDefined(e)){var o,a=s.extend({},this.options,t),l=a.type;if(!s.isDefined(l))throw new Error("No type was specified");if(o=s.isFunction(l)?l:this.types[l],!s.isFunction(o))throw new Error("validate.validators.type.types."+l+" must be a function.");if(!o(e,a,i,r,n)){var d=t.message||this.messages[l]||this.message||a.message||(s.isFunction(l)?"must be of the correct type":"must be of type %{type}");return s.isFunction(d)&&(d=d(e,t,i,r,n)),s.format(d,{attribute:s.prettify(i),type:l})}}}),{types:{object:function(e){return s.isObject(e)&&!s.isArray(e)},array:s.isArray,integer:s.isInteger,number:s.isNumber,string:s.isString,date:s.isDate,boolean:s.isBoolean},messages:{}})},r.formatters={detailed:function(e){return e},flat:s.flattenErrorsToArray,grouped:function(e){var t;for(t in e=s.groupErrorsByAttribute(e))e[t]=s.flattenErrorsToArray(e[t]);return e},constraint:function(e){var t;for(t in e=s.groupErrorsByAttribute(e))e[t]=e[t].map((function(e){return e.validator})).sort();return e}},r.exposeModule(r,this,e,t,i)}).call(Q,t,e,null)}(X,X.exports)),X.exports),te=G(ee);const ie=/:\d+(?=\/|$)/,re=/^http[s]?:\/\//;class se{static parseJSON(e){let t;try{t=JSON.parse(e)}catch(t){console.error(`Error parsing json string (${e}) with error ${t}`)}return t}static hasRequiredKeys(e={},t=[],i="string"){let r;r="url"===i?e=>se.urlValidation(e):e=>se.typeValidation(e,i);for(const i of t)if(void 0===e[i]||!r(e[i]))return!1;return!0}static typeValidation(e,t){return typeof e===t}static urlValidation(e,t=["https","http"]){const i=function(e){const t=e.match(ie);return t?e.replace(t[0],""):e}(e);return!te({website:i},{website:{url:{schemes:t,allowLocal:!0,allowDataUrl:!0}}})||(console.error(`[RP] URL Validation Failed for ${e}`),!1)}}class ne{constructor(e,t,i,r,s,n,o,a,l=globalThis.HYPRNetworkController,d=HYPRRequestParameterManager){this.adImpressionTrackingUrl=e,this.userInfoTrackingUrl=t,this.webTrafficVisitUrl=i,this.noAdTrackingUrl=n,this.networkRequestController=l,this.errorReportingURL=r,this.errorSeverityLevel=s,this.adProgressUrl=o,this.durationTrackingUrl=a,this.requestParameterManager=d,this.webTrafficVisitInfo={}}sendAdProgressTracking(e,t){void 0!==e&&void 0!==this.adProgressUrl&&this.networkRequestController.post(this.adProgressUrl,JSON.parse(e),t)}async sendWebTrafficVisitEvent(e,t,i){const r={};r.url=e,r.viewing_id=t,r.wtu_id=i;const{code:s,body:n,error:o}=await this.networkRequestController.postAsync(this.webTrafficVisitUrl,r),a=se.parseJSON(n);void 0===o&&K.validResponseStatus(s)&&void 0!==a&&void 0!==a.id?this.recordWebTrafficVisitInfo(e,a.id):console.error(`[EC] sendWebTrafficVisitEvent error received: ${o}`)}recordWebTrafficVisitInfo(e,t){this.webTrafficVisitInfo[e]=t}sendWebTrafficTimeSpent(e,t){const i=this.webTrafficVisitInfo[e];if(void 0===i)return void console.error("[EC] Cannot find id for WTTS");const r=`${this.webTrafficVisitUrl}/${i}`;this.networkRequestController.request(r,t,H,D)}sendNoAdTracking(e){this.sendTrackingEventWithParams(e,this.noAdTrackingUrl)}sendAdImpressionTrackingEvent(e,t){this.sendTrackingEventWithParams(e,this.adImpressionTrackingUrl,t)}sendUserInfoTrackingEvent(e,t,i){this.sendTrackingEventWithParams(e,this.userInfoTrackingUrl,i,ne.extractPrequalQuestionNames(t))}sendPixelTrackingEvents(e=[]){for(const t of e)console.debug(`[EC] firing impression url: ${t}`),this.networkRequestController.get(t)}static extractPrequalQuestionNames(e){return{questions_shown:JSON.parse(e).map((e=>e.Name))}}sendTrackingEventWithParams(e,t,i,r){const s=void 0!==i?i.getAdIdentifier():"",n=void 0!==i?i.getAdType():e.getAdType();let o={placement_id:e.id,offer_identifier:s,offer_type:n};console.debug(`[EC] Requesting additional trackings params for: ${JSON.stringify(o)}`);const a=this.requestParameterManager.getTrackingParams();Object.assign(o,a),void 0!==r&&(o=Object.assign(o,r)),console.debug(`[EC] Sending trackings to ${t}`),this.networkRequestController.post(t,o)}sendDurationUpdateTracking(e,t,i){const r={};r[R.DURATION]=t,r.distributorid=this.requestParameterManager.getDistributorID(),r[R.USER_ID]=this.requestParameterManager.getUserId(),r[R.TOKEN]=e,this.networkRequestController.put(`${this.durationTrackingUrl}/${i}`,r)}}const oe={REWARDED:"rewarded",INTERSTITIAL:"interstitial",BANNER:"banner"};class ae{constructor(e,t,i,r,s,n=globalThis.HYPRNetworkController,o=globalThis.HYPRTimerController,a=globalThis.consentController,l=HYPRRequestParameterManager){this.id=e,this.name=t,this.type=i,this.inventoryCheckURL=r,this.networkRequestController=n,this.timerController=o,this.consentController=a,this.placementListener=s,this.requestParameterManager=l,this.request=void 0,this.imp=void 0}async loadAd(e){}inventoryCheckCallback(e,t,i,r){}processResponse(e,t,i,r=!1){}loadBidResponse(e){return!1}isAdAvailable(){return!1}getAdType(){return""}getUIComponentsString(){return"{}"}clearAdAndStopAdAvailableTimer(e=!1){}startAdAvailableTimer(){}handleRefresh(e,t){}isEqualToPlacement(e){return this.id===e.id}compileRequestParamsFromParams(e={},t=!0,i=this.ad){return e.placement_id=this.id,e}appStoreSignatureParams(e,t){const i=this.requestParameterManager.getTrackingParams();return{app_store_params:e,device_os_version:i.device_os_version,bundle_id:i.bundle_id,distributor_id:i.distributor_id,placement_id:this.id,offer:t.getOfferName(),msdkv:i.msdkv,mobile_js_version:globalThis.version(),xcode_version:i.xcode_version}}getOfferName(){return""}isFullscreenAdType(){return this.type===oe.REWARDED||this.type===oe.INTERSTITIAL}isBannerAdType(){return this.type===oe.BANNER}toString(){return`[id=${this.id}, name=${this.name}, type=${this.type}, inventoryCheckURL=${this.inventoryCheckURL}]`}}class le{constructor(e,t){this.decision=e,this.url=t}}const de="NAVIGATION_ALLOWED",ce="NAVIGATION_BLOCKED",he="OPEN_OUTSIDE_APPLICATION",ue="NAVIGATION_REDIRECTED",pe="NATIVE_APP_STORE",ge="fullscreen",me="overlay",fe="outside_app";class be{constructor(e,t,i=globalThis.HYPRNetworkController){this.configuration=e,this.networkRequestController=i,this.adnetworkSignatureEndpoint=t,this.presentationModes=be.getSupportedPresentationModes(e)}async presentStore(e,t,i,r,s=void 0){console.debug(`presentStore: AD MODEL: ${r}`);const n=this.getStorePresentationMode(r,s),o=new x(!0,I,M,{"Content-Type":O,Accept:N}),a=t.appStoreSignatureParams(e,r);console.debug(`fetchAttributionSignature: Request with paramters ${JSON.stringify(a)}`);const{response:l,body:d,error:c}=await this.networkRequestController.postAsync(this.adnetworkSignatureEndpoint,a,o);let h;console.debug(`SKAdNetwork Signature response received with status: ${l} error: ${c}`),204!==l&&K.validResponseStatus(l)?(h=JSON.stringify({presentationMode:n,...se.parseJSON(d)}),console.debug(`Store Presentation with updated parameters: ${h}`)):(h=JSON.stringify({presentationMode:n,...e}),console.debug(`Store Presentation with original parameters: ${h}`)),i.showAppStore(n,h)}getStorePresentationMode(e,t=void 0){let i=t;return console.debug(`StorePresentationController: initial mode is: ${i}`),void 0===i&&(i=this.presentationModeForPlacement(e)),console.debug(`StorePresentationController: preferred store presentation mode: ${i}`),this.presentationModes.indexOf(i)>-1?(console.debug(`StorePresentationController: using preferred store presentation mode: ${i}`),i):(console.debug(`StorePresentationController: fallback to store presentation mode: ${this.presentationModes[0]}`),this.presentationModes[0])}presentationModeForPlacement(e){return e?.shouldAppStoreUseOverlay()?me:ge}static getSupportedPresentationModes(e){const t=[];return e.isIos()&&e.isPortraitSupported()&&t.push(ge),e.isIos()&&e.version>=14&&t.push(me),t.push(fe),console.debug(`StorePresentationController: available presentation modes: ${JSON.stringify(t)}`),t}}const _e=["itunes.apple.com","apps.apple.com"],ve=["play.google.com","market://details"];class we{constructor(e,t,i,r,s=globalThis.HYPRNetworkController,n=globalThis.initializationController.deviceConfiguration){this.initialUrl=e,this.placement=t,this.baseAdInstanceId=i,this.ad=r,this.networkRequestController=s,this.resolvedStoreUrl=void 0,this.complete=!1,this.networkRequest=void 0,this.configuration=n}customUserAgent(){return`HyprMX/${this.configuration.sdkVersion}`}shouldPresentNativeBrowser(){return void 0!==this.ad&&this.ad.openClickInNativeBrowser()}navigationDecisionBasedOnProtocol(){return this.configuration.isAndroid()&&this.isPlayStoreUrl()?new le(he,this.resolvedStoreUrl):this.configuration.isIos()&&this.resolveAppStoreUrl()?new le(pe,this.resolvedStoreUrl):P.indexOf(this.initialUrl.split(":").shift())>=0?new le(de,this.initialUrl):new le(he,this.initialUrl)}async evaluateUrl(){const e=new x(!0,I,M,{"User-Agent":this.customUserAgent()});this.networkRequest=await this.networkRequestController.getAsync(this.initialUrl,e),this.networkRequest?.response>=200&&this.networkRequest?.response<400&&void 0!==this.networkRequest?.headers?.Location&&(console.debug(`will re-resolve url: ${this.networkRequest?.headers?.Location}`),this.resolveAppStoreUrl(this.networkRequest?.headers?.Location))}isStoreClickMode(){return"store"===this.ad?.getClickMode()}isPlayStoreUrl(e=this.initialUrl){return this.compareUrlWithPattern(e,ve)}resolveAppStoreUrl(e=this.initialUrl){return this.compareUrlWithPattern(e,_e)}compareUrlWithPattern(e,t){return t.filter((t=>e.includes(t))).length>=1&&(this.resolvedStoreUrl=e,this.complete=!0),this.complete}getAppStoreOverlayParams(){let e;if(this.complete||this.resolveAppStoreUrl(this.initialUrl),void 0===this.resolvedStoreUrl)return e;const t=we.getUrlParams(this.resolvedStoreUrl),i=we.getAppStoreId(this.resolvedStoreUrl.split("?").shift(),t);return void 0===i?e:{url:this.resolvedStoreUrl,SKStoreProductParameterITunesItemIdentifier:i,SKStoreProductParameterAffiliateToken:t.at,SKStoreProductParameterCampaignToken:t.ct,SKStoreProductParameterProviderToken:t.pt}}static getAppStoreId(e,t){if(void 0!==t.id)return parseInt(t.id,10);let i=e.split("/").slice(-1).shift();0===i.indexOf("id")&&(i=i.split("id").slice(-1).shift());const r=parseInt(i,10);return Number.isNaN(r)?void 0:r}static getUrlParams(e){const t={},i=e.indexOf("?");if(-1===i||i+1===e.length)return t;return e.slice(e.indexOf("?")+1).split("&").map((e=>{const[i,r]=e.split("=");t[i]=decodeURIComponent(r)})),t}}globalThis.UrlResolver=we;class ye{constructor(e,t=!0,i=!0,r="",s="ffffff",n="ff",o=!1,a=!0,l=!0){this.isWebViewScrollable=e,this.isWebViewScrollBounceEnabled=t,this.allowsPinchGesture=i,this.alpha=n,this.backgroundColor=s,this.customUserAgent=r,this.headScripts=['document.onreadystatechange = function () {if(typeof window.webkit === "object" && typeof window.webkit.messageHandlers === "object"){window.webkit.messageHandlers["setReadyState"].postMessage(document.readyState); document.onreadystatechange = null;}}'],l&&this.headScripts.push('!function(){let e=document.querySelector("meta[name=viewport]");e||((e=document.createElement("meta")).name="viewport",document.getElementsByTagName("head")[0].appendChild(e)),e.setAttribute("content",e.getAttribute("content")+", initial-scale=1.0"),setTimeout(function(){window.scrollTo(0,0)},100)}();'),this.allowsLinkPreview=a,this.playbackRequiresUserAction=o,this.allowsInlineMediaPlayback=!0,this.allowsAirPlayForMediaPlayback=!0,this.allowsPictureInPictureMediaPlayback=!1,this.isNavigationLimited=!1,this.javaScriptEnabled=!0,this.domStorageEnabled=!0,this.loadWithOverviewMode=!0,this.useWideViewPort=!0,this.displayZoomControls=!1,this.builtInZoomControls=!0,this.supportsMultipleWindows=!0}setWebViewNavigationLimited(e){if("base_ad"===e&&"object"==typeof hyprAppDomainController&&hyprAppDomainController.isAppBoundDomainEnabled()){const e=hyprAppDomainController.getAppBoundDomains();this.isNavigationLimited=e.indexOf("hyprmx.com")>-1}else this.isNavigationLimited=!1}}const Pe="inline",Ae="interstitial";class Se{constructor(e,t){this.viewModel=t,this.data=e,this.scripts=[]}generateEvent(e){return this.scripts.push(this[e](this.data)),this}generateBootstrapScripts(){return this.scripts.push(this.setPlacementType(this.data)),this.scripts.push(Te),this.scripts.push(this.fireStateChangeEvent("loading")),this.scripts.push(this.setSupports()),this.scripts.push(this.setMaxSize()),this.scripts.push(this.setScreenSize()),this.scripts.push(this.setDefaultPosition(this.data)),this.scripts.push(this.setCurrentPosition(this.data)),this.scripts.push(this.fireStateChangeEvent("default")),void 0!==this.data.containerWidth&&void 0!==this.data.containerHeight&&this.scripts.push(this.fireSizeChangeEvent(this.data)),this}generateAdReadyScripts(){return this.scripts.push(this.fireViewableChangeEvent(this.data)),this.scripts.push(this.fireReadyEvent()),this}fire(){this.scripts.forEach((e=>this.viewModel.publishASyncScriptEvent(e)))}setPlacementType(e){return"string"==typeof e.type?this.mraidEventScript("setPlacementType",`'${e.type}'`):""}fireSizeChangeEvent(e){if(void 0!==e.containerWidth&&void 0!==e.containerHeight){const t=JSON.stringify({width:e.containerWidth,height:e.containerHeight});return this.mraidEventScript("fireSizeChangeEvent",t)}return""}setCurrentPosition(e){if(void 0!==e.containerWidth&&void 0!==e.containerHeight){const t=JSON.stringify({x:0,y:0,width:e.containerWidth,height:e.containerHeight});return this.mraidEventScript("setCurrentPosition",t)}return""}setDefaultPosition(e){if(void 0!==e.containerWidth&&void 0!==e.containerHeight){const t=JSON.stringify({x:0,y:0,width:e.containerWidth,height:e.containerHeight});return this.mraidEventScript("setDefaultPosition",t)}return""}fireStateChangeEvent(e){return void 0!==e?this.mraidEventScript("fireStateChangeEvent",`'${e}'`):""}fireViewableChangeEvent(e){return void 0!==e&&void 0!==e.viewable?this.mraidEventScript("fireViewableChangeEvent",`${e.viewable}`):""}setMaxSize(){if("object"!=typeof this.data||void 0===this.data.containerWidth||void 0===this.data.containerHeight)return"";const e=JSON.stringify({width:this.data.containerWidth,height:this.data.containerHeight});return this.mraidEventScript("setMaxSize",e)}setScreenSize(){const e=JSON.parse(HYPRRequestParamListener.getScreenSize()||"{}");if(void 0===e||void 0!==e.width&&void 0!==e.height){const t=JSON.stringify({width:e.width,height:e.height});return this.mraidEventScript("setScreenSize",t)}return""}setSupports(){const e=HYPRRequestParamListener.getMraidSupportsString?.();return void 0!==e?this.mraidEventScript("setSupports",e):""}fireReadyEvent(){return this.mraidEventScript("fireReadyEvent","{}")}mraidEventScript(e,t){if(void 0!==e)return`window.dispatchEvent(new CustomEvent("${e}", {detail: ${t}}));`}}const Te="var hyprmx_celtra_mraid_check = function(time) {if (typeof celtra !== 'undefined') { var frames = document.querySelectorAll(\"iframe\");for (let i=0; i < frames.length; i++){ frames[i].contentWindow.mraid = window.mraid; }} else {setTimeout(function() {hyprmx_celtra_mraid_check(time+1)}, time + 500);}};hyprmx_celtra_mraid_check(500);";class Ce{static bootstrapEvent(e,t){new Se(e,t).generateBootstrapScripts().fire()}static adReadyEvent(e,t){new Se(e,t).generateAdReadyScripts().fire()}static containerEvents(e,t,i){const r=new Se(t,i);for(const t of e)r.generateEvent(t);r.fire()}}function Ee(e=globalThis.HYPRNativeAudioListener){if(void 0===e)return{};return{outputVolume:e.getVolume(),isMuted:e.getIsMuted(),audioCategory:e.getAudioCategory()}}class Re{constructor(){this.eventName=void 0}execute(e,t){void 0!==e?"function"==typeof t.publishCustomEvent&&t.publishCustomEvent(this.eventName,e,!0):console.error(`[WE] ${this.eventName} received with no value.`)}}class ke extends Re{constructor(){super(),this.eventName="hyprmx_volume_change"}}class xe extends Re{constructor(){super(),this.eventName="hyprmx_mute_change"}}class Ne extends Re{constructor(){super(),this.eventName="hyprmx_audio_category_change"}}let Oe;class Ie{constructor(e){this._playerAdDisplayEndpoint=e.player_ad_display_endpoint??"https://tst-mit-player-ad-display-js.hyprmx.technology"}get playerAdDisplayIndex(){return`${this._playerAdDisplayEndpoint}/index.html?CACHEBUSTER=${Date.now()}`}}const Me={enable_all_logs:!1,report_analytics_incomplete:!0,report_analytics_all:!1,report_webview_crash:!0};function Ve(e,t=globalThis.initializationController?.configuration||{}){return void 0===t[e]?(console.error(`Invalid Flag provided: ${e}`),!1):!0===t[e]}function De(e){let t;switch(e.getConnectionType()){case"Ethernet":t=1;break;case"WIFI":t=2;break;case"NR":t=3;break;case"CDMA":case"CDMA - EvDo rev. 0":case"CDMA - EvDo rev. A":case"CDMA - EvDo rev. B":case"CDMA - 1xRTT":case"CDMA - eHRPD":case"EDGE":t=4;break;case"GPRS":case"UMTS":case"HSPA":case"HSDPA":case"HSPA+":case"HSUPA":case"GSM":case"3G":t=5;break;case"LTE_CA":case"LTE":t=6;break;default:t=0}const i={connectiontype:t};if(void 0===e.getCarriers())return i;const r=JSON.parse(e.getCarriers()),s=Object.keys(r).sort();if(s.length>0){const e=r[s[0]];i.carrier=e.carrier_name,i.mccmnc=`${e.mobile_country_code},${e.mobile_network_code}`}return i}function Fe(e={},t=HYPRRequestParamListener,i=Ee){const r={...l(e),model:t.getDeviceModel(),os:t.getPlatform(),osv:t.getOSVersion(),h:t.getDeviceHeight(),w:t.getDeviceWidth(),pxratio:t.getPxRatio(),make:t.getDeviceBrand()};r.ext=r.ext||{},r.ext.hyprmx={...r.ext.hyprmx,device_fingerprint:t.getDeviceFingerPrint(),device_product:t.getDeviceProduct()};let s=JSON.stringify(r);return()=>{const e={...JSON.parse(s),...De(t)};return t.getIsAgeRestrictedUser()?(delete e.lmt,delete e.ifa):(e.lmt=t.getAdIdOptedOut()?1:0,e.ifa=t.getPersistentID()),e.ext.hyprmx={...e.ext.hyprmx,...i()},s=JSON.stringify(e),e}}const Be="HYPR_PROGRESS_ANALYTICS_STORAGE_KEY",Ue="General",$e="ad_journey";class Le{constructor(e=HYPRRequestParameterManager,t=globalThis.initializationController?.deviceConfiguration,i=Fe()){const{sdkVersion:r,msdkv:s}=t;this.clientData={...i(),...JSON.parse(JSON.stringify(t)),sdkVersion:r,msdkv:s,userId:e?.getUserId(),distributorId:e?.getDistributorID()},this.metaData={},this.category=Ue,this.webViewCrashReported=!1}addMetaData(e={},t=!1){return this.metaData={...this.metaData,...e},!0===t&&this.save(),this}buildParams(){return JSON.parse(JSON.stringify(this))}save(e=hyprMXLocalStorage){const t=JSON.stringify(this);return e?.setItem(Be,t),console.debug("[AE] Analytic event saved to storage"),t}clear(e=hyprMXLocalStorage){e?.setItem(Be,""),console.debug("[AE] Analytic event cleared from storage")}async report(e=globalThis.HYPRNetworkController){const t=this.buildParams();if(console.debug(`[AE] Analytic data captured:\n${JSON.stringify(t,null,2)}\n`),Ve("report_analytics_all")||Ve("report_analytics_incomplete")&&!1===this.diagnosticFlags.adCompleted||Ve("report_webview_crash")&&this.webViewCrashReported){const{response:i,error:r}=await e.postAsync(function(e=globalThis.initializationController?.host){let t="prd";const i=e||"";if(i.includes("stg-player.hyprmx.com"))t="stg";else if(i.includes("-player.hyprmx.technology")){const e=i.split("-player")[0];e&&e.length>0&&(t=e)}return`https://${t}-event-tracking-service.hyprmx.com/api/v1/sdk_performance_analytics/event/track`}(),t);void 0===r&&i>=200&&i<300&&this.clear()}else this.clear()}static restore(e=Le){try{const t=hyprMXLocalStorage?.getItem(Be);if(void 0===t||"string"!=typeof t)return;const i=JSON.parse(t),r=new e;return Object.assign(r,i),r.addMetaData({restored:(new Date).toISOString()}),r}catch(e){return void console.error(`[AE] unable to deserialize analytic with error: ${e}`)}}}const We={PAGE_READY_EXP:"pageReadyExpired",CATALOG_FRAME_ERR:"catalogFrameError",COMPLETION_ERR:"completionError",WEBVIEW_TERMINATION:"webViewTermination",PROSCENIUM_TERMINATION:"prosceniumWebViewTermination",WT_PAGE_TERMINATION:"wtPageWebViewTermination",THANK_YOU_PAGE_TERMINATION:"thankYouPageWebViewTermination",AD_COMPLETED:"adCompleted",AD_REWARDED:"adRewarded",INTERNET_LOSS:"internetLoss",INVALID_WEBTRAFFIC_CONFIG:"invalidWebtrafficConfig",INSECURE_LOAD:"insecureLoadOccurred",WT_PAGE_LOAD_TIMEOUT:"webtrafficPageLoadTimeout"};class qe extends Le{constructor(...e){super(...e),this.progressStates=[],this.userActions=[],this.diagnosticFlags={},Object.keys(We).forEach((e=>{this.diagnosticFlags[We[e]]=!1}))}static restore(e=qe){return super.restore(e)}setViewModelMetaData(e){if(void 0===e)return this;this.category=$e;const t=e.getAdModel();if(void 0!==t){const{type:e,clickMode:i,show_close_button:r,user_agent:s,allowed_orientation:n,id:o}=t;let a;switch(e){case g:a=!0===t.skip_proscenium?"webtrafficSkipProscenium":"webtrafficProscenium";break;case p:a=void 0!==t.preload_player_url?"preloadMraid":"mraid";break;default:a="fullScreenWeb"}this.addMetaData({offer_id:o,adType:e,clickMode:i,closableAd:r,user_agent:s,allowed_orientation:n,viewModelConfiguration:a})}const{placement:i}=e;if(void 0!==i){const{id:e,name:t,type:r}=i;this.addMetaData({placementType:r,placementId:e,placementName:t})}return this.save(),this}addBreadcrumb(e){let t;t="string"==typeof e?{state:e}:e,"webpage_crash"===t.state&&(this.webViewCrashReported=!0),this.progressStates.push({...t,t:(new Date).toISOString()})}addUserAction(e){this.userActions.push({state:e,t:(new Date).toISOString()})}setDiagnosticFlag(e){this.diagnosticFlags[e]=!0,this.save()}}function ze(e){if("string"!=typeof e||e.length<1)return e;const t=e.split("?");return!1===/hyprmx\.com/.test(t[0])?e:t[0]}const He={EVENT_NAME:"hyprAdPresentationChanged",EVENT_SHARING_CLOSED:"sharing_closed",EVENT_SHARING_PRESENTED:"sharing_presented",EVENT_AD_CLOSED:"ad_closed",EVENT_APP_PAUSED:"app_paused",EVENT_APP_RESUMED:"app_resumed",EVENT_NAVIGATION_BLOCKED:"hyprWebViewNavigationBlocked",EVENT_VIEWABLE:"viewable",EVENT_NOT_VIEWABLE:"not_viewable"},Je="notInitialized",Ye="initialized",je="ready";class Ke{constructor(e){this.currentIndex=e.currentIndex,this.currentUrl=e.currentUrl,this.currentHost=e.currentHost,this.currentTitle=e.currentTitle,this.history=e.history,this.canNavigateForward=e.canNavigateForward,this.canNavigateBack=e.canNavigateBack}}const Ge={webViewSizeData:{},adBaseUrl:Oe?.playerAdDisplayIndex,adBaseEncoding:S,adBaseMime:A,mraidState:Je,currentInstanceId(){return"string"==typeof this.preloadInstanceId?this.preloadInstanceId:this.instanceId},getWebViewConfigurationString(e){return"object"==typeof e&&"string"==typeof e.mode&&this.getWebViewConfiguration().setWebViewNavigationLimited(e.mode),JSON.stringify(this.getWebViewConfiguration())},windowOpenAttempt(e={}){const{url:t}=e;if(this.userAction="tapped_link",this.progressAnalytic?.addMetaData({clickThroughAttempt:t}),"string"!=typeof t||void 0===this.placement)return void console.error("[WVVM] Window.open attempt could not parse url");if(console.debug(`[WVVM] Window.open attempt for ${t.split("?").shift()}`),!this.shouldAllowWindowOpenEvent(e))return;const i=new we(t,this.placement,this.instanceId,this.getAdModel());if(i.isStoreClickMode())return void this.handlePotentialStoreClick(i);const r=i.navigationDecisionBasedOnProtocol();switch(r.decision){case he:return console.debug("[WVVM] Window.open will open outside app"),void this.openOutsideApplication(r.url);case pe:return console.debug("[WVVM] Window.open found store url without resolving"),void this.startStorePresentation(i);default:return console.debug("[WVVM] Window.open will show browser"),this.showBrowser(i)}},shouldTakeFocus(){return!this.placement?.isBannerAdType()||this.onSharePressed},shouldKeepFocus(){return!this.placement?.isBannerAdType()||this.onSharePressed},webviewDestroyScript:()=>'window.addEventListener("pagehide", (e) => {window.webkit.messageHandlers.hypr_pagehide_complete.postMessage("hypr_pagehide_complete");});setTimeout(() => {window.webkit.messageHandlers.hypr_pagehide_complete.postMessage("hypr_pagehide_complete");}, 2000);',shouldLoadAboutBlank(){return this.breadcrumb={state:"should_load_about_blank",value:true},true},shouldRedirectURL(e){const t="object"==typeof e?e.url:void 0,i="object"==typeof e?e.mimeType:void 0;if("text/html"===i)return JSON.stringify(new le(de,e.url));if("string"!=typeof t||void 0===this.placement)return JSON.stringify(new le(ce,t));if("application/pdf"===i||t.endsWith(".pdf")||"application/msword"===i||t.endsWith(".doc")||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===i||t.endsWith("docx")||"application/vnd.ms-excel"===i||t.endsWith("xls")||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===i||t.endsWith("xlsx")||"application/vnd.ms-powerpoint"===i||t.endsWith("ppt")||"application/vnd.openxmlformats-officedocument.presentationml.presentation"===i||t.endsWith(".pptx")){const e=`https://docs.google.com/viewer?url=${t}&embedded=true`;return this.breadcrumb={state:"should_redirect_url",value:e},JSON.stringify(new le(ue,e))}return JSON.stringify(new le(de,e.url))},shouldInterceptRequest(e){"http"===e.scheme&&"function"==typeof this.webViewPresenter.removeJavascriptInterface&&(console.debug(`[WVVM] Insecure data loaded:  ${e.url} Removing Javascript Interface.`),this.updateDiagnosticFlag(We.INSECURE_LOAD))},getWebViewContainerData(){const e={};return e.containerWidth=Math.floor(this.webViewSizeData.width),e.containerHeight=Math.floor(this.webViewSizeData.height),e.viewable=this.isViewable(),e.type=this.placement?.isBannerAdType()?Pe:Ae,e},onPageFinished({url:e}){console.debug(`[WVVM] onPageFinished: ${e}`),this.breadcrumb={state:"on_page_finish",value:ze(e)},this.loadInProgress=!1,this.handlePageFinishFromWebView(e),this.publishVolumeData(),console.debug(`[WVVM] [mraid loading] Starting Bootstrap Load for instance: ${this.currentInstanceId()}`),Ce.bootstrapEvent(this.getWebViewContainerData(),this),this.mraidState=Ye,this.isViewable()&&this.fireMraidReady(),console.debug(`[WVVM] [mraid loading] onPageFinished() MRAID State is: ${this.mraidState}`)},onJSMessage(e){this.handleJSMessageFromWebView(e)},onLoadData(){this.onWebViewLoadData()},onPageStarted({url:e}){this.publishVolumeData(),this.breadcrumb={state:"on_page_started",value:ze(e)},this.mraidState=Je,this.loadInProgress=!0,this.webViewPresenter.updateWebViewConfiguration(JSON.stringify(this.getWebViewConfiguration())),this.handlePageStartedFromWebView(e)},onReceivedError(e){this.handleErrorFromWebView(e)},onWebViewCrash(){return this.onWebViewTermination()},fireMraidReady(){console.debug(`[WVVM] [mraid loading] Firing MRAID AdReady to instance: ${this.currentInstanceId()}`),Ce.adReadyEvent(this.getWebViewContainerData(),this),this.mraidState=je},webViewSizeChange(e){this.webViewSizeData=e,Ce.containerEvents(["setMaxSize","setDefaultPosition","setCurrentPosition","fireSizeChangeEvent"],this.getWebViewContainerData(),this),console.debug(`[WVVM] [mraid loading] webViewSizeChange() MRAID State is: ${this.mraidState}`)},reportContainerSizeChange(){Ce.containerEvents(["setScreenSize","fireSizeChangeEvent"],this.getWebViewContainerData(),this),console.debug(`[WVVM] [mraid loading] reportContainerSizeChange() MRAID State is: ${this.mraidState}`)},publishVolumeData(){const{outputVolume:e,isMuted:t}=Ee();(new ke).execute(e,this),(new xe).execute(t,this)},reportVisibilityChanged(){this.isViewable()&&this.mraidState!==je&&this.fireMraidReady(),Ce.containerEvents(["fireViewableChangeEvent"],this.getWebViewContainerData(),this);const e=this.isViewable()?He.EVENT_SHARING_CLOSED:He.EVENT_SHARING_PRESENTED;this.publishCustomEvent(He.EVENT_NAME,e),console.debug(`[WVVM] [mraid loading] reportVisibilityChanged() MRAID State is: ${this.mraidState}`)},reportLifecycleChanged(e){const t=e?He.EVENT_APP_PAUSED:He.EVENT_APP_RESUMED;this.publishCustomEvent(He.EVENT_NAME,t),this.publishJSExecutionState(e)},adWillClose(){this.publishCustomEvent(He.EVENT_NAME,He.EVENT_AD_CLOSED)},setCurrentUrl(e,t=void 0){void 0!==t&&(this.userAgent=t),this.adHtml=void 0,this.queryParams=void 0,this.url=e,this.breadcrumb={state:"set_page_url",value:ze(e)}},setCurrentData(e,t=Oe?.playerAdDisplayIndex,i=globalThis.HYPRNetworkController){console.debug(`[WVVM] Setting current data to: ${e}`),void 0!==t&&t!==this.adBaseUrl&&(this.adBaseUrl=t),this.url=void 0;const r=this.adBaseMime,s=this.adBaseEncoding;this.adHtml=JSON.stringify({data:e,baseUrl:i?.transform(t)??t,mimeType:r,encoding:s})},openFileChooser(e){return e.acceptTypes.indexOf("image/*")<0?(console.error(`[WVVM] Unsupported acceptTypes ${JSON.stringify(e.acceptTypes)}`),!1):this.captureImage()},onHistoryChanged(e){console.debug(`[WVVM] ${JSON.stringify(e)}`),this.webViewHistory=new Ke(e),this.onWebViewHistoryChanged(this.webViewHistory)},navigateBack(){this.webViewPresenter.navigateBack()},navigateForward(){this.webViewPresenter.navigateForward()},notifyWindowOpenURLBlock(e){this.publishCustomEvent(He.EVENT_NAVIGATION_BLOCKED,e)},publishASyncScriptEvent(e){this.webViewPresenter?.runScript(e)},publishJSExecutionState(e){"function"==typeof this.webViewPresenter.pauseJSExecution&&"function"==typeof this.webViewPresenter.resumeJSExecution&&(e?this.webViewPresenter.pauseJSExecution():this.webViewPresenter.resumeJSExecution())},publishCustomEvent(e,t,i=!1){const r=`window.dispatchEvent(new CustomEvent('${e}', { detail: '${t}'}));${i?`\nwindow.${e} = ${t};`:""}`;console.debug(`[WVVM] Publishing custom event: ${r}`),this.publishASyncScriptEvent(r)},setWebViewPresenter(e){this.webViewPresenter=e,this.webViewPresenterSubscriptions.forEach((e=>{try{this[e]=this[e]}catch(t){console.error(`[WVVM] Error setting binded property ${e} on webview presenter`)}}))},imageCaptured(e){this.webViewPresenter.imageCaptured(e.url)},denyPermissionRequest(e){console.debug(`[WVVM] Unsupported permission request: ${JSON.stringify(e)}`);const t=[];e.permissions?.forEach((e=>{t.push({permission:e,granted:!1})}));const i=JSON.stringify({permissions:t,permissionId:e.permissionId});this.webViewPresenter.permissionResponse(i)},permissionResponse(e){console.debug(`[WVVM] permissionResponse: ${JSON.stringify(e)}`);for(let t=0;t<e.permissions.length;t+=1)"android.permission.CAMERA"===e.permissions[t].permission?e.permissions[t].permission="android.webkit.resource.VIDEO_CAPTURE":"android.permission.RECORD_AUDIO"===e.permissions[t].permission&&(e.permissions[t].permission="android.webkit.resource.AUDIO_CAPTURE");this.webViewPresenter.permissionResponse(JSON.stringify(e))}},Ze=["start","description","end","id","location","summary","status","transparent","freebusy","reminder","recurrence"];class Xe{constructor(e,t="https://0606delr85.execute-api.us-east-1.amazonaws.com/default/calendar_proxy"){const i=JSON.parse(e);i.recurrence=this.processRecurrenceData(i.recurrence),this.calendarEventParams=i,this.proxyUrl=t}processRecurrenceData(e){try{const t=[];switch(e?.frequency){case"daily":t.push("FREQ=DAILY");break;case"weekly":t.push("FREQ=WEEKLY");break;case"monthly":t.push("FREQ=MONTHLY");break;case"yearly":t.push("FREQ=YEARLY");break;default:return void console.error("processRecurrenceData: No parsable recurrence rule without frequency")}if(void 0!==e.daysInWeek){const i=[];for(const t of e.daysInWeek)switch(t){case 1:i.push("MO");break;case 2:i.push("TU");break;case 3:i.push("WE");break;case 4:i.push("TH");break;case 5:i.push("FR");break;case 6:i.push("SA");break;case 7:i.push("SU");break;default:console.error(`processRecurrenceData: Invalid weekday data: ${t}`)}t.push(`BYDAY=${i.join(",")}`)}return void 0!==e.daysInMonth&&t.push(`BYMONTHDAY=${e.daysInMonth.join(",")}`),void 0!==e.monthsInYear&&t.push(`BYMONTH=${e.monthsInYear.join(",")}`),void 0!==e.daysInYear&&t.push(`BYYEARDAY=${e.daysInYear.join(",")}`),void 0!==e.expires&&t.push(`UNTIL=${e.expires}`),t.join(";")}catch(e){return void console.error(`Error parsing recurrence rule: ${e}`)}}webcalUrl(){return`webcal://${this.proxyUrl.split("://").pop()}`}buildProxyQuery(){const e=[];for(const t of Ze)void 0!==this.calendarEventParams[t]&&e.push(`${t}=${this.calendarEventParams[t]}`);return`?${e.join("&")}`}toProxyRequest(){const e=encodeURI(`${this.webcalUrl()}${this.buildProxyQuery()}`);return console.debug(`toProxyRequest() generated final url ${e}`),e}}const Qe=["onStop","UISceneDidEnterBackgroundNotification","UIApplicationDidEnterBackgroundNotification"],et=["onResume","UISceneWillEnterForegroundNotification","UIApplicationWillEnterForegroundNotification"];class tt{constructor(e,t,i="",r=HYPRRequestParamListener,s=globalThis.HYPRNetworkController,n=globalThis.HYPRStorePresentationController,o=globalThis.initializationController.deviceConfiguration,a=globalThis.HYPREventController,l=HYPRRequestParameterManager,d=globalThis.HYPRTimerController){this.placement=e,this.listener=t,this.paramRequestListener=r,this.networkRequestController=s,this.storePresentationController=n,this.configuration=o,this.presentationListener=void 0,this.eventController=a,this.requestParameterManager=l,this.instanceId=i,this.preloadInstanceId=void 0,this.lastTransition="",this.hasParentView=!1,this.currentSizeData=void 0,this.visible=!1,this.hasBecomeVisible=!1,this.timerController=d,this.backgrounded=!1,this.browserInstance=void 0,this.webViewHistory=void 0,this.currentSizeData={},this.loadInProgress=!1,this.WebViewConfiguration=void 0,this._url=void 0,this._adHtml=void 0,this._breadcrumb=void 0,this._userAction=void 0,this.presenterSubscriptions=[],this.webViewPresenterSubscriptions=["url","adHtml"]}get url(){return this._url}set url(e){this._url=e,void 0!==e&&this.webViewPresenter?.setUrl(e)}get adHtml(){return this._adHtml}set adHtml(e){this._adHtml=e,void 0!==e&&this.webViewPresenter?.setAdHtml(e)}get breadcrumb(){return this._breadcrumb}set breadcrumb(e){void 0!==e&&void 0!==this.progressAnalytic?this.progressAnalytic?.addBreadcrumb(e):console.debug(`Observed new breadcrumb event: ${e}`),this._breadcrumb=e}get userAction(){return this._userAction}set userAction(e){"string"==typeof e&&void 0!==this.progressAnalytic?this.progressAnalytic?.addUserAction(e):console.debug(`Observed new userAction: ${e}`),this._userAction=e}updateDiagnosticFlag(e){"string"==typeof e&&void 0!==this.progressAnalytic?this.progressAnalytic?.setDiagnosticFlag(e):console.debug(`Observed diagnostic flag change: ${e}`)}destroy(){console.debug(`[BAVM] destroy for ${this.instanceId}`),this.pageReadyController?.stopPageReadyTimer()}onBackButtonPressed(){}getWebViewConfiguration(){const e=this.getAdModel()?.user_agent||"";return void 0===this.webViewConfiguration&&(this.webViewConfiguration=new ye(this.scrollingEnabled(),this.shouldScrollBounce(),this.isPinchEnabled(),e,this.webViewBackground(),this.webViewAlpha(),this.playbackRequiresUserAction(),this.allowsWebViewLinkPreview(),this.shouldScaleViewport())),this.webViewConfiguration}onLifecycleEvent(e){console.debug(`[BAVM] onLifecycleEvent: ${e.event} received.`),this.handleLifecycleTransition(e.event)}onWebViewLoadData(){}onParentViewChangeEvent(e){console.debug(`[BAVM] onParentViewChangeEvent: View has superview: ${e.parentView}.`),this.hasParentView=e.parentView}containerSizeChange(e){console.debug(`[BAVM] Received new container size: ${JSON.stringify(e)}`),this.currentSizeData=e,"function"==typeof this.reportContainerSizeChange&&this.reportContainerSizeChange(e)}containerVisibleChange(e){if(!0===e.visible&&(this.hasBecomeVisible=!0),console.debug(`[BAVM] Received new visible state: ${e.visible}`),this.visible!==e.visible&&(this.visible=e.visible,"function"==typeof this.reportVisibilityChanged))try{this.reportVisibilityChanged()}catch(e){console.debug(`[BAVM] Error reporting visibility change: ${JSON.stringify(e)}`)}}handleLifecycleTransition(e){this.isBackgroundTransition(e)?(this.onBackgroundTransition(),this.lastTransition=e):this.isForegroundTransition(e)&&(this.onForegroundTransition(),this.lastTransition=e),this.reportVisibilityChanged()}onForegroundTransition(){this.backgrounded=!1,"function"==typeof this.reportLifecycleChanged&&this.reportLifecycleChanged(!1)}onBackgroundTransition(){this.backgrounded=!0,"function"==typeof this.reportLifecycleChanged&&this.reportLifecycleChanged(!0)}isBackgroundTransition(e){return Qe.includes(e)&&!Qe.includes(this.lastTransition)}isForegroundTransition(e){return et.includes(e)&&!et.includes(this.lastTransition)}isValid(){return void 0!==this.placement}getPlacementName(){return this.placement?.name||""}getPlacementType(){return this.placement?.type||""}shouldScrollBounce(){return!0}isPinchEnabled(){return!0}scrollingEnabled(){return!0}allowsWebViewLinkPreview(){return!0}playbackRequiresUserAction(){return!1}webViewBackground(){return"ffffff"}webViewAlpha(){return"ff"}shouldScaleViewport(){return!1}handleJSMessageFromWebView(e){const{name:t,body:i}=e;switch(t){case"open":case"openInSafariVC":this.windowOpenAttempt({url:i});break;case"createCalendarEvent":this.createCalendarEvent(i);break;case"storePicture":this.storePicture(i);break;case"presentStoreView":this.launchStore({url:JSON.parse(i).url},JSON.parse(i).mode);break;case"setOrientationProperties":{const{allowOrientationChange:e,forceOrientation:t}=JSON.parse(i);this.presenter.setOrientationProperties("true"===e,t);break}case"useCustomClose":this.presenter.useCustomClose("true"===i);break;case"setTrampoline":this.setTrampoline(JSON.parse(i));break;case"setNativeAdConfiguration":this.setNativeAdConfiguration(JSON.parse(i));break;default:"function"==typeof this[t]?(console.debug(`[BAVM] applying JS Event: ${t} with params ${i}`),this[t].apply(this,[i])):console.error(`[BAVM] Unsupported JS Event: ${t} with params ${i}`)}}setNativeAdConfiguration(e){}setTrampoline(e){}handleErrorFromWebView(e){}handlePageFinishFromWebView(e){}handlePageStartedFromWebView(e){this.currentTrackedUrl=e}onWebViewHistoryChanged(e){}javaScriptAlertAttempt(e){return!0}permissionRequest(e){if(console.debug(`[BAVM] Permission Request for ${JSON.stringify(e)}`),null!=e.permissions){for(let t=0;t<e.permissions.length;t+=1)"android.webkit.resource.VIDEO_CAPTURE"===e.permissions[t]?e.permissions[t]="android.permission.CAMERA":"android.webkit.resource.AUDIO_CAPTURE"===e.permissions[t]&&(e.permissions[t]="android.permission.RECORD_AUDIO");"function"==typeof this.presenter?.permissionRequest&&this.presenter.permissionRequest(JSON.stringify(e.permissions),e.permissionId)}else this.denyPermissionRequest(e)}shouldAllowWindowOpenEvent(e){return!0}nativeBrowserWillPresent(e){}async handlePotentialStoreClick(e){if(console.debug("[BAVM] Window.open evaluating url for resolution"),e.isPlayStoreUrl()&&(console.debug("[BAVM] Window.open will open outside app"),this.openOutsideApplication(e.resolvedStoreUrl)),await e.evaluateUrl(),console.debug("[BAVM] Window.open url evaluation complete"),e.complete)return console.debug("[BAVM] Window.open resolved to good store url"),void this.startStorePresentation(e);console.debug("[BAVM] Window.open failed resolution"),this.showBrowser(e)}showAppStore(e,t){console.debug(`[BAVM] Will show AppStore with mode: ${e}`),e!==fe?(this.presenter.showAppStore(t),this.storePresentationPromise=void 0):this.openOutsideApplication(JSON.parse(t).url)}showBrowser(e){if(this.nativeBrowserWillPresent(e),e.shouldPresentNativeBrowser())return void this.presenter.showPlatformBrowser(e.initialUrl);const t=this.listener.initializeBrowserViewModel(this.instanceId,e,this,this.placement);return this.presenter.showHyprMXBrowser(t),t}onModalClosed(){this.browserInstance=void 0}urlNavigationAttempt(e){const t="object"==typeof e?e.url:void 0;if("string"!=typeof t||void 0===this.placement)return JSON.stringify(new le(ce,t));console.debug(`[BAVM] urlNavigationAttempt() Navigation Attempt check for ${t.split("?").shift()};\n\n    request is main frame: ${e.isMainFrame}`);const i=new we(t),r=i.navigationDecisionBasedOnProtocol();return r.decision===he?(console.debug(`[BAVM] urlNavigationAttempt() will open outside App: ${t.split("?").shift()}`),this.openOutsideApplication(r.url),JSON.stringify(new le(ce,t))):r.decision===pe?(console.debug(`[BAVM] urlNavigationAttempt() will open native App Store: ${t.split("?").shift()}`),this.startStorePresentation(i),JSON.stringify(new le(ce,t))):(console.debug(`[BAVM] urlNavigationAttempt() navigation result: ${r.decision}`),JSON.stringify(r))}startStorePresentation(e,t=void 0){console.debug("[BAVM] startStorePresentation() starting store presentation");const i=e.getAppStoreOverlayParams();return"object"==typeof i?(console.debug("[BAVM] startStorePresentation() launching app store"),this.launchStore(i,t),!0):(console.debug("[BAVM] startStorePresentation() failed to parse params"),!1)}launchStore(e,t=void 0){void 0===this.storePresentationPromise?(this.userAction="present_store",this.storePresentationPromise=this.storePresentationController.presentStore(e,this.placement,this,this.getAdModel(),t)):console.debug("[BAVM] Debounced app store presentation events")}openOutsideApplication(e){this.userAction="open_deep_link",this.presenter.openOutsideApplication(e)}createCalendarEvent(e){if(this.configuration.isIos()){console.debug("[BAVM] createCalendarEvent on iOS Device - building proxy request");const t=new Xe(e);this.openOutsideApplication(t.toProxyRequest())}else console.debug("[BAVM] createCalendarEvent on Android Device - sending data for native Intent"),this.presenter.createCalendarEvent(e)}storePicture(e){this.presenter.storePicture(e)}captureImage(){return this.presenter.captureImage(),!0}generateTimeOnSiteTracking(){}onWebViewTermination(){return!0}onClose(){}clearPreloadId(){this.preloadInstanceId=void 0}getAdModel(){return this.ad}setPresenter(e){console.debug("[BAVM] Setting Presenter"),this.presenter=e,this.breadcrumb="set_presenter",this.presenterSubscriptions.forEach((e=>{console.debug(`[BAVM] rebinding: ${e}`);try{this[e]=this[e]}catch(t){console.error(`[BAVM] Error setting binded property ${e} on presenter`)}}))}isViewable(){return this.visible&&!this.backgrounded}}Object.assign(tt.prototype,Ge);const it="hyprmx.com/adinfo.html";class rt extends tt{constructor(e,t="webview",i="",r=void 0,s=void 0,...n){super(...n),this.baseViewModel=r,this.clickMode=t,this.onPageJS=i,this.timeOnSiteTracker=void 0,this.isPresenting=!1,"store"!==this.clickMode&&(this.timeOnSiteTracker=s),this._backButtonEnabled=!1,this._forwardButtonEnabled=!1,this._header="",this.presenterSubscriptions.push("backButtonEnabled"),this.presenterSubscriptions.push("forwardButtonEnabled"),this.presenterSubscriptions.push("header"),this.setCurrentUrl(e)}get forwardButtonEnabled(){return this._forwardButtonEnabled}set forwardButtonEnabled(e){this._forwardButtonEnabled=e,this.presenter?.setForwardButtonEnabled(e)}get backButtonEnabled(){return this._backButtonEnabled}set backButtonEnabled(e){this._backButtonEnabled=e,this.presenter?.setBackButtonEnabled(e)}get header(){return this._header}set header(e){this._header=e,this.presenter?.setHeader(e)}onBrowserReady(){console.debug("onBrowserReady"),this.timeOnSiteTracker?.startOnPageTimer(!1)}adInfoPattern(){return void 0!==globalThis.initializationController&&globalThis.initializationController.getConfiguration().ad_info_url||it}onNavigateBackPressed(){this.navigateBack()}onNavigateForwardPressed(){this.navigateForward()}onSharePressed(){const e=this.webViewHistory.currentUrl;this.presenter.openShareSheet(JSON.stringify({data:e}))}onClose(){this.timeOnSiteTracker?.onBrowserClosed(),this.baseViewModel.onModalClosed()}onBackButtonPressed(){this.webViewHistory.canNavigateBack?this.navigateBack():this.triggerClose()}hasOnPageJS(){return this.onPageJS.length>0}showBrowser(e){this.setCurrentUrl(e.initialUrl)}triggerClose(){this.presenter.closeBrowser()}openOutsideApplication(e){super.openOutsideApplication(e),this.triggerClose()}handlePageStartedFromWebView(e){this.hasOnPageJS()&&void 0===this.onPageResolve&&new Promise((e=>{this.onPageResolve=e,console.debug("[BrowserOnPageJS] promise stored"),this.onPageJsTimeout=this.timerController.startTimer(8e3,(()=>{console.debug("[BrowserOnPageJS] timeout reached"),this.onPageJsTimeout=void 0,this.resolveOnPageJS()}))})).then((()=>{console.debug(`[BrowserOnPageJS] Firing onPageJS on ClickThrough: ${this.url}, for Placement: ${this.placement}`),this.publishASyncScriptEvent(this.onPageJS)})),this.presenter.webViewLoadStarted(e)}handlePageFinishFromWebView(e){console.debug(`handlePageFinishFromWebView: ${e}`),this.resolveOnPageJS(),super.handlePageFinishFromWebView(e)}resolveOnPageJS(){"function"==typeof this.onPageResolve&&(console.debug("[BrowserOnPageJS] will resolve onPageJS Promise"),this.onPageResolve()),this.onPageResolve=void 0,void 0!==this.onPageJsTimeout&&(this.timerController.stopTimer(this.onPageJsTimeout),console.debug("[BrowserOnPageJS] stopped timer")),this.onPageJsTimeout=void 0}onForegroundTransition(){super.onForegroundTransition(),this.timeOnSiteTracker?.onForegrounded()}onBackgroundTransition(){super.onBackgroundTransition(),this.timeOnSiteTracker?.onBackgrounded()}getAdModel(){return this.baseViewModel?.getAdModel()}shouldScaleViewport(){return!0}onWebViewHistoryChanged(e){this.backButtonEnabled!==e.canNavigateBack&&(this.backButtonEnabled=e.canNavigateBack),this.forwardButtonEnabled!==e.canNavigateForward&&(this.forwardButtonEnabled=e.canNavigateForward),this.header!==e.currentHost&&(this.header=e.currentHost)}}class st{constructor(e={},t=void 0){Object.assign(this,e),this.bidResponse=t,void 0===this.webview_release_in_seconds&&(this.webview_release_in_seconds=0),void 0===this.force_status_bar_display&&(this.force_status_bar_display=this.type===g&&"portrait"===this.allowed_orientation),void 0===this.allowed_orientation&&(this.allowed_orientation="all"),void 0===this.type&&(this.type=f),void 0===this.title&&(this.title=""),void 0===this.offer_initiation_timeout_in_seconds&&(this.offer_initiation_timeout_in_seconds=8),void 0===this.clickMode&&(this.clickMode="webview"),void 0===this.show_close_button&&(this.show_close_button=!1),void 0===this.user_agent&&(this.user_agent=null)}static fromAdsArray(e,t=[]){const i=t.shift();if("object"==typeof i&&se.hasRequiredKeys(i,["id","type"],"string")&&se.hasRequiredKeys(i,["offer_initiation_timeout_in_seconds"],"number")&&se.hasRequiredKeys(i,["catalog_frame_url"],"url"))return e(i)}appendRequestData(e,t){return t?this.relay_promise_token&&Object.assign(e,{last_promise_token:this.getAdRewardToken()}):Object.assign(e,{reward_token:this.getAdRewardToken(),offer:this.getOfferName()}),e}getAdType(){return this.type||""}getAdIdentifier(){return this.id||""}hasAd(){return""!==this.getAdIdentifier()}getOfferName(){return`${this.getAdType()}-${this.getAdIdentifier()}`}getAdString(){return JSON.stringify(this)}getAdRewardText(){return this.reward_text||""}getAdRewardQuantity(){return this.reward_quantity||0}getAdRewardToken(){return this.reward_token||""}getDaaIconUrl(){return this.daa_url||""}isNavigationRuleMatch(e){return!("string"!=typeof e||"string"!=typeof this.navigation_rule||this.navigation_rule.length<1)&&null!==e.match(new RegExp(this.navigation_rule,"i"))}shouldAppStoreUseOverlay(){return!0===this.use_skoverlay}openClickInNativeBrowser(){return void 0!==this.click&&"native"===this.click.mode}getClickMode(){return this.click?.mode||"webview"}}function nt(e=globalThis.defaultUIComponents.user_info_form?.footer){return c({images:[],text:"          ",background_color:"F9F9F9",min_height:52},e)}function ot(e,t="Next",i="Close",r=globalThis.defaultUIComponents.webtraffic,s=globalThis.IS_IOS){const n=c(function(e,t,i,r){return r?{title_text:`<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Content-Style-Type" content="text/css"><title></title><style type="text/css">p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px 'Helvetica Neue'; color: #3a3a3a; text-align:center}span.s1 {font-family: 'Helvetica Neue'; font-weight: normal; font-style: normal; font-size: 10.00pt}</style></head><body><p class="p1"><span class="s1">${e}</span></p></body></html>`,next_button_text:`<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Content-Style-Type" content="text/css"><title></title><style type="text/css">p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px 'Helvetica Neue'; color: #ffffff; text-align:center}span.s1 {font-family: 'Helvetica Neue'; font-weight: normal; font-style: normal; font-size: 10.00pt}</style></head><body><p class="p1"><span class="s1">${t}</span></p></body></html>`,finish_button_text:`<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Content-Style-Type" content="text/css"><title></title><style type="text/css">p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px 'Helvetica Neue'; color: #ffffff; text-align:center}span.s1 {font-family: 'Helvetica Neue'; font-weight: normal; font-style: normal; font-size: 10.00pt}</style></head><body><p class="p1"><span class="s1">${i}</span></p></body></html>`,countdown_text:'<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="Content-Style-Type" content="text/css"><title></title><style type="text/css">p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px \'Helvetica Neue\'; color: #5D5D5D; text-align:center; font-weight:bold}span.s1 {font-family: \'Helvetica Neue\'; font-weight: normal; font-style: normal; font-size: 14.00pt; font-weight:bold; line-height: 0; padding-bottom: 1px}</style></head><body><p class="p1"><span class="s1">%@</span></p></body></html>'}:{title_text:`<font color='#3a3a3a'>${e}</font>`,next_button_text:`<font color='#FFFFFF'>${t}</font>`,finish_button_text:`<font color='#FFFFFF'>${i}</font>`,countdown_text:"<font color='#5D5D5D'><b>%s</b></font>"}}(e??"",t,i,s),r);return c({header_background_color:"F9F9F9",finish_button_minimum_size:{width:50,height:20},next_button_minimum_size:{width:50,height:20},next_button_color:"28A362",finish_button_color:"28A362",page_indicator_color:"AAAAAA",page_indicator_color_selected:"28A362",minimum_header_height:44,close_button_color:"5D5D5D",chevron_color:"FFFFFF",close_button:{image:{height:20,width:20}}},n)}function at(e,t=void 0){console.debug(`[FSAF] FullScreenAdFactory raw JSON ${JSON.stringify(e)}`);const i={...{web_traffic_header:ot(e.title),footer:nt()},...e},r=new st(i,t);return console.debug(`[FSAF] FullScreenAdFactory Ad JSON ${JSON.stringify(r)}`),r}class lt{async loadAd(){return console.error("Abstract class for Ad Loading used"),{ad:void 0,required_information:void 0,ui_components:void 0}}cancel(){void 0!==this.canceller&&(console.debug(`[AL] Cancelling network event for: ${this}`),this.canceller?.cancel())}}class dt extends lt{constructor(e,t){super(),this.placementId=e,this.inventoryCheckURL=t}async loadAd(e={},t=HYPRRequestParameterManager,i=globalThis.HYPRNetworkController){console.debug(`[IVL] Beginning inventory check for placement: ${this.placementId}`),e.placement_id=this.placementId;const r=t.getInventoryCheckParams(e);try{const{promise:e,canceller:t}=i.cancellableAsyncPost(this.inventoryCheckURL,r);this.canceller=t;const{code:s,body:n,error:o}=await e;return this.canceller=void 0,console.debug(`[IVL] Loading ads completed for placement: ${this.placementId}`),{...this.processResponse(s,n,o),error:o}}catch(e){return console.debug(`[IVL] Inventory check aborted for: ${this.placementId} with error: ${e}`),{error:e}}}processResponse(e,t,i){console.debug(`[IVL] Processing inventory check response for placement: ${this.placementId} with status code ${e} and with error: ${i}`);const r=se.parseJSON(t);let s;K.validResponseStatus(e)&&void 0===i&&this.validResponse(r)&&this.responseHasAd(r)&&(s=st.fromAdsArray(at,r.ads_available));const{required_information:n,ui_components:o}={...r};return{ad:s,required_information:n,ui_components:o}}validResponse(e){return void 0!==e&&se.hasRequiredKeys(e,["ads_available"],"object")}responseHasAd(e){return void 0!==e&&(void 0!==e.ads_available&&e.ads_available.length>0||void 0!==e.required_information&&e.required_information.length>0)}}var ct,ht,ut={},pt={};function gt(){return ct||(ct=1,function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i="["+t+"]["+(t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",r=new RegExp("^"+i+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,i){if(t){const r=Object.keys(t),s=r.length;for(let n=0;n<s;n++)e[r[n]]="strict"===i?[t[r[n]]]:t[r[n]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){const t=r.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const i=[];let r=t.exec(e);for(;r;){const s=[];s.startIndex=t.lastIndex-r[0].length;const n=r.length;for(let e=0;e<n;e++)s.push(r[e]);i.push(s),r=t.exec(e)}return i},e.nameRegexp=i}(pt)),pt}function mt(){if(ht)return ut;ht=1;const e=gt(),t={allowBooleanAttributes:!1,unpairedTags:[]};function i(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function r(e,t){const i=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const r=e.substr(i,t-i);if(t>5&&"xml"===r)return h("InvalidXml","XML declaration allowed only at the start of the document.",p(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function s(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let i=1;for(t+=8;t<e.length;t++)if("<"===e[t])i++;else if(">"===e[t]&&(i--,0===i))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}ut.validate=function(n,o){o=Object.assign({},t,o);const l=[];let u=!1,g=!1;"\ufeff"===n[0]&&(n=n.substr(1));for(let t=0;t<n.length;t++)if("<"===n[t]&&"?"===n[t+1]){if(t+=2,t=r(n,t),t.err)return t}else{if("<"!==n[t]){if(i(n[t]))continue;return h("InvalidChar","char '"+n[t]+"' is not expected.",p(n,t))}{let f=t;if(t++,"!"===n[t]){t=s(n,t);continue}{let b=!1;"/"===n[t]&&(b=!0,t++);let _="";for(;t<n.length&&">"!==n[t]&&" "!==n[t]&&"\t"!==n[t]&&"\n"!==n[t]&&"\r"!==n[t];t++)_+=n[t];if(_=_.trim(),"/"===_[_.length-1]&&(_=_.substring(0,_.length-1),t--),m=_,!e.isName(m)){let e;return e=0===_.trim().length?"Invalid space after '<'.":"Tag '"+_+"' is an invalid name.",h("InvalidTag",e,p(n,t))}const v=a(n,t);if(!1===v)return h("InvalidAttr","Attributes for '"+_+"' have open quote.",p(n,t));let w=v.value;if(t=v.index,"/"===w[w.length-1]){const e=t-w.length;w=w.substring(0,w.length-1);const i=d(w,o);if(!0!==i)return h(i.err.code,i.err.msg,p(n,e+i.err.line));u=!0}else if(b){if(!v.tagClosed)return h("InvalidTag","Closing tag '"+_+"' doesn't have proper closing.",p(n,t));if(w.trim().length>0)return h("InvalidTag","Closing tag '"+_+"' can't have attributes or invalid starting.",p(n,f));{const e=l.pop();if(_!==e.tagName){let t=p(n,e.tagStartPos);return h("InvalidTag","Expected closing tag '"+e.tagName+"' (opened in line "+t.line+", col "+t.col+") instead of closing tag '"+_+"'.",p(n,f))}0==l.length&&(g=!0)}}else{const e=d(w,o);if(!0!==e)return h(e.err.code,e.err.msg,p(n,t-w.length+e.err.line));if(!0===g)return h("InvalidXml","Multiple possible root nodes found.",p(n,t));-1!==o.unpairedTags.indexOf(_)||l.push({tagName:_,tagStartPos:f}),u=!0}for(t++;t<n.length;t++)if("<"===n[t]){if("!"===n[t+1]){t++,t=s(n,t);continue}if("?"!==n[t+1])break;if(t=r(n,++t),t.err)return t}else if("&"===n[t]){const e=c(n,t);if(-1==e)return h("InvalidChar","char '&' is not expected.",p(n,t));t=e}else if(!0===g&&!i(n[t]))return h("InvalidXml","Extra text at the end",p(n,t));"<"===n[t]&&t--}}}var m;return u?1==l.length?h("InvalidTag","Unclosed tag '"+l[0].tagName+"'.",p(n,l[0].tagStartPos)):!(l.length>0)||h("InvalidXml","Invalid '"+JSON.stringify(l.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):h("InvalidXml","Start tag expected.",1)};const n='"',o="'";function a(e,t){let i="",r="",s=!1;for(;t<e.length;t++){if(e[t]===n||e[t]===o)""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){s=!0;break}i+=e[t]}return""===r&&{value:i,index:t,tagClosed:s}}const l=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function d(t,i){const r=e.getAllMatches(t,l),s={};for(let e=0;e<r.length;e++){if(0===r[e][1].length)return h("InvalidAttr","Attribute '"+r[e][2]+"' has no space in starting.",g(r[e]));if(void 0!==r[e][3]&&void 0===r[e][4])return h("InvalidAttr","Attribute '"+r[e][2]+"' is without value.",g(r[e]));if(void 0===r[e][3]&&!i.allowBooleanAttributes)return h("InvalidAttr","boolean attribute '"+r[e][2]+"' is not allowed.",g(r[e]));const t=r[e][2];if(!u(t))return h("InvalidAttr","Attribute '"+t+"' is an invalid name.",g(r[e]));if(s.hasOwnProperty(t))return h("InvalidAttr","Attribute '"+t+"' is repeated.",g(r[e]));s[t]=1}return!0}function c(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let i=/\d/;for("x"===e[t]&&(t++,i=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(i))break}return-1}(e,++t);let i=0;for(;t<e.length;t++,i++)if(!(e[t].match(/\w/)&&i<20)){if(";"===e[t])break;return-1}return t}function h(e,t,i){return{err:{code:e,msg:t,line:i.line||i,col:i.col}}}function u(t){return e.isName(t)}function p(e,t){const i=e.substring(0,t).split(/\r?\n/);return{line:i.length,col:i[i.length-1].length+1}}function g(e){return e.startIndex+e[1].length}return ut}var ft,bt,_t,vt,wt,yt,Pt,At,St,Tt={};function Ct(){if(_t)return bt;_t=1;return bt=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}}function Et(){if(St)return At;St=1;const e=gt(),t=Ct(),i=function(){if(wt)return vt;wt=1;const e=gt();function t(e,t){let i="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)i+=e[t];if(i=i.trim(),-1!==i.indexOf(" "))throw new Error("External entites are not supported");const r=e[t++];let s="";for(;t<e.length&&e[t]!==r;t++)s+=e[t];return[i,s,t]}function i(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function r(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function s(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function n(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function o(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function a(t){if(e.isName(t))return t;throw new Error(`Invalid entity name ${t}`)}return vt=function(e,l){const d={};if("O"!==e[l+3]||"C"!==e[l+4]||"T"!==e[l+5]||"Y"!==e[l+6]||"P"!==e[l+7]||"E"!==e[l+8])throw new Error("Invalid Tag instead of DOCTYPE");{l+=9;let c=1,h=!1,u=!1,p="";for(;l<e.length;l++)if("<"!==e[l]||u)if(">"===e[l]){if(u?"-"===e[l-1]&&"-"===e[l-2]&&(u=!1,c--):c--,0===c)break}else"["===e[l]?h=!0:p+=e[l];else{if(h&&r(e,l))l+=7,[entityName,val,l]=t(e,l+1),-1===val.indexOf("&")&&(d[a(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(h&&s(e,l))l+=8;else if(h&&n(e,l))l+=8;else if(h&&o(e,l))l+=9;else{if(!i)throw new Error("Invalid DOCTYPE");u=!0}c++,p=""}if(0!==c)throw new Error("Unclosed DOCTYPE")}return{entities:d,i:l}}}(),r=function(){if(Pt)return yt;Pt=1;const e=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const i={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};return yt=function(r,s={}){if(s=Object.assign({},i,s),!r||"string"!=typeof r)return r;let n=r.trim();if(void 0!==s.skipLike&&s.skipLike.test(n))return r;if(s.hex&&e.test(n))return Number.parseInt(n,16);{const e=t.exec(n);if(e){const t=e[1],i=e[2];let a=(o=e[3])&&-1!==o.indexOf(".")?("."===(o=o.replace(/0+$/,""))?o="0":"."===o[0]?o="0"+o:"."===o[o.length-1]&&(o=o.substr(0,o.length-1)),o):o;const l=e[4]||e[6];if(!s.leadingZeros&&i.length>0&&t&&"."!==n[2])return r;if(!s.leadingZeros&&i.length>0&&!t&&"."!==n[1])return r;{const e=Number(n),o=""+e;return-1!==o.search(/[eE]/)||l?s.eNotation?e:r:-1!==n.indexOf(".")?"0"===o&&""===a||o===a||t&&o==="-"+a?e:r:i?a===o||t+a===o?e:r:n===o||n===t+o?e:r}}return r}var o}}();function s(e){const t=Object.keys(e);for(let i=0;i<t.length;i++){const r=t[i];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function n(e,t,i,r,s,n,o){if(void 0!==e&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const r=this.options.tagValueProcessor(t,e,i,s,n);if(null==r)return e;if(typeof r!=typeof e||r!==e)return r;if(this.options.trimValues)return b(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?b(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function o(e){if(this.options.removeNSPrefix){const t=e.split(":"),i="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=i+t[1])}return e}const a=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function l(t,i,r){if(!this.options.ignoreAttributes&&"string"==typeof t){const r=e.getAllMatches(t,a),s=r.length,n={};for(let e=0;e<s;e++){const t=this.resolveNameSpace(r[e][1]);let s=r[e][4],o=this.options.attributeNamePrefix+t;if(t.length)if(this.options.transformAttributeName&&(o=this.options.transformAttributeName(o)),"__proto__"===o&&(o="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(t,s,i);n[o]=null==e?s:typeof e!=typeof s||e!==s?e:b(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[o]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=n,e}return n}}const d=function(e){e=e.replace(/\r\n?/g,"\n");const r=new t("!xml");let s=r,n="",o="";for(let a=0;a<e.length;a++){if("<"===e[a])if("/"===e[a+1]){const t=g(e,">",a,"Closing Tag is not closed.");let i=e.substring(a+2,t).trim();if(this.options.removeNSPrefix){const e=i.indexOf(":");-1!==e&&(i=i.substr(e+1))}this.options.transformTagName&&(i=this.options.transformTagName(i)),s&&(n=this.saveTextToParentTag(n,s,o));const r=o.substring(o.lastIndexOf(".")+1);if(i&&-1!==this.options.unpairedTags.indexOf(i))throw new Error(`Unpaired tag can not be used as closing tag: </${i}>`);let l=0;r&&-1!==this.options.unpairedTags.indexOf(r)?(l=o.lastIndexOf(".",o.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=o.lastIndexOf("."),o=o.substring(0,l),s=this.tagsNodeStack.pop(),n="",a=t}else if("?"===e[a+1]){let i=m(e,a,!1,"?>");if(!i)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,s,o),this.options.ignoreDeclaration&&"?xml"===i.tagName||this.options.ignorePiTags);else{const e=new t(i.tagName);e.add(this.options.textNodeName,""),i.tagName!==i.tagExp&&i.attrExpPresent&&(e[":@"]=this.buildAttributesMap(i.tagExp,o,i.tagName)),this.addChild(s,e,o)}a=i.closeIndex+1}else if("!--"===e.substr(a+1,3)){const t=g(e,"--\x3e",a+4,"Comment is not closed.");if(this.options.commentPropName){const i=e.substring(a+4,t-2);n=this.saveTextToParentTag(n,s,o),s.add(this.options.commentPropName,[{[this.options.textNodeName]:i}])}a=t}else if("!D"===e.substr(a+1,2)){const t=i(e,a);this.docTypeEntities=t.entities,a=t.i}else if("!["===e.substr(a+1,2)){const t=g(e,"]]>",a,"CDATA is not closed.")-2,i=e.substring(a+9,t);if(n=this.saveTextToParentTag(n,s,o),this.options.cdataPropName)s.add(this.options.cdataPropName,[{[this.options.textNodeName]:i}]);else{let e=this.parseTextData(i,s.tagname,o,!0,!1,!0);null==e&&(e=""),s.add(this.options.textNodeName,e)}a=t+2}else{let i=m(e,a,this.options.removeNSPrefix),l=i.tagName;const d=i.rawTagName;let c=i.tagExp,h=i.attrExpPresent,u=i.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),s&&n&&"!xml"!==s.tagname&&(n=this.saveTextToParentTag(n,s,o,!1));const p=s;if(p&&-1!==this.options.unpairedTags.indexOf(p.tagname)&&(s=this.tagsNodeStack.pop(),o=o.substring(0,o.lastIndexOf("."))),l!==r.tagname&&(o+=o?"."+l:l),this.isItStopNode(this.options.stopNodes,o,l)){let r="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)a=i.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(l))a=i.closeIndex;else{const t=this.readStopNodeData(e,d,u+1);if(!t)throw new Error(`Unexpected end of ${d}`);a=t.i,r=t.tagContent}const n=new t(l);l!==c&&h&&(n[":@"]=this.buildAttributesMap(c,o,l)),r&&(r=this.parseTextData(r,l,o,!0,h,!0,!0)),o=o.substr(0,o.lastIndexOf(".")),n.add(this.options.textNodeName,r),this.addChild(s,n,o)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){"/"===l[l.length-1]?(l=l.substr(0,l.length-1),o=o.substr(0,o.length-1),c=l):c=c.substr(0,c.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));const e=new t(l);l!==c&&h&&(e[":@"]=this.buildAttributesMap(c,o,l)),this.addChild(s,e,o),o=o.substr(0,o.lastIndexOf("."))}else{const e=new t(l);this.tagsNodeStack.push(s),l!==c&&h&&(e[":@"]=this.buildAttributesMap(c,o,l)),this.addChild(s,e,o),s=e}n="",a=u}}else n+=e[a]}return r.child};function c(e,t,i){const r=this.options.updateTag(t.tagname,i,t[":@"]);!1===r||("string"==typeof r?(t.tagname=r,e.addChild(t)):e.addChild(t))}const h=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const i=this.docTypeEntities[t];e=e.replace(i.regx,i.val)}for(let t in this.lastEntities){const i=this.lastEntities[t];e=e.replace(i.regex,i.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const i=this.htmlEntities[t];e=e.replace(i.regex,i.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function u(e,t,i,r){return e&&(void 0===r&&(r=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,i,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,r))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function p(e,t,i){const r="*."+i;for(const i in e){const s=e[i];if(r===s||t===s)return!0}return!1}function g(e,t,i,r){const s=e.indexOf(t,i);if(-1===s)throw new Error(r);return s+t.length-1}function m(e,t,i,r=">"){const s=function(e,t,i=">"){let r,s="";for(let n=t;n<e.length;n++){let t=e[n];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else if(t===i[0]){if(!i[1])return{data:s,index:n};if(e[n+1]===i[1])return{data:s,index:n}}else"\t"===t&&(t=" ");s+=t}}(e,t+1,r);if(!s)return;let n=s.data;const o=s.index,a=n.search(/\s/);let l=n,d=!0;-1!==a&&(l=n.substring(0,a),n=n.substring(a+1).trimStart());const c=l;if(i){const e=l.indexOf(":");-1!==e&&(l=l.substr(e+1),d=l!==s.data.substr(e+1))}return{tagName:l,tagExp:n,closeIndex:o,attrExpPresent:d,rawTagName:c}}function f(e,t,i){const r=i;let s=1;for(;i<e.length;i++)if("<"===e[i])if("/"===e[i+1]){const n=g(e,">",i,`${t} is not closed`);if(e.substring(i+2,n).trim()===t&&(s--,0===s))return{tagContent:e.substring(r,i),i:n};i=n}else if("?"===e[i+1]){i=g(e,"?>",i+1,"StopNode is not closed.")}else if("!--"===e.substr(i+1,3)){i=g(e,"--\x3e",i+3,"StopNode is not closed.")}else if("!["===e.substr(i+1,2)){i=g(e,"]]>",i,"StopNode is not closed.")-2}else{const r=m(e,i,">");if(r){(r&&r.tagName)===t&&"/"!==r.tagExp[r.tagExp.length-1]&&s++,i=r.closeIndex}}}function b(t,i,s){if(i&&"string"==typeof t){const e=t.trim();return"true"===e||"false"!==e&&r(t,s)}return e.isExist(t)?t:""}return At=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:""},pound:{regex:/&(pound|#163);/g,val:""},yen:{regex:/&(yen|#165);/g,val:""},euro:{regex:/&(euro|#8364);/g,val:""},copyright:{regex:/&(copy|#169);/g,val:""},reg:{regex:/&(reg|#174);/g,val:""},inr:{regex:/&(inr|#8377);/g,val:""}},this.addExternalEntities=s,this.parseXml=d,this.parseTextData=n,this.resolveNameSpace=o,this.buildAttributesMap=l,this.isItStopNode=p,this.replaceEntitiesValue=h,this.readStopNodeData=f,this.saveTextToParentTag=u,this.addChild=c}}}var Rt,kt,xt,Nt,Ot,It,Mt,Vt,Dt,Ft={};function Bt(){if(Rt)return Ft;function e(s,n,o){let a;const l={};for(let d=0;d<s.length;d++){const c=s[d],h=t(c);let u="";if(u=void 0===o?h:o+"."+h,h===n.textNodeName)void 0===a?a=c[h]:a+=""+c[h];else{if(void 0===h)continue;if(c[h]){let t=e(c[h],n,u);const s=r(t,n);c[":@"]?i(t,c[":@"],u,n):1!==Object.keys(t).length||void 0===t[n.textNodeName]||n.alwaysCreateTextNode?0===Object.keys(t).length&&(n.alwaysCreateTextNode?t[n.textNodeName]="":t=""):t=t[n.textNodeName],void 0!==l[h]&&l.hasOwnProperty(h)?(Array.isArray(l[h])||(l[h]=[l[h]]),l[h].push(t)):n.isArray(h,u,s)?l[h]=[t]:l[h]=t}}}return"string"==typeof a?a.length>0&&(l[n.textNodeName]=a):void 0!==a&&(l[n.textNodeName]=a),l}function t(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const i=t[e];if(":@"!==i)return i}}function i(e,t,i,r){if(t){const s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){const n=s[o];r.isArray(n,i+"."+n,!0,!0)?e[n]=[t[n]]:e[n]=t[n]}}}function r(e,t){const{textNodeName:i}=t,r=Object.keys(e).length;return 0===r||!(1!==r||!e[i]&&"boolean"!=typeof e[i]&&0!==e[i])}return Rt=1,Ft.prettify=function(t,i){return e(t,i)},Ft}function Ut(){if(xt)return kt;xt=1;const{buildOptions:e}=function(){if(ft)return Tt;ft=1;const e={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,i){return e}};return Tt.buildOptions=function(t){return Object.assign({},e,t)},Tt.defaultOptions=e,Tt}(),t=Et(),{prettify:i}=Bt(),r=mt();return kt=class{constructor(t){this.externalEntities={},this.options=e(t)}parse(e,s){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(s){!0===s&&(s={});const t=r.validate(e,s);if(!0!==t)throw Error(`${t.err.msg}:${t.err.line}:${t.err.col}`)}const n=new t(this.options);n.addExternalEntities(this.externalEntities);const o=n.parseXml(e);return this.options.preserveOrder||void 0===o?o:i(o,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}}}function $t(){if(Ot)return Nt;Ot=1;function e(n,o,a,l){let d="",c=!1;for(let h=0;h<n.length;h++){const u=n[h],p=t(u);if(void 0===p)continue;let g="";if(g=0===a.length?p:`${a}.${p}`,p===o.textNodeName){let e=u[p];r(g,o)||(e=o.tagValueProcessor(p,e),e=s(e,o)),c&&(d+=l),d+=e,c=!1;continue}if(p===o.cdataPropName){c&&(d+=l),d+=`<![CDATA[${u[p][0][o.textNodeName]}]]>`,c=!1;continue}if(p===o.commentPropName){d+=l+`\x3c!--${u[p][0][o.textNodeName]}--\x3e`,c=!0;continue}if("?"===p[0]){const e=i(u[":@"],o),t="?xml"===p?"":l;let r=u[p][0][o.textNodeName];r=0!==r.length?" "+r:"",d+=t+`<${p}${r}${e}?>`,c=!0;continue}let m=l;""!==m&&(m+=o.indentBy);const f=l+`<${p}${i(u[":@"],o)}`,b=e(u[p],o,g,m);-1!==o.unpairedTags.indexOf(p)?o.suppressUnpairedNode?d+=f+">":d+=f+"/>":b&&0!==b.length||!o.suppressEmptyNode?b&&b.endsWith(">")?d+=f+`>${b}${l}</${p}>`:(d+=f+">",b&&""!==l&&(b.includes("/>")||b.includes("</"))?d+=l+o.indentBy+b+l:d+=b,d+=`</${p}>`):d+=f+"/>",c=!0}return d}function t(e){const t=Object.keys(e);for(let i=0;i<t.length;i++){const r=t[i];if(e.hasOwnProperty(r)&&":@"!==r)return r}}function i(e,t){let i="";if(e&&!t.ignoreAttributes)for(let r in e){if(!e.hasOwnProperty(r))continue;let n=t.attributeValueProcessor(r,e[r]);n=s(n,t),!0===n&&t.suppressBooleanAttributes?i+=` ${r.substr(t.attributeNamePrefix.length)}`:i+=` ${r.substr(t.attributeNamePrefix.length)}="${n}"`}return i}function r(e,t){let i=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let r in t.stopNodes)if(t.stopNodes[r]===e||t.stopNodes[r]==="*."+i)return!0;return!1}function s(e,t){if(e&&e.length>0&&t.processEntities)for(let i=0;i<t.entities.length;i++){const r=t.entities[i];e=e.replace(r.regex,r.val)}return e}return Nt=function(t,i){let r="";return i.format&&i.indentBy.length>0&&(r="\n"),e(t,i,"",r)}}var Lt=function(){if(Dt)return Vt;Dt=1;const e=mt(),t=Ut(),i=function(){if(Mt)return It;Mt=1;const e=$t(),t={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function i(e){this.options=Object.assign({},t,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=n),this.processTextOrObjNode=r,this.options.format?(this.indentate=s,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function r(e,t,i){const r=this.j2x(e,i+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,r.attrStr,i):this.buildObjectNode(r.val,t,r.attrStr,i)}function s(e){return this.options.indentBy.repeat(e)}function n(e){return!(!e.startsWith(this.options.attributeNamePrefix)||e===this.options.textNodeName)&&e.substr(this.attrPrefixLen)}return i.prototype.build=function(t){return this.options.preserveOrder?e(t,this.options):(Array.isArray(t)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t={[this.options.arrayNodeName]:t}),this.j2x(t,0).val)},i.prototype.j2x=function(e,t){let i="",r="";for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s))if(void 0===e[s])this.isAttribute(s)&&(r+="");else if(null===e[s])this.isAttribute(s)?r+="":"?"===s[0]?r+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)r+=this.buildTextValNode(e[s],s,"",t);else if("object"!=typeof e[s]){const n=this.isAttribute(s);if(n)i+=this.buildAttrPairStr(n,""+e[s]);else if(s===this.options.textNodeName){let t=this.options.tagValueProcessor(s,""+e[s]);r+=this.replaceEntitiesValue(t)}else r+=this.buildTextValNode(e[s],s,"",t)}else if(Array.isArray(e[s])){const i=e[s].length;let n="";for(let o=0;o<i;o++){const i=e[s][o];void 0===i||(null===i?"?"===s[0]?r+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+s+"/"+this.tagEndChar:"object"==typeof i?this.options.oneListGroup?n+=this.j2x(i,t+1).val:n+=this.processTextOrObjNode(i,s,t):n+=this.buildTextValNode(i,s,"",t))}this.options.oneListGroup&&(n=this.buildObjectNode(n,s,"",t)),r+=n}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){const t=Object.keys(e[s]),r=t.length;for(let n=0;n<r;n++)i+=this.buildAttrPairStr(t[n],""+e[s][t[n]])}else r+=this.processTextOrObjNode(e[s],s,t);return{attrStr:i,val:r}},i.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},i.prototype.buildObjectNode=function(e,t,i,r){if(""===e)return"?"===t[0]?this.indentate(r)+"<"+t+i+"?"+this.tagEndChar:this.indentate(r)+"<"+t+i+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,n="";return"?"===t[0]&&(n="?",s=""),!i&&""!==i||-1!==e.indexOf("<")?!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===n.length?this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(r)+"<"+t+i+n+this.tagEndChar+e+this.indentate(r)+s:this.indentate(r)+"<"+t+i+n+">"+e+s}},i.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},i.prototype.buildTextValNode=function(e,t,i,r){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(r)+"<"+t+i+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,e);return s=this.replaceEntitiesValue(s),""===s?this.indentate(r)+"<"+t+i+this.closeTag(t)+this.tagEndChar:this.indentate(r)+"<"+t+i+">"+s+"</"+t+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const i=this.options.entities[t];e=e.replace(i.regex,i.val)}return e},It=i}();return Vt={XMLParser:t,XMLValidator:e,XMLBuilder:i}}();class Wt{constructor(e,t,i,r){this.message=e,this.code=t,this.severity=i,this.type=r}}const qt=101,zt=102,Ht=103,Jt=104,Yt=105,jt=106,Kt=107,Gt=108,Zt={UnexpectedSetUp:250,InvalidSetUp:251,InvalidProgressValue:252,InvalidCloseValue:253,InvalidProgressContext:254,InvalidCloseContext:255},Xt=300,Qt="vast_parser_failure",ei="ad_progress_tracking_error";class ti{static getVastValidateError(){return new Wt("Could not validate VAST xml",qt,4,Qt)}static getVastNoAdsAvailableError(){return new Wt("No ad available",zt,0,Qt)}static getVastAdWithWrapperError(){return new Wt("Ad without wrapper tag received",Ht,0,Qt)}static getVastEmptyTagError(){return new Wt("Vast tag returned empty. Proxy error.",Jt,0,Qt)}static getVastParseError(){return new Wt("XML Parser threw an error",Gt,0,Qt)}static getVastEmptyExtensionError(){return new Wt("Ad without extension tag received",Yt,0,Qt)}static getVastAdWithExtensionsError(){return new Wt("Ad without extenstions tag received",jt,0,Qt)}static getVastNonHyprMxExtensionError(){return new Wt("Ad without HyprMx extension attribute received",Kt,0,Qt)}static getAdProgressInvalidSetUpError(e,t,i,r){return new Wt(`Invalid call to AdProgressTracking.setUpTracking with viewingID: ${e} distributorID: ${t} userID: ${i} offerType: ${r}`,Zt.InvalidSetUp,3,ei)}static getAdProgressUpdateError(e,t){return new Wt(e,t,3,ei)}static getBannerContainerSizeMismatchedError(e){return new Wt(e,Xt,3,"banner_error")}}class ii{constructor(e){n(e)?(this.lastError=ti.getVastValidateError(),this.adJson={}):this.adJson=this.parseXML(e)??{}}parseXML(e){const t={attributeNamePrefix:"",textNodeName:"value",ignoreDeclaration:!0,ignoreAttributes:!1,allowBooleanAttributes:!0,parseAttributeValue:!0,removeNSPrefix:!0,transformAttributeName:e=>e.replace("-","_")};if(n(e)||!0!==Lt.XMLValidator.validate(e,t))return this.lastError=ti.getVastValidateError(),{};let i;try{i=new Lt.XMLParser(t).parse(e)}catch(e){return this.lastError=ti.getVastParseError(),{}}return void 0===i.VAST?this.lastError=ti.getVastEmptyTagError():void 0===i.VAST.Ad?this.lastError=ti.getVastNoAdsAvailableError():void 0===i.VAST.Ad.Wrapper?this.lastError=ti.getVastAdWithWrapperError():void 0===i.VAST.Ad.Wrapper.Extensions&&(this.lastError=ti.getVastAdWithExtensionsError()),i}getVastExtension(e){const t=this.adJson?.VAST?.Ad?.Wrapper?.Extensions?.Extension;let i=null;return void 0===t?i=ti.getVastEmptyExtensionError():t.type!==e&&(i=ti.getVastNonHyprMxExtensionError()),[t,i]}getPrequalExtension(e="HyprMX"){const[t,i]=this.getVastExtension(e);return null!==i?(this.lastError=this.lastError??i,{}):{id:this.adJson?.VAST?.Ad?.id,pre_qual:t?.PreQual??{}}}getFullScreenExtension(e="HyprMX"){const[t,i]=this.getVastExtension(e);if(null!==i)return this.lastError=this.lastError??i,{};const r={id:this.adJson?.VAST?.Ad?.id},s={Display:ii.buildDisplayExtension,WebTraffic:ii.buildWebTrafficExtension,Mraid:ii.buildMraidExtension,Vpaid:ii.buildVpaidExtension};for(const[e,i]of Object.entries(s))void 0!==t[e]&&i(t[e],r);return void 0!==t.Reward&&ii.buildReward(t.Reward,r),r}getBannerExtension(e="HyprMX"){const[t,i]=this.getVastExtension(e);if(null!==i)return this.lastError=this.lastError??i,{error:this.lastError,bannerExtensions:{}};return{bannerExtensions:{time_on_site_url:t?.TimeOnSiteUrl,click_reporting_url:t?.ClickTrackingUrl},clickMode:t?.Banner?.click_mode}}static buildDisplayExtension(e,t){ii.buildCommonExtension(e,t,f)}static buildVpaidExtension(e,t){ii.buildCommonExtension(e,t,b)}static buildMraidExtension(e,t){ii.buildCommonExtension(e,t,p),t.ttl=e.ttl}static buildWebTrafficExtension(e,t){ii.buildCommonExtension(e,t,g),t.title=e.title,t.skip_proscenium=!1,t.skip_thank_you_screen=!0}static buildCommonExtension(e,t,i){t.allowed_orientation=e.orientation||"all",t.type=e.type??i,t.offer_initiation_timeout_in_seconds=e.timeout,t.click={mode:e.click_mode}}static buildReward(e,t){t.reward=e&&"object"==typeof e?{reward_id:e.id??null,reward_quantity:e.quantity??0,reward_text:e.value??""}:{}}}class ri extends lt{async loadAd(e){console.log(`[FSBL] bidResponseData is ${JSON.stringify(e)}`);const t=new ii(e);t.lastError&&console.log(`Ad VAST parse produced error: ${JSON.stringify(t.lastError)}`);const i=t.getFullScreenExtension();console.log(`[FSBL] adJson is ${JSON.stringify(i)}`);return{ad:at(i,e),required_information:[],ui_components:void 0}}}const si="consentChanged";class ni extends ae{constructor(e,t,i,r,s,n=void 0,o=globalThis.HYPRNetworkController,a=globalThis.HYPRTimerController,l=globalThis.consentController,d=HYPRRequestParameterManager){super(e,t,i,r,s,o,a,l,d),this.refreshRequest=void 0,this.canShowFor=void 0,this.cancellationDialog=n}async loadAd(e){if(console.debug(`[FSP] Loading ads for ${this.name}`),this.refreshInProgress())return void console.debug(`[FSP] Refresh in progress for  ${this.name}`);void 0!==this.secondaryRefreshInfo&&(console.error(`[FSP] Load ad started with a secondaryRefreshInfo still set: ${JSON.stringify(this.secondaryRefreshInfo)}`),this.secondaryRefreshInfo=void 0),this.ad?.appendRequestData(e,!0),this.clearAdAndStopAdAvailableTimer(),console.debug(`[FSP] Loading ads for ${this}`),this.inventoryCheck?.cancel();const t=new dt(this.id,this.inventoryCheckURL);this.inventoryCheck=t;const{ad:i,required_information:r,ui_components:s,error:n}=await t.loadAd(e,this.requestParameterManager,this.networkRequestController);return n===L?(console.debug("[FSP] Request aborted"),{success:!1,error:n}):(this.inventoryCheck=void 0,this.inventoryCheckCallback(i,r,s),{success:this.isAdAvailable(),error:n})}async loadBidResponse(e){this.request&&(this.request.abort(),this.request=void 0),this.clearAdAndStopAdAvailableTimer();const{ad:t}={...await(new ri).loadAd(e)};return this.ad=t,this.isAdAvailable()&&this.startAdAvailableTimer(),{success:this.isAdAvailable()}}inventoryCheckCallback(e,t=[],i=void 0){this.inventoryCheck=void 0,this.ad=e,this.required_information=t,void 0!==i&&(this.ui_components=i),this.isAdAvailable()&&this.startAdAvailableTimer()}isAdAvailable(){return this.hasRequiredInformation()||void 0!==this.ad&&this.ad.hasAd()}startAdAvailableTimer(){this.canShowFor=globalThis.AVAILABLE_FOR,console.debug(`[FSP] FullScreenPlacement.startAdAvailableTimer(${this.name}) for ${this.canShowFor} seconds`),this.adAvailableTimer=this.timerController.startTimer(1e3*this.canShowFor,(()=>{this.clearAdAndStopAdAvailableTimer(!0)}))}stopAdAvailableTimer(){this.adAvailableTimerIsActive()&&(console.debug(`[FSP] FullScreenPlacement.stopAdAvailableTimer(${this.name})`),this.timerController.stopTimer(this.adAvailableTimer),this.canShowFor=void 0,this.adAvailableTimer=void 0)}clearAd(){console.debug(`[FSP] FullScreenPlacement.clearAd(${this.name})`),this.ad=void 0,this.required_information=void 0,this.ui_components=void 0}clearRequiredInfo(){this.required_information=void 0}compileRequestParamsFromParams(e={},t=!0,i=this.ad){const r=super.compileRequestParamsFromParams(e,t,i);return i?.appendRequestData(r,t),this.requestParameterManager.getInventoryCheckParams(r)}popAdData(){const{ad:e}=this,t=this.required_information||[],i=this.ui_components;return this.clearAdAndStopAdAvailableTimer(),{ad:e,requiredInfo:t,uiComponents:i}}clearAdAndStopAdAvailableTimer(e=!1){console.debug(`[FSP] FullScreenPlacement.clearAdAndStopTimer(${this.name})`),void 0!==this.request&&(this.networkRequestController.abortRequest(this.request),this.request=void 0),this.stopAdAvailableTimer(),this.clearAd(),this.placementListener&&!this.refreshInProgress()&&e&&this.placementListener.onPlacementAdExpired(this)}adImpression(){this.placementListener.adImpression?.(this)}handleRefresh(e,t){if(this.adAvailableTimerIsActive())if(void 0===this.ad?.bidResponse){if(this.refreshInProgress()){console.debug(`[FSP] Refresh in progress for placement ${this.name} with request ${this.refreshRequest}`);const t=void 0!==this.secondaryRefreshInfo?this.secondaryRefreshInfo.context:"",i={};return i.context=t===si?si:e,void(this.secondaryRefreshInfo=i)}console.debug(`[FSP] Refresh started for placement: ${this} with context: ${e}`),e===si&&this.clearAd(),this.clearRequiredInfo(),this.refreshAd(t)}else console.debug(`[FSP] Skipping refresh for placement ${this.name} because it was loaded from a bid`)}async refreshAd(e){this.ad?.appendRequestData(e,!0),console.debug(`[FSP] refresh params are: ${JSON.stringify(e)}`);const t=new dt(this.id,this.inventoryCheckURL);this.refreshRequest=t;const{ad:i,required_information:r,ui_components:s,error:n}=await t.loadAd(e,this.requestParameterManager,this.networkRequestController);this.refreshAdCallback(i,r,s,n)}refreshAdCallback(e,t,i,r){r?console.debug(`[FSP] Refresh failed for placement: ${this} with error ${r}`):console.debug(`[FSP] Refresh completed for placement: ${this}`),this.refreshRequest=void 0;const s=void 0!==e,n=s?e.getAdIdentifier():"";if(s)this.ad=e,this.required_information=t||[],void 0!==i&&(this.ui_components=i),console.debug(`[FSP] ${n.length>0?`Refreshed with ad id: ${n}. `:"Refreshed with new RequiredInfo. "}Restarted timer.`),this.stopAdAvailableTimer(),this.startAdAvailableTimer();else{if(!this.adAvailableTimerIsActive())return console.debug("[FSP] Refreshed completed with no ad and timer has ended"),void this.placementListener.onPlacementAdExpired(this);console.debug(`[FSP] Refreshed completed with no new ad. Current ad id is: ${n}.  Timer still active.`)}this.placementListener.onRefreshAdResponse(this,r),this.secondaryRefreshInfo&&(console.debug(`[FSP] Starting secondary refresh for Context: ${this.secondaryRefreshInfo.context}`),this.placementListener.startAdRefresh(this.secondaryRefreshInfo.context,this.name),this.secondaryRefreshInfo=void 0)}refreshInProgress(){return void 0!==this.refreshRequest}adAvailableTimerIsActive(){return void 0!==this.adAvailableTimer}hasRequiredInformation(){return void 0!==this.required_information&&this.required_information.length>0}hasUIComponents(){return void 0!==this.ui_components&&Object.keys(this.ui_components).length>0}getAdType(){return void 0!==this.ad?this.ad?.getAdType():super.getAdType()}getOfferName(){return void 0!==this.ad?this.ad?.getOfferName():super.getOfferName()}getRequiredInfoString(){return this.hasRequiredInformation()?JSON.stringify(this.required_information):"[]"}getUIComponentsString(){const e=this.hasUIComponents()?this.ui_components:globalThis.defaultUIComponents;return void 0===e.no_ad&&(e.no_ad=ni.noAdDefaultUI()),JSON.stringify(e)}static noAdDefaultUI(){const e={title:"This ad is not available based on your response. Close to continue.",title_color:"282828",title_size:16};return e}toString(){return`${super.toString()}, isAdAvailable=${this.isAdAvailable()}, canShowFor=${this.canShowFor}]`}}const oi="3.7.7",ai=oi,li="function"==typeof Buffer,di="function"==typeof TextDecoder?new TextDecoder:void 0,ci="function"==typeof TextEncoder?new TextEncoder:void 0,hi=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),ui=(e=>{let t={};return e.forEach(((e,i)=>t[e]=i)),t})(hi),pi=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,gi=String.fromCharCode.bind(String),mi="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),fi=e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")),bi=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),_i=e=>{let t,i,r,s,n="";const o=e.length%3;for(let o=0;o<e.length;){if((i=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255||(s=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");t=i<<16|r<<8|s,n+=hi[t>>18&63]+hi[t>>12&63]+hi[t>>6&63]+hi[63&t]}return o?n.slice(0,o-3)+"===".substring(o):n},vi="function"==typeof btoa?e=>btoa(e):li?e=>Buffer.from(e,"binary").toString("base64"):_i,wi=li?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let i=0,r=e.length;i<r;i+=4096)t.push(gi.apply(null,e.subarray(i,i+4096)));return vi(t.join(""))},yi=(e,t=!1)=>t?fi(wi(e)):wi(e),Pi=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?gi(192|t>>>6)+gi(128|63&t):gi(224|t>>>12&15)+gi(128|t>>>6&63)+gi(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return gi(240|t>>>18&7)+gi(128|t>>>12&63)+gi(128|t>>>6&63)+gi(128|63&t)},Ai=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Si=e=>e.replace(Ai,Pi),Ti=li?e=>Buffer.from(e,"utf8").toString("base64"):ci?e=>wi(ci.encode(e)):e=>vi(Si(e)),Ci=(e,t=!1)=>t?fi(Ti(e)):Ti(e),Ei=e=>Ci(e,!0),Ri=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,ki=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return gi(55296+(t>>>10))+gi(56320+(1023&t));case 3:return gi((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return gi((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},xi=e=>e.replace(Ri,ki),Ni=e=>{if(e=e.replace(/\s+/g,""),!pi.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,i,r,s="";for(let n=0;n<e.length;)t=ui[e.charAt(n++)]<<18|ui[e.charAt(n++)]<<12|(i=ui[e.charAt(n++)])<<6|(r=ui[e.charAt(n++)]),s+=64===i?gi(t>>16&255):64===r?gi(t>>16&255,t>>8&255):gi(t>>16&255,t>>8&255,255&t);return s},Oi="function"==typeof atob?e=>atob(bi(e)):li?e=>Buffer.from(e,"base64").toString("binary"):Ni,Ii=li?e=>mi(Buffer.from(e,"base64")):e=>mi(Oi(e).split("").map((e=>e.charCodeAt(0)))),Mi=e=>Ii(Di(e)),Vi=li?e=>Buffer.from(e,"base64").toString("utf8"):di?e=>di.decode(Ii(e)):e=>xi(Oi(e)),Di=e=>bi(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))),Fi=e=>Vi(Di(e)),Bi=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),Ui=function(){const e=(e,t)=>Object.defineProperty(String.prototype,e,Bi(t));e("fromBase64",(function(){return Fi(this)})),e("toBase64",(function(e){return Ci(this,e)})),e("toBase64URI",(function(){return Ci(this,!0)})),e("toBase64URL",(function(){return Ci(this,!0)})),e("toUint8Array",(function(){return Mi(this)}))},$i=function(){const e=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,Bi(t));e("toBase64",(function(e){return yi(this,e)})),e("toBase64URI",(function(){return yi(this,!0)})),e("toBase64URL",(function(){return yi(this,!0)}))},Li={version:oi,VERSION:ai,atob:Oi,atobPolyfill:Ni,btoa:vi,btoaPolyfill:_i,fromBase64:Fi,toBase64:Ci,encode:Ci,encodeURI:Ei,encodeURL:Ei,utob:Si,btou:xi,decode:Fi,isValid:e=>{if("string"!=typeof e)return!1;const t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},fromUint8Array:yi,toUint8Array:Mi,extendString:Ui,extendUint8Array:$i,extendBuiltins:()=>{Ui(),$i()}};function Wi(e){let t=e.length;for(;--t>=0;)e[t]=0}const qi=256,zi=286,Hi=30,Ji=15,Yi=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ji=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ki=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Gi=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zi=new Array(576);Wi(Zi);const Xi=new Array(60);Wi(Xi);const Qi=new Array(512);Wi(Qi);const er=new Array(256);Wi(er);const tr=new Array(29);Wi(tr);const ir=new Array(Hi);function rr(e,t,i,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}let sr,nr,or;function ar(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Wi(ir);const lr=e=>e<256?Qi[e]:Qi[256+(e>>>7)],dr=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},cr=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,dr(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},hr=(e,t,i)=>{cr(e,i[2*t],i[2*t+1])},ur=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},pr=(e,t,i)=>{const r=new Array(16);let s,n,o=0;for(s=1;s<=Ji;s++)o=o+i[s-1]<<1,r[s]=o;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=ur(r[t]++,t))}},gr=e=>{let t;for(t=0;t<zi;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Hi;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},mr=e=>{e.bi_valid>8?dr(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},fr=(e,t,i,r)=>{const s=2*t,n=2*i;return e[s]<e[n]||e[s]===e[n]&&r[t]<=r[i]},br=(e,t,i)=>{const r=e.heap[i];let s=i<<1;for(;s<=e.heap_len&&(s<e.heap_len&&fr(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!fr(t,r,e.heap[s],e.depth));)e.heap[i]=e.heap[s],i=s,s<<=1;e.heap[i]=r},_r=(e,t,i)=>{let r,s,n,o,a=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+a++],r+=(255&e.pending_buf[e.sym_buf+a++])<<8,s=e.pending_buf[e.sym_buf+a++],0===r?hr(e,s,t):(n=er[s],hr(e,n+qi+1,t),o=Yi[n],0!==o&&(s-=tr[n],cr(e,s,o)),r--,n=lr(r),hr(e,n,i),o=ji[n],0!==o&&(r-=ir[n],cr(e,r,o)))}while(a<e.sym_next);hr(e,256,t)},vr=(e,t)=>{const i=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,n=t.stat_desc.elems;let o,a,l,d=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<n;o++)0!==i[2*o]?(e.heap[++e.heap_len]=d=o,e.depth[o]=0):i[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=d<2?++d:0,i[2*l]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=r[2*l+1]);for(t.max_code=d,o=e.heap_len>>1;o>=1;o--)br(e,i,o);l=n;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],br(e,i,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,i[2*l]=i[2*o]+i[2*a],e.depth[l]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,i[2*o+1]=i[2*a+1]=l,e.heap[1]=l++,br(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,r=t.max_code,s=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,l=t.stat_desc.max_length;let d,c,h,u,p,g,m=0;for(u=0;u<=Ji;u++)e.bl_count[u]=0;for(i[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)c=e.heap[d],u=i[2*i[2*c+1]+1]+1,u>l&&(u=l,m++),i[2*c+1]=u,c>r||(e.bl_count[u]++,p=0,c>=a&&(p=o[c-a]),g=i[2*c],e.opt_len+=g*(u+p),n&&(e.static_len+=g*(s[2*c+1]+p)));if(0!==m){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(u=l;0!==u;u--)for(c=e.bl_count[u];0!==c;)h=e.heap[--d],h>r||(i[2*h+1]!==u&&(e.opt_len+=(u-i[2*h+1])*i[2*h],i[2*h+1]=u),c--)}})(e,t),pr(i,d,e.bl_count)},wr=(e,t,i)=>{let r,s,n=-1,o=t[1],a=0,l=7,d=4;for(0===o&&(l=138,d=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)s=o,o=t[2*(r+1)+1],++a<l&&s===o||(a<d?e.bl_tree[2*s]+=a:0!==s?(s!==n&&e.bl_tree[2*s]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,n=s,0===o?(l=138,d=3):s===o?(l=6,d=3):(l=7,d=4))},yr=(e,t,i)=>{let r,s,n=-1,o=t[1],a=0,l=7,d=4;for(0===o&&(l=138,d=3),r=0;r<=i;r++)if(s=o,o=t[2*(r+1)+1],!(++a<l&&s===o)){if(a<d)do{hr(e,s,e.bl_tree)}while(0!=--a);else 0!==s?(s!==n&&(hr(e,s,e.bl_tree),a--),hr(e,16,e.bl_tree),cr(e,a-3,2)):a<=10?(hr(e,17,e.bl_tree),cr(e,a-3,3)):(hr(e,18,e.bl_tree),cr(e,a-11,7));a=0,n=s,0===o?(l=138,d=3):s===o?(l=6,d=3):(l=7,d=4)}};let Pr=!1;const Ar=(e,t,i,r)=>{cr(e,0+(r?1:0),3),mr(e),dr(e,i),dr(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var Sr=(e,t,i,r)=>{let s,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<qi;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),vr(e,e.l_desc),vr(e,e.d_desc),o=(e=>{let t;for(wr(e,e.dyn_ltree,e.l_desc.max_code),wr(e,e.dyn_dtree,e.d_desc.max_code),vr(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Gi[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=s&&(s=n)):s=n=i+5,i+4<=s&&-1!==t?Ar(e,t,i,r):4===e.strategy||n===s?(cr(e,2+(r?1:0),3),_r(e,Zi,Xi)):(cr(e,4+(r?1:0),3),((e,t,i,r)=>{let s;for(cr(e,t-257,5),cr(e,i-1,5),cr(e,r-4,4),s=0;s<r;s++)cr(e,e.bl_tree[2*Gi[s]+1],3);yr(e,e.dyn_ltree,t-1),yr(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),_r(e,e.dyn_ltree,e.dyn_dtree)),gr(e),r&&mr(e)},Tr={_tr_init:e=>{Pr||((()=>{let e,t,i,r,s;const n=new Array(16);for(i=0,r=0;r<28;r++)for(tr[r]=i,e=0;e<1<<Yi[r];e++)er[i++]=r;for(er[i-1]=r,s=0,r=0;r<16;r++)for(ir[r]=s,e=0;e<1<<ji[r];e++)Qi[s++]=r;for(s>>=7;r<Hi;r++)for(ir[r]=s<<7,e=0;e<1<<ji[r]-7;e++)Qi[256+s++]=r;for(t=0;t<=Ji;t++)n[t]=0;for(e=0;e<=143;)Zi[2*e+1]=8,e++,n[8]++;for(;e<=255;)Zi[2*e+1]=9,e++,n[9]++;for(;e<=279;)Zi[2*e+1]=7,e++,n[7]++;for(;e<=287;)Zi[2*e+1]=8,e++,n[8]++;for(pr(Zi,287,n),e=0;e<Hi;e++)Xi[2*e+1]=5,Xi[2*e]=ur(e,5);sr=new rr(Zi,Yi,257,zi,Ji),nr=new rr(Xi,ji,0,Hi,Ji),or=new rr(new Array(0),Ki,0,19,7)})(),Pr=!0),e.l_desc=new ar(e.dyn_ltree,sr),e.d_desc=new ar(e.dyn_dtree,nr),e.bl_desc=new ar(e.bl_tree,or),e.bi_buf=0,e.bi_valid=0,gr(e)},_tr_stored_block:Ar,_tr_flush_block:Sr,_tr_tally:(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(er[i]+qi+1)]++,e.dyn_dtree[2*lr(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{cr(e,2,3),hr(e,256,Zi),(e=>{16===e.bi_valid?(dr(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Cr=(e,t,i,r)=>{let s=65535&e|0,n=e>>>16&65535|0,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{s=s+t[r++]|0,n=n+s|0}while(--o);s%=65521,n%=65521}return s|n<<16|0};const Er=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var Rr=(e,t,i,r)=>{const s=Er,n=r+i;e^=-1;for(let i=r;i<n;i++)e=e>>>8^s[255&(e^t[i])];return-1^e},kr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},xr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Nr,_tr_stored_block:Or,_tr_flush_block:Ir,_tr_tally:Mr,_tr_align:Vr}=Tr,{Z_NO_FLUSH:Dr,Z_PARTIAL_FLUSH:Fr,Z_FULL_FLUSH:Br,Z_FINISH:Ur,Z_BLOCK:$r,Z_OK:Lr,Z_STREAM_END:Wr,Z_STREAM_ERROR:qr,Z_DATA_ERROR:zr,Z_BUF_ERROR:Hr,Z_DEFAULT_COMPRESSION:Jr,Z_FILTERED:Yr,Z_HUFFMAN_ONLY:jr,Z_RLE:Kr,Z_FIXED:Gr,Z_DEFAULT_STRATEGY:Zr,Z_UNKNOWN:Xr,Z_DEFLATED:Qr}=xr,es=258,ts=262,is=42,rs=113,ss=666,ns=(e,t)=>(e.msg=kr[t],t),os=e=>2*e-(e>4?9:0),as=e=>{let t=e.length;for(;--t>=0;)e[t]=0},ls=e=>{let t,i,r,s=e.w_size;t=e.hash_size,r=t;do{i=e.head[--r],e.head[r]=i>=s?i-s:0}while(--t);t=s,r=t;do{i=e.prev[--r],e.prev[r]=i>=s?i-s:0}while(--t)};let ds=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const cs=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},hs=(e,t)=>{Ir(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,cs(e.strm)},us=(e,t)=>{e.pending_buf[e.pending++]=t},ps=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},gs=(e,t,i,r)=>{let s=e.avail_in;return s>r&&(s=r),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),i),1===e.state.wrap?e.adler=Cr(e.adler,t,s,i):2===e.state.wrap&&(e.adler=Rr(e.adler,t,s,i)),e.next_in+=s,e.total_in+=s,s)},ms=(e,t)=>{let i,r,s=e.max_chain_length,n=e.strstart,o=e.prev_length,a=e.nice_match;const l=e.strstart>e.w_size-ts?e.strstart-(e.w_size-ts):0,d=e.window,c=e.w_mask,h=e.prev,u=e.strstart+es;let p=d[n+o-1],g=d[n+o];e.prev_length>=e.good_match&&(s>>=2),a>e.lookahead&&(a=e.lookahead);do{if(i=t,d[i+o]===g&&d[i+o-1]===p&&d[i]===d[n]&&d[++i]===d[n+1]){n+=2,i++;do{}while(d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&d[++n]===d[++i]&&n<u);if(r=es-(u-n),n=u-es,r>o){if(e.match_start=t,o=r,r>=a)break;p=d[n+o-1],g=d[n+o]}}}while((t=h[t&c])>l&&0!=--s);return o<=e.lookahead?o:e.lookahead},fs=e=>{const t=e.w_size;let i,r,s;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ts)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),ls(e),r+=t),0===e.strm.avail_in)break;if(i=gs(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=i,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=ds(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=ds(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ts&&0!==e.strm.avail_in)},bs=(e,t)=>{let i,r,s,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,a=e.strm.avail_in;do{if(i=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,r=e.strstart-e.block_start,i>r+e.strm.avail_in&&(i=r+e.strm.avail_in),i>s&&(i=s),i<n&&(0===i&&t!==Ur||t===Dr||i!==r+e.strm.avail_in))break;o=t===Ur&&i===r+e.strm.avail_in?1:0,Or(e,0,0,o),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,cs(e.strm),r&&(r>i&&(r=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,i-=r),i&&(gs(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(0===o);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Dr&&t!==Ur&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(gs(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,n=s>e.w_size?e.w_size:s,r=e.strstart-e.block_start,(r>=n||(r||t===Ur)&&t!==Dr&&0===e.strm.avail_in&&r<=s)&&(i=r>s?s:r,o=t===Ur&&0===e.strm.avail_in&&i===r?1:0,Or(e,e.block_start,i,o),e.block_start+=i,cs(e.strm)),o?3:1)},_s=(e,t)=>{let i,r;for(;;){if(e.lookahead<ts){if(fs(e),e.lookahead<ts&&t===Dr)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=ds(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-ts&&(e.match_length=ms(e,i)),e.match_length>=3)if(r=Mr(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ds(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ds(e,e.ins_h,e.window[e.strstart+1]);else r=Mr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(hs(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Ur?(hs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(hs(e,!1),0===e.strm.avail_out)?1:2},vs=(e,t)=>{let i,r,s;for(;;){if(e.lookahead<ts){if(fs(e),e.lookahead<ts&&t===Dr)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=ds(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-ts&&(e.match_length=ms(e,i),e.match_length<=5&&(e.strategy===Yr||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,r=Mr(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=ds(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(hs(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=Mr(e,0,e.window[e.strstart-1]),r&&hs(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=Mr(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Ur?(hs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(hs(e,!1),0===e.strm.avail_out)?1:2};function ws(e,t,i,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=s}const ys=[new ws(0,0,0,0,bs),new ws(4,4,8,4,_s),new ws(4,5,16,8,_s),new ws(4,6,32,32,_s),new ws(4,4,16,16,vs),new ws(8,16,32,32,vs),new ws(8,16,128,128,vs),new ws(8,32,128,256,vs),new ws(32,128,258,1024,vs),new ws(32,258,258,4096,vs)];function Ps(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Qr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),as(this.dyn_ltree),as(this.dyn_dtree),as(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),as(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),as(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const As=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==is&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==rs&&t.status!==ss?1:0},Ss=e=>{if(As(e))return ns(e,qr);e.total_in=e.total_out=0,e.data_type=Xr;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?is:rs,e.adler=2===t.wrap?0:1,t.last_flush=-2,Nr(t),Lr},Ts=e=>{const t=Ss(e);var i;return t===Lr&&((i=e.state).window_size=2*i.w_size,as(i.head),i.max_lazy_match=ys[i.level].max_lazy,i.good_match=ys[i.level].good_length,i.nice_match=ys[i.level].nice_length,i.max_chain_length=ys[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t},Cs=(e,t,i,r,s,n)=>{if(!e)return qr;let o=1;if(t===Jr&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),s<1||s>9||i!==Qr||r<8||r>15||t<0||t>9||n<0||n>Gr||8===r&&1!==o)return ns(e,qr);8===r&&(r=9);const a=new Ps;return e.state=a,a.strm=e,a.status=is,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=n,a.method=i,Ts(e)};var Es={deflateInit:(e,t)=>Cs(e,t,Qr,15,8,Zr),deflateInit2:Cs,deflateReset:Ts,deflateResetKeep:Ss,deflateSetHeader:(e,t)=>As(e)||2!==e.state.wrap?qr:(e.state.gzhead=t,Lr),deflate:(e,t)=>{if(As(e)||t>$r||t<0)return e?ns(e,qr):qr;const i=e.state;if(!e.output||0!==e.avail_in&&!e.input||i.status===ss&&t!==Ur)return ns(e,0===e.avail_out?Hr:qr);const r=i.last_flush;if(i.last_flush=t,0!==i.pending){if(cs(e),0===e.avail_out)return i.last_flush=-1,Lr}else if(0===e.avail_in&&os(t)<=os(r)&&t!==Ur)return ns(e,Hr);if(i.status===ss&&0!==e.avail_in)return ns(e,Hr);if(i.status===is&&0===i.wrap&&(i.status=rs),i.status===is){let t=Qr+(i.w_bits-8<<4)<<8,r=-1;if(r=i.strategy>=jr||i.level<2?0:i.level<6?1:6===i.level?2:3,t|=r<<6,0!==i.strstart&&(t|=32),t+=31-t%31,ps(i,t),0!==i.strstart&&(ps(i,e.adler>>>16),ps(i,65535&e.adler)),e.adler=1,i.status=rs,cs(e),0!==i.pending)return i.last_flush=-1,Lr}if(57===i.status)if(e.adler=0,us(i,31),us(i,139),us(i,8),i.gzhead)us(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),us(i,255&i.gzhead.time),us(i,i.gzhead.time>>8&255),us(i,i.gzhead.time>>16&255),us(i,i.gzhead.time>>24&255),us(i,9===i.level?2:i.strategy>=jr||i.level<2?4:0),us(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(us(i,255&i.gzhead.extra.length),us(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Rr(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(us(i,0),us(i,0),us(i,0),us(i,0),us(i,0),us(i,9===i.level?2:i.strategy>=jr||i.level<2?4:0),us(i,3),i.status=rs,cs(e),0!==i.pending)return i.last_flush=-1,Lr;if(69===i.status){if(i.gzhead.extra){let t=i.pending,r=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+r>i.pending_buf_size;){let s=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+s),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>t&&(e.adler=Rr(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex+=s,cs(e),0!==i.pending)return i.last_flush=-1,Lr;t=0,r-=s}let s=new Uint8Array(i.gzhead.extra);i.pending_buf.set(s.subarray(i.gzindex,i.gzindex+r),i.pending),i.pending+=r,i.gzhead.hcrc&&i.pending>t&&(e.adler=Rr(e.adler,i.pending_buf,i.pending-t,t)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let t,r=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>r&&(e.adler=Rr(e.adler,i.pending_buf,i.pending-r,r)),cs(e),0!==i.pending)return i.last_flush=-1,Lr;r=0}t=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,us(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>r&&(e.adler=Rr(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let t,r=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>r&&(e.adler=Rr(e.adler,i.pending_buf,i.pending-r,r)),cs(e),0!==i.pending)return i.last_flush=-1,Lr;r=0}t=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,us(i,t)}while(0!==t);i.gzhead.hcrc&&i.pending>r&&(e.adler=Rr(e.adler,i.pending_buf,i.pending-r,r))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(cs(e),0!==i.pending))return i.last_flush=-1,Lr;us(i,255&e.adler),us(i,e.adler>>8&255),e.adler=0}if(i.status=rs,cs(e),0!==i.pending)return i.last_flush=-1,Lr}if(0!==e.avail_in||0!==i.lookahead||t!==Dr&&i.status!==ss){let r=0===i.level?bs(i,t):i.strategy===jr?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(fs(e),0===e.lookahead)){if(t===Dr)return 1;break}if(e.match_length=0,i=Mr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(hs(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ur?(hs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(hs(e,!1),0===e.strm.avail_out)?1:2})(i,t):i.strategy===Kr?((e,t)=>{let i,r,s,n;const o=e.window;for(;;){if(e.lookahead<=es){if(fs(e),e.lookahead<=es&&t===Dr)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,r=o[s],r===o[++s]&&r===o[++s]&&r===o[++s])){n=e.strstart+es;do{}while(r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&s<n);e.match_length=es-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=Mr(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=Mr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(hs(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Ur?(hs(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(hs(e,!1),0===e.strm.avail_out)?1:2})(i,t):ys[i.level].func(i,t);if(3!==r&&4!==r||(i.status=ss),1===r||3===r)return 0===e.avail_out&&(i.last_flush=-1),Lr;if(2===r&&(t===Fr?Vr(i):t!==$r&&(Or(i,0,0,!1),t===Br&&(as(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),cs(e),0===e.avail_out))return i.last_flush=-1,Lr}return t!==Ur?Lr:i.wrap<=0?Wr:(2===i.wrap?(us(i,255&e.adler),us(i,e.adler>>8&255),us(i,e.adler>>16&255),us(i,e.adler>>24&255),us(i,255&e.total_in),us(i,e.total_in>>8&255),us(i,e.total_in>>16&255),us(i,e.total_in>>24&255)):(ps(i,e.adler>>>16),ps(i,65535&e.adler)),cs(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Lr:Wr)},deflateEnd:e=>{if(As(e))return qr;const t=e.state.status;return e.state=null,t===rs?ns(e,zr):Lr},deflateSetDictionary:(e,t)=>{let i=t.length;if(As(e))return qr;const r=e.state,s=r.wrap;if(2===s||1===s&&r.status!==is||r.lookahead)return qr;if(1===s&&(e.adler=Cr(e.adler,t,i,0)),r.wrap=0,i>=r.w_size){0===s&&(as(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(i-r.w_size,i),0),t=e,i=r.w_size}const n=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,fs(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=ds(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,fs(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=a,e.avail_in=n,r.wrap=s,Lr},deflateInfo:"pako deflate (from Nodeca project)"};const Rs=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ks={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)Rs(i,t)&&(e[t]=i[t])}}return e},flattenChunks:e=>{let t=0;for(let i=0,r=e.length;i<r;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,r=0,s=e.length;t<s;t++){let s=e[t];i.set(s,r),r+=s.length}return i}};let xs=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){xs=!1}const Ns=new Uint8Array(256);for(let e=0;e<256;e++)Ns[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Ns[254]=Ns[254]=1;var Os={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,r,s,n,o=e.length,a=0;for(s=0;s<o;s++)i=e.charCodeAt(s),55296==(64512&i)&&s+1<o&&(r=e.charCodeAt(s+1),56320==(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),s++)),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(a),n=0,s=0;n<a;s++)i=e.charCodeAt(s),55296==(64512&i)&&s+1<o&&(r=e.charCodeAt(s+1),56320==(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),s++)),i<128?t[n++]=i:i<2048?(t[n++]=192|i>>>6,t[n++]=128|63&i):i<65536?(t[n++]=224|i>>>12,t[n++]=128|i>>>6&63,t[n++]=128|63&i):(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63,t[n++]=128|i>>>6&63,t[n++]=128|63&i);return t},buf2string:(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,s;const n=new Array(2*i);for(s=0,r=0;r<i;){let t=e[r++];if(t<128){n[s++]=t;continue}let o=Ns[t];if(o>4)n[s++]=65533,r+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&r<i;)t=t<<6|63&e[r++],o--;o>1?n[s++]=65533:t<65536?n[s++]=t:(t-=65536,n[s++]=55296|t>>10&1023,n[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&xs)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let r=0;r<t;r++)i+=String.fromCharCode(e[r]);return i})(n,s)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+Ns[e[i]]>t?i:t}};var Is=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ms=Object.prototype.toString,{Z_NO_FLUSH:Vs,Z_SYNC_FLUSH:Ds,Z_FULL_FLUSH:Fs,Z_FINISH:Bs,Z_OK:Us,Z_STREAM_END:$s,Z_DEFAULT_COMPRESSION:Ls,Z_DEFAULT_STRATEGY:Ws,Z_DEFLATED:qs}=xr;function zs(e){this.options=ks.assign({level:Ls,method:qs,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ws},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Is,this.strm.avail_out=0;let i=Es.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==Us)throw new Error(kr[i]);if(t.header&&Es.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Os.string2buf(t.dictionary):"[object ArrayBuffer]"===Ms.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=Es.deflateSetDictionary(this.strm,e),i!==Us)throw new Error(kr[i]);this._dict_set=!0}}function Hs(e,t){const i=new zs(t);if(i.push(e,!0),i.err)throw i.msg||kr[i.err];return i.result}zs.prototype.push=function(e,t){const i=this.strm,r=this.options.chunkSize;let s,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Bs:Vs,"string"==typeof e?i.input=Os.string2buf(e):"[object ArrayBuffer]"===Ms.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),(n===Ds||n===Fs)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(s=Es.deflate(i,n),s===$s)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),s=Es.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Us;if(0!==i.avail_out){if(n>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},zs.prototype.onData=function(e){this.chunks.push(e)},zs.prototype.onEnd=function(e){e===Us&&(this.result=ks.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Js={Deflate:zs,deflate:Hs,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Hs(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Hs(e,t)},constants:xr};const Ys=16209;var js=function(e,t){let i,r,s,n,o,a,l,d,c,h,u,p,g,m,f,b,_,v,w,y,P,A,S,T;const C=e.state;i=e.next_in,S=e.input,r=i+(e.avail_in-5),s=e.next_out,T=e.output,n=s-(t-e.avail_out),o=s+(e.avail_out-257),a=C.dmax,l=C.wsize,d=C.whave,c=C.wnext,h=C.window,u=C.hold,p=C.bits,g=C.lencode,m=C.distcode,f=(1<<C.lenbits)-1,b=(1<<C.distbits)-1;e:do{p<15&&(u+=S[i++]<<p,p+=8,u+=S[i++]<<p,p+=8),_=g[u&f];t:for(;;){if(v=_>>>24,u>>>=v,p-=v,v=_>>>16&255,0===v)T[s++]=65535&_;else{if(!(16&v)){if(0==(64&v)){_=g[(65535&_)+(u&(1<<v)-1)];continue t}if(32&v){C.mode=16191;break e}e.msg="invalid literal/length code",C.mode=Ys;break e}w=65535&_,v&=15,v&&(p<v&&(u+=S[i++]<<p,p+=8),w+=u&(1<<v)-1,u>>>=v,p-=v),p<15&&(u+=S[i++]<<p,p+=8,u+=S[i++]<<p,p+=8),_=m[u&b];i:for(;;){if(v=_>>>24,u>>>=v,p-=v,v=_>>>16&255,!(16&v)){if(0==(64&v)){_=m[(65535&_)+(u&(1<<v)-1)];continue i}e.msg="invalid distance code",C.mode=Ys;break e}if(y=65535&_,v&=15,p<v&&(u+=S[i++]<<p,p+=8,p<v&&(u+=S[i++]<<p,p+=8)),y+=u&(1<<v)-1,y>a){e.msg="invalid distance too far back",C.mode=Ys;break e}if(u>>>=v,p-=v,v=s-n,y>v){if(v=y-v,v>d&&C.sane){e.msg="invalid distance too far back",C.mode=Ys;break e}if(P=0,A=h,0===c){if(P+=l-v,v<w){w-=v;do{T[s++]=h[P++]}while(--v);P=s-y,A=T}}else if(c<v){if(P+=l+c-v,v-=c,v<w){w-=v;do{T[s++]=h[P++]}while(--v);if(P=0,c<w){v=c,w-=v;do{T[s++]=h[P++]}while(--v);P=s-y,A=T}}}else if(P+=c-v,v<w){w-=v;do{T[s++]=h[P++]}while(--v);P=s-y,A=T}for(;w>2;)T[s++]=A[P++],T[s++]=A[P++],T[s++]=A[P++],w-=3;w&&(T[s++]=A[P++],w>1&&(T[s++]=A[P++]))}else{P=s-y;do{T[s++]=T[P++],T[s++]=T[P++],T[s++]=T[P++],w-=3}while(w>2);w&&(T[s++]=T[P++],w>1&&(T[s++]=T[P++]))}break}}break}}while(i<r&&s<o);w=p>>3,i-=w,p-=w<<3,u&=(1<<p)-1,e.next_in=i,e.next_out=s,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=s<o?o-s+257:257-(s-o),C.hold=u,C.bits=p};const Ks=15,Gs=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Zs=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Xs=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Qs=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var en=(e,t,i,r,s,n,o,a)=>{const l=a.bits;let d,c,h,u,p,g,m=0,f=0,b=0,_=0,v=0,w=0,y=0,P=0,A=0,S=0,T=null;const C=new Uint16Array(16),E=new Uint16Array(16);let R,k,x,N=null;for(m=0;m<=Ks;m++)C[m]=0;for(f=0;f<r;f++)C[t[i+f]]++;for(v=l,_=Ks;_>=1&&0===C[_];_--);if(v>_&&(v=_),0===_)return s[n++]=20971520,s[n++]=20971520,a.bits=1,0;for(b=1;b<_&&0===C[b];b++);for(v<b&&(v=b),P=1,m=1;m<=Ks;m++)if(P<<=1,P-=C[m],P<0)return-1;if(P>0&&(0===e||1!==_))return-1;for(E[1]=0,m=1;m<Ks;m++)E[m+1]=E[m]+C[m];for(f=0;f<r;f++)0!==t[i+f]&&(o[E[t[i+f]]++]=f);if(0===e?(T=N=o,g=20):1===e?(T=Gs,N=Zs,g=257):(T=Xs,N=Qs,g=0),S=0,f=0,m=b,p=n,w=v,y=0,h=-1,A=1<<v,u=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){R=m-y,o[f]+1<g?(k=0,x=o[f]):o[f]>=g?(k=N[o[f]-g],x=T[o[f]-g]):(k=96,x=0),d=1<<m-y,c=1<<w,b=c;do{c-=d,s[p+(S>>y)+c]=R<<24|k<<16|x|0}while(0!==c);for(d=1<<m-1;S&d;)d>>=1;if(0!==d?(S&=d-1,S+=d):S=0,f++,0==--C[m]){if(m===_)break;m=t[i+o[f]]}if(m>v&&(S&u)!==h){for(0===y&&(y=v),p+=b,w=m-y,P=1<<w;w+y<_&&(P-=C[w+y],!(P<=0));)w++,P<<=1;if(A+=1<<w,1===e&&A>852||2===e&&A>592)return 1;h=S&u,s[h]=v<<24|w<<16|p-n|0}}return 0!==S&&(s[p+S]=m-y<<24|64<<16|0),a.bits=v,0};const{Z_FINISH:tn,Z_BLOCK:rn,Z_TREES:sn,Z_OK:nn,Z_STREAM_END:on,Z_NEED_DICT:an,Z_STREAM_ERROR:ln,Z_DATA_ERROR:dn,Z_MEM_ERROR:cn,Z_BUF_ERROR:hn,Z_DEFLATED:un}=xr,pn=16180,gn=16190,mn=16191,fn=16192,bn=16194,_n=16199,vn=16200,wn=16206,yn=16209,Pn=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function An(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Sn=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<pn||t.mode>16211?1:0},Tn=e=>{if(Sn(e))return ln;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=pn,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,nn},Cn=e=>{if(Sn(e))return ln;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Tn(e)},En=(e,t)=>{let i;if(Sn(e))return ln;const r=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ln:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,Cn(e))},Rn=(e,t)=>{if(!e)return ln;const i=new An;e.state=i,i.strm=e,i.window=null,i.mode=pn;const r=En(e,t);return r!==nn&&(e.state=null),r};let kn,xn,Nn=!0;const On=e=>{if(Nn){kn=new Int32Array(512),xn=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(en(1,e.lens,0,288,kn,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;en(2,e.lens,0,32,xn,0,e.work,{bits:5}),Nn=!1}e.lencode=kn,e.lenbits=9,e.distcode=xn,e.distbits=5},In=(e,t,i,r)=>{let s;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),r>=n.wsize?(n.window.set(t.subarray(i-n.wsize,i),0),n.wnext=0,n.whave=n.wsize):(s=n.wsize-n.wnext,s>r&&(s=r),n.window.set(t.subarray(i-r,i-r+s),n.wnext),(r-=s)?(n.window.set(t.subarray(i-r,i),0),n.wnext=r,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0};var Mn={inflateReset:Cn,inflateReset2:En,inflateResetKeep:Tn,inflateInit:e=>Rn(e,15),inflateInit2:Rn,inflate:(e,t)=>{let i,r,s,n,o,a,l,d,c,h,u,p,g,m,f,b,_,v,w,y,P,A,S=0;const T=new Uint8Array(4);let C,E;const R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Sn(e)||!e.output||!e.input&&0!==e.avail_in)return ln;i=e.state,i.mode===mn&&(i.mode=fn),o=e.next_out,s=e.output,l=e.avail_out,n=e.next_in,r=e.input,a=e.avail_in,d=i.hold,c=i.bits,h=a,u=l,A=nn;e:for(;;)switch(i.mode){case pn:if(0===i.wrap){i.mode=fn;break}for(;c<16;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if(2&i.wrap&&35615===d){0===i.wbits&&(i.wbits=15),i.check=0,T[0]=255&d,T[1]=d>>>8&255,i.check=Rr(i.check,T,2,0),d=0,c=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",i.mode=yn;break}if((15&d)!==un){e.msg="unknown compression method",i.mode=yn;break}if(d>>>=4,c-=4,P=8+(15&d),0===i.wbits&&(i.wbits=P),P>15||P>i.wbits){e.msg="invalid window size",i.mode=yn;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&d?16189:mn,d=0,c=0;break;case 16181:for(;c<16;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if(i.flags=d,(255&i.flags)!==un){e.msg="unknown compression method",i.mode=yn;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=yn;break}i.head&&(i.head.text=d>>8&1),512&i.flags&&4&i.wrap&&(T[0]=255&d,T[1]=d>>>8&255,i.check=Rr(i.check,T,2,0)),d=0,c=0,i.mode=16182;case 16182:for(;c<32;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}i.head&&(i.head.time=d),512&i.flags&&4&i.wrap&&(T[0]=255&d,T[1]=d>>>8&255,T[2]=d>>>16&255,T[3]=d>>>24&255,i.check=Rr(i.check,T,4,0)),d=0,c=0,i.mode=16183;case 16183:for(;c<16;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}i.head&&(i.head.xflags=255&d,i.head.os=d>>8),512&i.flags&&4&i.wrap&&(T[0]=255&d,T[1]=d>>>8&255,i.check=Rr(i.check,T,2,0)),d=0,c=0,i.mode=16184;case 16184:if(1024&i.flags){for(;c<16;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}i.length=d,i.head&&(i.head.extra_len=d),512&i.flags&&4&i.wrap&&(T[0]=255&d,T[1]=d>>>8&255,i.check=Rr(i.check,T,2,0)),d=0,c=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(p=i.length,p>a&&(p=a),p&&(i.head&&(P=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(r.subarray(n,n+p),P)),512&i.flags&&4&i.wrap&&(i.check=Rr(i.check,r,p,n)),a-=p,n+=p,i.length-=p),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===a)break e;p=0;do{P=r[n+p++],i.head&&P&&i.length<65536&&(i.head.name+=String.fromCharCode(P))}while(P&&p<a);if(512&i.flags&&4&i.wrap&&(i.check=Rr(i.check,r,p,n)),a-=p,n+=p,P)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===a)break e;p=0;do{P=r[n+p++],i.head&&P&&i.length<65536&&(i.head.comment+=String.fromCharCode(P))}while(P&&p<a);if(512&i.flags&&4&i.wrap&&(i.check=Rr(i.check,r,p,n)),a-=p,n+=p,P)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;c<16;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if(4&i.wrap&&d!==(65535&i.check)){e.msg="header crc mismatch",i.mode=yn;break}d=0,c=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=mn;break;case 16189:for(;c<32;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}e.adler=i.check=Pn(d),d=0,c=0,i.mode=gn;case gn:if(0===i.havedict)return e.next_out=o,e.avail_out=l,e.next_in=n,e.avail_in=a,i.hold=d,i.bits=c,an;e.adler=i.check=1,i.mode=mn;case mn:if(t===rn||t===sn)break e;case fn:if(i.last){d>>>=7&c,c-=7&c,i.mode=wn;break}for(;c<3;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}switch(i.last=1&d,d>>>=1,c-=1,3&d){case 0:i.mode=16193;break;case 1:if(On(i),i.mode=_n,t===sn){d>>>=2,c-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=yn}d>>>=2,c-=2;break;case 16193:for(d>>>=7&c,c-=7&c;c<32;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",i.mode=yn;break}if(i.length=65535&d,d=0,c=0,i.mode=bn,t===sn)break e;case bn:i.mode=16195;case 16195:if(p=i.length,p){if(p>a&&(p=a),p>l&&(p=l),0===p)break e;s.set(r.subarray(n,n+p),o),a-=p,n+=p,l-=p,o+=p,i.length-=p;break}i.mode=mn;break;case 16196:for(;c<14;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if(i.nlen=257+(31&d),d>>>=5,c-=5,i.ndist=1+(31&d),d>>>=5,c-=5,i.ncode=4+(15&d),d>>>=4,c-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=yn;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;c<3;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}i.lens[R[i.have++]]=7&d,d>>>=3,c-=3}for(;i.have<19;)i.lens[R[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,C={bits:i.lenbits},A=en(0,i.lens,0,19,i.lencode,0,i.work,C),i.lenbits=C.bits,A){e.msg="invalid code lengths set",i.mode=yn;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;S=i.lencode[d&(1<<i.lenbits)-1],f=S>>>24,b=S>>>16&255,_=65535&S,!(f<=c);){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if(_<16)d>>>=f,c-=f,i.lens[i.have++]=_;else{if(16===_){for(E=f+2;c<E;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if(d>>>=f,c-=f,0===i.have){e.msg="invalid bit length repeat",i.mode=yn;break}P=i.lens[i.have-1],p=3+(3&d),d>>>=2,c-=2}else if(17===_){for(E=f+3;c<E;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}d>>>=f,c-=f,P=0,p=3+(7&d),d>>>=3,c-=3}else{for(E=f+7;c<E;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}d>>>=f,c-=f,P=0,p=11+(127&d),d>>>=7,c-=7}if(i.have+p>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=yn;break}for(;p--;)i.lens[i.have++]=P}}if(i.mode===yn)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=yn;break}if(i.lenbits=9,C={bits:i.lenbits},A=en(1,i.lens,0,i.nlen,i.lencode,0,i.work,C),i.lenbits=C.bits,A){e.msg="invalid literal/lengths set",i.mode=yn;break}if(i.distbits=6,i.distcode=i.distdyn,C={bits:i.distbits},A=en(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,C),i.distbits=C.bits,A){e.msg="invalid distances set",i.mode=yn;break}if(i.mode=_n,t===sn)break e;case _n:i.mode=vn;case vn:if(a>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=n,e.avail_in=a,i.hold=d,i.bits=c,js(e,u),o=e.next_out,s=e.output,l=e.avail_out,n=e.next_in,r=e.input,a=e.avail_in,d=i.hold,c=i.bits,i.mode===mn&&(i.back=-1);break}for(i.back=0;S=i.lencode[d&(1<<i.lenbits)-1],f=S>>>24,b=S>>>16&255,_=65535&S,!(f<=c);){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if(b&&0==(240&b)){for(v=f,w=b,y=_;S=i.lencode[y+((d&(1<<v+w)-1)>>v)],f=S>>>24,b=S>>>16&255,_=65535&S,!(v+f<=c);){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}d>>>=v,c-=v,i.back+=v}if(d>>>=f,c-=f,i.back+=f,i.length=_,0===b){i.mode=16205;break}if(32&b){i.back=-1,i.mode=mn;break}if(64&b){e.msg="invalid literal/length code",i.mode=yn;break}i.extra=15&b,i.mode=16201;case 16201:if(i.extra){for(E=i.extra;c<E;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}i.length+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;S=i.distcode[d&(1<<i.distbits)-1],f=S>>>24,b=S>>>16&255,_=65535&S,!(f<=c);){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if(0==(240&b)){for(v=f,w=b,y=_;S=i.distcode[y+((d&(1<<v+w)-1)>>v)],f=S>>>24,b=S>>>16&255,_=65535&S,!(v+f<=c);){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}d>>>=v,c-=v,i.back+=v}if(d>>>=f,c-=f,i.back+=f,64&b){e.msg="invalid distance code",i.mode=yn;break}i.offset=_,i.extra=15&b,i.mode=16203;case 16203:if(i.extra){for(E=i.extra;c<E;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}i.offset+=d&(1<<i.extra)-1,d>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=yn;break}i.mode=16204;case 16204:if(0===l)break e;if(p=u-l,i.offset>p){if(p=i.offset-p,p>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=yn;break}p>i.wnext?(p-=i.wnext,g=i.wsize-p):g=i.wnext-p,p>i.length&&(p=i.length),m=i.window}else m=s,g=o-i.offset,p=i.length;p>l&&(p=l),l-=p,i.length-=p;do{s[o++]=m[g++]}while(--p);0===i.length&&(i.mode=vn);break;case 16205:if(0===l)break e;s[o++]=i.length,l--,i.mode=vn;break;case wn:if(i.wrap){for(;c<32;){if(0===a)break e;a--,d|=r[n++]<<c,c+=8}if(u-=l,e.total_out+=u,i.total+=u,4&i.wrap&&u&&(e.adler=i.check=i.flags?Rr(i.check,s,u,o-u):Cr(i.check,s,u,o-u)),u=l,4&i.wrap&&(i.flags?d:Pn(d))!==i.check){e.msg="incorrect data check",i.mode=yn;break}d=0,c=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;c<32;){if(0===a)break e;a--,d+=r[n++]<<c,c+=8}if(4&i.wrap&&d!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=yn;break}d=0,c=0}i.mode=16208;case 16208:A=on;break e;case yn:A=dn;break e;case 16210:return cn;default:return ln}return e.next_out=o,e.avail_out=l,e.next_in=n,e.avail_in=a,i.hold=d,i.bits=c,(i.wsize||u!==e.avail_out&&i.mode<yn&&(i.mode<wn||t!==tn))&&In(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,i.total+=u,4&i.wrap&&u&&(e.adler=i.check=i.flags?Rr(i.check,s,u,e.next_out-u):Cr(i.check,s,u,e.next_out-u)),e.data_type=i.bits+(i.last?64:0)+(i.mode===mn?128:0)+(i.mode===_n||i.mode===bn?256:0),(0===h&&0===u||t===tn)&&A===nn&&(A=hn),A},inflateEnd:e=>{if(Sn(e))return ln;let t=e.state;return t.window&&(t.window=null),e.state=null,nn},inflateGetHeader:(e,t)=>{if(Sn(e))return ln;const i=e.state;return 0==(2&i.wrap)?ln:(i.head=t,t.done=!1,nn)},inflateSetDictionary:(e,t)=>{const i=t.length;let r,s,n;return Sn(e)?ln:(r=e.state,0!==r.wrap&&r.mode!==gn?ln:r.mode===gn&&(s=1,s=Cr(s,t,i,0),s!==r.check)?dn:(n=In(e,t,i,i),n?(r.mode=16210,cn):(r.havedict=1,nn)))},inflateInfo:"pako inflate (from Nodeca project)"};var Vn=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Dn=Object.prototype.toString,{Z_NO_FLUSH:Fn,Z_FINISH:Bn,Z_OK:Un,Z_STREAM_END:$n,Z_NEED_DICT:Ln,Z_STREAM_ERROR:Wn,Z_DATA_ERROR:qn,Z_MEM_ERROR:zn}=xr;function Hn(e){this.options=ks.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Is,this.strm.avail_out=0;let i=Mn.inflateInit2(this.strm,t.windowBits);if(i!==Un)throw new Error(kr[i]);if(this.header=new Vn,Mn.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Os.string2buf(t.dictionary):"[object ArrayBuffer]"===Dn.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=Mn.inflateSetDictionary(this.strm,t.dictionary),i!==Un)))throw new Error(kr[i])}function Jn(e,t){const i=new Hn(t);if(i.push(e),i.err)throw i.msg||kr[i.err];return i.result}Hn.prototype.push=function(e,t){const i=this.strm,r=this.options.chunkSize,s=this.options.dictionary;let n,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Bn:Fn,"[object ArrayBuffer]"===Dn.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),n=Mn.inflate(i,o),n===Ln&&s&&(n=Mn.inflateSetDictionary(i,s),n===Un?n=Mn.inflate(i,o):n===qn&&(n=Ln));i.avail_in>0&&n===$n&&i.state.wrap>0&&0!==e[i.next_in];)Mn.inflateReset(i),n=Mn.inflate(i,o);switch(n){case Wn:case qn:case Ln:case zn:return this.onEnd(n),this.ended=!0,!1}if(a=i.avail_out,i.next_out&&(0===i.avail_out||n===$n))if("string"===this.options.to){let e=Os.utf8border(i.output,i.next_out),t=i.next_out-e,s=Os.buf2string(i.output,e);i.next_out=t,i.avail_out=r-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(s)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(n!==Un||0!==a){if(n===$n)return n=Mn.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Hn.prototype.onData=function(e){this.chunks.push(e)},Hn.prototype.onEnd=function(e){e===Un&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ks.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Yn={Inflate:Hn,inflate:Jn,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Jn(e,t)},ungzip:Jn,constants:xr};const{Deflate:jn,deflate:Kn,deflateRaw:Gn,gzip:Zn}=Js,{Inflate:Xn,inflate:Qn,inflateRaw:eo,ungzip:to}=Yn;var io={Deflate:jn,deflate:Kn,deflateRaw:Gn,gzip:Zn,Inflate:Xn,inflate:Qn,inflateRaw:eo,ungzip:to,constants:xr};class ro{constructor(e=globalThis.HYPRPlacementController,t=HYPRRequestParameterManager){this.placementController=e,this.requestParameterManager=t}getSessionToken(){const e=JSON.stringify(this.requestParameterManager.getBiddingSessionParams()),t=io.deflate(e),i=Li.fromUint8Array(t);return`2/${encodeURI(i)}`}async loadBid(e,t){console.debug(`[BC] loadBid started for placement: ${e}`);const i=this.placementController.getPlacement(e),{success:r,error:s}=await i.loadBidResponse(t);return console.debug(`[BC] loadBid completed with status: ${r}, error: ${s}`),r}}const so="webview",no="native";class oo extends ae{constructor(e,t,i,r,s,n,o=globalThis.HYPRNetworkController,a=globalThis.HYPRTimerController,l=globalThis.consentController,d=HYPRRequestParameterManager){super(e,t,i,r,s,o,a,l,d),this.rtbParameterBuilder=n,this.rtbClickMode=so}getAdType(){return m}}function ao(){let e=(new Date).getTime(),t="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(i=>{let r=16*Math.random();return e>0?(r=(e+r)%16|0,e=Math.floor(e/16)):(r=(t+r)%16|0,t=Math.floor(t/16)),("x"===i?r:3&r|8).toString(16)}))}class lo{static addStatus(e={}){if("object"==typeof HYPRTransparencyTrackingManager){const t=HYPRTransparencyTrackingManager.getTrackingPermissionStatus();console.debug(`TransparencyTracking received status of ${t}`),e.privacy_tracking_status=t}return e}static canPrompt(e={}){const t="object"==typeof HYPRTransparencyTrackingManager&&void 0!==e.enable_tracking_prompt&&e.enable_tracking_prompt&&"not_determined"===HYPRTransparencyTrackingManager.getTrackingPermissionStatus();return console.debug(`TransparencyTracking.canPrompt result: ${t}`),t}static prompt(e){if(void 0===e||e.length<1)throw new Error("No callback supplied to Transparency Tracking prompt");console.debug("TransparencyTracking will present prompt to user."),HYPRTransparencyTrackingManager.promptForTrackingPermissionWithCallback(e)}}const co="IABGPP_HDR_GppString",ho="IABGPP_GppSID",uo=(e=globalThis.HYPRSharedDataController)=>{const t={},i=e?.getSharedValue?.(co),r=JSON.parse(i).value;"string"!=typeof r?console.error(`${co} is the non-string value ${r}`):!1===/^[a-zA-Z0-9_.~-]{4,2048}$/.test(r)?console.error(`'${r}' is an invalid ${co}`):t.gpp=r;const s=e?.getSharedValue?.(ho),n=JSON.parse(s).value;if("string"!=typeof n)console.error(`${ho} is the non-string value ${n}`);else if(!1===/^[0-9_]{1,32}$/.test(n))console.error(`'${n}' is an invalid ${ho}`);else{const e=n.split("_").map((e=>{const t=parseInt(e,10);return Number.isNaN(t,10)?void 0:t})).filter((e=>void 0!==e));e.length>0&&(t.gpp_sid=e)}return t},po={context:"context",distributor_id:"distributor_id",uid:"uid",bundle_id:"bundle_id",bundle_version:"bundle_version",ats_settings:"ats_settings",supported_interface_settings:"supported_interface_settings",xcode_version:"xcode_version",mobile_js_version:"mobile_js_version",identifier_for_vendor:"identifier_for_vendor",permissions:"permissions",msdkv:"msdkv",sdk_version:"sdk_version",device_type:"device_type",device_model:"device_model",device_os_version:"device_os_version",connection_type:"connection_type",carrier_data:"carrier_data",persistent_id:"persistent_id",preloaded_mraid_ads:"preloaded_mraid_ads",low_power_enabled:"low_power_enabled",privacy_tracking_status:"privacy_tracking_status",screen_traits:"screen_traits",supports_multiple_scenes:"supports_multiple_scenes",maccatalyst:"maccatalyst",hypr_modules:"hypr_modules",HYPRPermissions:"HYPRPermissions",app_bound_domains:"app_bound_domains",ios_app_on_mac:"ios_app_on_mac",device_width:"device_width",device_height:"device_height",pxratio:"pxratio",age_restricted_user:"age_restricted_user",ad_id_opted_out:"ad_id_opted_out",preloaded_ads:"preloaded_ads",cleartext_traffic_permitted:"cleartext_traffic_permitted",SKAdNetworkItems:"SKAdNetworkItems",platform:"platform",device_fingerprint:"device_fingerprint",device_product:"device_product",device_manufacturer:"device_manufacturer",device_brand:"device_brand",device:"device",supports_multiwindow:"supports_multiwindow",consent:"consent",android_id:"android_id",gaid:"gaid",target_sdk_version:"target_sdk_version",placement_id:"placement_id",test:"test"},go="hypr_uuid";class mo{constructor(e,t=globalThis.consentController,i=HYPRRequestParamListener,r=hyprMXLocalStorage){this.consentController=t,this.uid=void 0,this.distributorID=void 0,this.nativeParams=i,this.preloadController=void 0,this.localStorage=r,console.debug(`[RPM] User Extras: ${JSON.stringify(this.getUserExtras())}`),console.debug(`[RPM] User Extras(UID2): ${this.getUserExtra("UID2")}`)}static APP_USER_TOKEN="";setPreloadController(e){this.preloadController=e}getInitializationParams(){let e=this.baseParameters();return e=Object.assign(e,JSON.parse(this.nativeParams.getUnityParams())),e=Object.assign(e,JSON.parse(this.nativeParams.getMediationParams())),e=Object.assign(e,uo()),delete e.persistent_id,delete e.ad_id_opted_out,delete e.gaid,delete e.age_restricted_user,$.compact(e)}getErrorParams(){return $.compact(this.baseParameters())}getTrackingParams(){return $.compact(this.baseParameters())}getCatalogFrameParams(){return $.compact(this.baseParameters())}getInventoryCheckParams(e={}){let t=this.baseParameters();return t=Object.assign(t,uo()),t[po.preloaded_mraid_ads]=this.preloadController?.getPreloadedMraidAds(),void 0===e.context&&(t.context="inventoryCheck"),$.compact(Object.assign(t,e))}getBaseRtbParams(){return $.compact({test:this.nativeParams.isTestModeEnabled?.()?1:0,app:this.buildApp(),device:this.buildDevice(),user:this.buildUser()})}baseParameters(){let e={};return e=Object.assign(e,this.buildSegment()),e=Object.assign(e,this.deviceParams()),e=Object.assign(e,this.cachedAppParams()),lo.addStatus(e),e[po.test]=this.nativeParams.isTestModeEnabled?.()?1:0,e[po.uid]=this.getUserId(),e}getUserId(){return void 0!==this.uid||(this.uid=this.localStorage.getItem(go),void 0!==this.uid&&null!==this.uid&&"null"!==this.uid.toLowerCase()||("function"==typeof this.nativeParams.getUID?this.uid=this.nativeParams.getUID():this.uid=ao(),this.localStorage.setItem(go,this.uid))),this.uid}getUserExtras(){return"function"==typeof this.nativeParams.getUserExtras&&console.debug("[RPM] getUserExtras exists"),JSON.parse(this.nativeParams.getUserExtras?.()||"{}")}getUserExtra(e){return console.log(`getUserExtra(${e})`),this.nativeParams.getUserExtra?.(e)||void 0}getDistributorID(){return void 0!==this.distributorID||(this.distributorID=this.nativeParams.getDistributorID()),this.distributorID}getSDKVersion(){return void 0!==this.sdkVersion||(this.sdkVersion=this.nativeParams.getSDKVersion()),this.sdkVersion}buildUser(){return{id:this.getUserId(),data:[{segment:[this.buildSegment(!0)]}]}}buildApp(){const e=l(this.cachedAppParams());return{ver:e[po.bundle_version],bundle:e[po.bundle_id]}}buildSegment(e=!1){const t=l(this.cachedSegmentParams());t[po.consent]=this.consentController.getConsentParameters(),t[po.cleartext_traffic_permitted]=this.nativeParams.getClearTextPermitted(),t[po.age_restricted_user]=this.nativeParams.getIsAgeRestrictedUser(),t[po.low_power_enabled]=this.nativeParams.getIsLowPowerEnabled(),t[po.privacy_tracking_status]=this.nativeParams.getPrivacyTrackingStatus(),t[po.connection_type]=this.nativeParams.getConnectionType(),t[po.android_id]=this.nativeParams.getAndroidId();const i=parseFloat(this.nativeParams.getTargetSDKVersion().toFixed(1));return i>0&&(t[po.target_sdk_version]=i),this.nativeParams.getIsAgeRestrictedUser()||"function"!=typeof this.nativeParams.getIdentifierForVendor||(t[po.identifier_for_vendor]=this.nativeParams.getIdentifierForVendor()),this.nativeParams.getIsAgeRestrictedUser()||"function"!=typeof this.nativeParams.getGAID||(t[po.gaid]=this.nativeParams.getGAID()),e&&(t[po.carrier_data]=JSON.parse(this.nativeParams.getCarriers())),t[po.screen_traits]=this.nativeParams.getScreenTraits(),t}cachedSegmentParams(){if(void 0!==this.cachedSegment)return this.cachedSegment;const e={};return e[po.sdk_version]=this.nativeParams.getSDKVersion(),e[po.supported_interface_settings]=this.nativeParams.getSupportedInterfaceSettings(),e[po.msdkv]=this.nativeParams.getMSDKV(),e[po.ats_settings]=this.nativeParams.getATSSettings(),e[po.maccatalyst]=this.nativeParams.getMacCatalyst(),e[po.ios_app_on_mac]=this.nativeParams.getIOSAppOnMac(),e[po.xcode_version]=this.nativeParams.getXcodeVersion(),e[po.supports_multiple_scenes]=this.nativeParams.getSupportsMultipleScenes(),e[po.supports_multiwindow]=this.nativeParams.getSupportsMultipleWindow(),e[po.permissions]=JSON.parse(this.nativeParams.getPermissions()),e[po.distributor_id]=this.nativeParams.getDistributorID(),e[po.mobile_js_version]=globalThis.version(),e[po.device_type]=this.nativeParams.getDeviceType(),e[po.SKAdNetworkItems]=this.nativeParams.getSKAdNetworkItems(),this.cachedSegment=e,this.cachedSegment}buildDevice(){const e=l(this.cachedDeviceParams()),t={device_fingerprint:e[po.device_fingerprint],device_product:e[po.device_product]};Object.assign(t,Ee());const i={model:e[po.device_model],os:e[po.platform],osv:e[po.device_os_version],h:e[po.device_height],w:e[po.device_width],pxratio:e[po.pxratio],make:e[po.device_brand],ext:t};return this.nativeParams.getIsAgeRestrictedUser()||(i.lmt=this.formatLimitAdTracking(this.nativeParams.getAdIdOptedOut()),i.ifa=this.nativeParams.getPersistentID()),Object.assign(i,this.rtbDeviceCarrierData())}deviceParams(){const e=l(this.cachedDeviceParams());return this.nativeParams.getIsAgeRestrictedUser()||(e[po.persistent_id]=this.nativeParams.getPersistentID(),"function"==typeof this.nativeParams.getGAID&&(e[po.gaid]=this.nativeParams.getGAID()),e[po.ad_id_opted_out]=this.nativeParams.getAdIdOptedOut()),e[po.carrier_data]=JSON.parse(this.nativeParams.getCarriers()),e}cachedDeviceParams(){if(void 0!==this.cachedDevice)return this.cachedDevice;const e={};return e[po.device_model]=this.nativeParams.getDeviceModel(),e[po.device_os_version]=this.nativeParams.getOSVersion(),e[po.device_height]=this.nativeParams.getDeviceHeight(),e[po.device_width]=this.nativeParams.getDeviceWidth(),e[po.pxratio]=this.nativeParams.getPxRatio(),e[po.device_product]=this.nativeParams.getDeviceProduct(),e[po.device_fingerprint]=this.nativeParams.getDeviceFingerPrint(),e[po.device_brand]=this.nativeParams.getDeviceBrand(),e[po.device]=this.nativeParams.getDevice(),e[po.platform]=this.nativeParams.getPlatform(),e[po.device_manufacturer]=this.nativeParams.getDeviceManufacturer(),this.cachedDevice=e,this.cachedDevice}cachedAppParams(){if(void 0!==this.cachedApp)return this.cachedApp;const e={};return e[po.bundle_id]=this.nativeParams.getBundleID(),e[po.bundle_version]=this.nativeParams.getBundleVersion(),this.cachedApp=e,this.cachedApp}getBiddingSessionParams(){return{ad_id_opted_out:this.nativeParams.getAdIdOptedOut(),age_restricted_user:this.nativeParams.getIsAgeRestrictedUser(),carrier_data:JSON.parse(this.nativeParams.getCarriers()),connection_type:this.nativeParams.getConnectionType(),consent:this.consentController.getConsentParameters(),low_power_enabled:this.nativeParams.getIsLowPowerEnabled(),privacy_tracking_status:this.nativeParams.getPrivacyTrackingStatus(),app_user_token:mo.APP_USER_TOKEN,test:this.nativeParams.isTestModeEnabled?.()?1:0,distributor_id:this.nativeParams.getDistributorID(),msdkv:this.nativeParams.getMSDKV(),mobile_js_version:globalThis.version(),bundle_id:this.nativeParams.getBundleID(),uid:this.getUserId(),device_type:this.nativeParams.getDeviceType(),device_model:this.nativeParams.getDeviceModel(),device_os_version:this.nativeParams.getOSVersion(),cleartext_traffic_permitted:this.nativeParams.getClearTextPermitted(),sdk_version:this.nativeParams.getSDKVersion(),platform:this.nativeParams.getPlatform(),supported_interface_settings:this.cachedSegmentParams().supported_interface_settings,xcode_version:this.nativeParams.getXcodeVersion()}}formatLimitAdTracking(e){return e?1:0}rtbDeviceCarrierData(){let e;switch(this.nativeParams.getConnectionType()){case"Ethernet":e=1;break;case"WIFI":e=2;break;case"NR":e=3;break;case"CDMA":case"CDMA - EvDo rev. 0":case"CDMA - EvDo rev. A":case"CDMA - EvDo rev. B":case"CDMA - 1xRTT":case"CDMA - eHRPD":case"EDGE":e=4;break;case"GPRS":case"UMTS":case"HSPA":case"HSDPA":case"HSPA+":case"HSUPA":case"GSM":case"3G":e=5;break;case"LTE_CA":case"LTE":e=6;break;default:e=0}const t={connectiontype:e};if(void 0===this.nativeParams.getCarriers())return t;const i=JSON.parse(this.nativeParams.getCarriers()),r=Object.keys(i).sort();if(r.length>0){const e=i[r[0]];t.carrier=e.carrier_name,t.mccmnc=`${e.mobile_country_code},${e.mobile_network_code}`}return t}}globalThis.RequestParameterManager=mo;const fo="eids";function bo(e){if("string"!=typeof e)return void console.log(`kHyprEIDSKey not found in user extras: ${JSON.stringify(e)}`);let t;try{t=JSON.parse(e)}catch(e){return void console.log("UserExtrasToUniqueIdsConverter: userExtrasString is not valid JSON")}if("object"!=typeof t)return void console.log("UserExtrasToUniqueIdsConverter: userExtras is not valid json");const i=[];return function(e,t){if(Array.isArray(e)){const i=e.filter((e=>"string"==typeof e.id&&""!==e.id)).map((e=>({id:e.id,ext:{rtiPartner:"UID2"}})));i.length>0&&t.push({source:"uidapi.org",uids:i})}}(t.uid2,i),function(e,t){if(Array.isArray(e)){const i=e.filter((e=>"string"==typeof e.id&&""!==e.id)).map((e=>{const t={id:e.id,ext:{}};return"number"==typeof e.linkType&&e.linkType>=0&&e.linkType<=3&&(t.ext.linkType=e.linkType),"boolean"==typeof e.abTestingControlGroup&&(t.ext.abTestingControlGroup=e.abTestingControlGroup),0===Object.keys(t.ext).length&&delete t.ext,t}));i.length>0&&t.push({source:"id5-sync.com",uids:i})}}(t.id5,i),function(e,t){if(Array.isArray(e)){const i=e.filter((e=>"string"==typeof e.id&&""!==e.id)).map((e=>({id:e.id,ext:{rtiPartner:"idl"}})));i.length>0&&t.push({source:"liveramp.com",uids:i})}}(t.liveramp,i),function(e,t){if(Array.isArray(e)){const i=e.filter((e=>"string"==typeof e.id&&""!==e.id)).map((e=>{const t={id:e.id};return"number"==typeof e.atype&&e.atype>=1&&(e.atype<=3||e.atype>=500)&&(t.atype=e.atype),t}));i.length>0&&t.push({source:"liveintent.com",uids:i})}}(t.liveintent,i),function(e,t){if(Array.isArray(e)){const i=e.filter((e=>"string"==typeof e.id&&""!==e.id)).map((e=>{const t={id:e.id,ext:{}};return"number"==typeof e.atype&&e.atype>=1&&(e.atype<=3||e.atype>=500)&&(t.atype=e.atype),"string"==typeof e.third&&""!==e.third&&(t.ext.third=e.third),0===Object.keys(t.ext).length&&delete t.ext,t}));i.length>0&&t.push({source:"pubcid.org",uids:i})}}(t.pubcid,i),i.length?i:void 0}const _o={"6_4_0":[435,315]};function vo(e,t=globalThis.initializationController?.deviceConfiguration){const[i,r]=e,{msdkv:s}=t;switch(t.isAndroid()){case!0:return s>=i;case!1:return s>=r;default:return!1}}function wo(e=(()=>{}),t=globalThis.initializationController?.deviceConfiguration){void 0!==t?!1===vo(_o["6_4_0"],t)&&e():console.error("unable to detect device configuration")}function yo(e=[{}],t=HYPRRequestParamListener){const i=[{...e?.[0]}];return i[0].banner={...i[0].banner},(e,r)=>{const s=l(i),n=s[0].banner.api||[];return function(e,t=(()=>{}),i=(()=>{}),r=globalThis.initializationController?.deviceConfiguration){void 0!==r?!0===vo(e,r)?t():i():console.error("unable to detect device configuration")}(_o["6_4_0"],(()=>{n.includes(7)||n.push(7)})),s[0].id=e,s[0].banner.h=r.definedSize.height,s[0].banner.w=r.definedSize.width,s[0].banner.format=[{w:r.definedSize.width,h:r.definedSize.height}],s[0].banner.api=n,s[0].secure=!1===t.getClearTextPermitted()?1:0,s}}const Po={OPTED_OUT:"1YY-",NOT_OPTED_OUT:"1YN-"};function Ao(e={},t={}){const i=c(l(e),l(t)),r=function(e={},t=HYPRRequestParamListener){const i={...l(e),ver:t.getBundleVersion()};return()=>i}(i.app),s=Fe(i.device),n=function(e={},t=HYPRRequestParamListener,i=globalThis.consentController,r=HYPRRequestParameterManager){const s={};s[po.sdk_version]=t.getSDKVersion(),s[po.supported_interface_settings]=t.getSupportedInterfaceSettings(),s[po.msdkv]=t.getMSDKV(),s[po.ats_settings]=t.getATSSettings(),s[po.maccatalyst]=t.getMacCatalyst(),s[po.ios_app_on_mac]=t.getIOSAppOnMac(),s[po.xcode_version]=t.getXcodeVersion(),s[po.supports_multiple_scenes]=t.getSupportsMultipleScenes(),s[po.supports_multiwindow]=t.getSupportsMultipleWindow(),s[po.permissions]=JSON.parse(t.getPermissions()),s[po.distributor_id]=t.getDistributorID(),s[po.mobile_js_version]=globalThis.version(),s[po.device_type]=t.getDeviceType(),s[po.SKAdNetworkItems]=t.getSKAdNetworkItems(),s[po.age_restricted_user]=t.getIsAgeRestrictedUser(),s[po.android_id]=t.getAndroidId();const n=parseFloat(t.getTargetSDKVersion().toFixed(1));n>0&&(s[po.target_sdk_version]=n);const o=JSON.stringify(s),a=r.getUserId(),d=l(e);return e=>{const s=JSON.parse(o);s[po.consent]=i.getConsentParameters(),s[po.low_power_enabled]=t.getIsLowPowerEnabled(),s[po.privacy_tracking_status]=t.getPrivacyTrackingStatus(),s[po.connection_type]=t.getConnectionType(),s[po.carrier_data]=JSON.parse(t.getCarriers()),s[po.screen_traits]=t.getScreenTraits(),s[po.age_restricted_user]=t.getIsAgeRestrictedUser(),s[po.placement_id]=e,t.getIsAgeRestrictedUser()||"function"!=typeof t.getIdentifierForVendor?delete s[po.identifier_for_vendor]:s[po.identifier_for_vendor]=t.getIdentifierForVendor(),t.getIsAgeRestrictedUser()||"function"!=typeof t.getGAID?delete s[po.gaid]:s[po.gaid]=t.getGAID(),console.log(`paramManager.getUserExtra(${fo}) = ${r.getUserExtra(fo)}`);const n={...d,id:a,data:[{segment:[{id:"hyprmx",ext:s}]}],ext:{eids:bo(r.getUserExtra(fo))}};return void 0===n.ext.eids&&delete n.ext,n}}(i.user),o=yo(t.imp),a=function(e={},t=globalThis.consentController,i=HYPRRequestParamListener){return()=>{const r=t.consentStatus===T.CONSENT_DECLINED?Po.OPTED_OUT:Po.NOT_OPTED_OUT,s=e.coppa|(i.getIsAgeRestrictedUser()?1:0);let n=l(e);return n.us_privacy=r,n.coppa=s,n.ext=n.ext?n.ext:{},n.ext.us_privacy=r,n.ext.coppa=s,n=Object.assign(n,uo()),n}}(i.regs),d=function(e={},t=globalThis.OMIDPN,i=globalThis.OMIDPV){return()=>{const r=l(e);return console.debug(`[RS] OMID source is ${JSON.stringify(r)} with ${t} and ${i}`),void 0===t||void 0===i?(console.debug("[RS] OMID not defined.  Skipping OMID source."),r):(r.ext=r.ext?r.ext:{},r.ext.omidpn=t,r.ext.omidpv=i,console.debug(`[RS] OMID source set to ${JSON.stringify(r)}`),r)}}(i.source);return delete i.app,delete i.device,delete i.user,delete i.imp,delete i.regs,delete i.source,function(e,t,i,r,s,n,o){return(a,l)=>{const d=ao();return{id:d,...e,app:t(),device:i(),user:r(l),imp:s(d,a),regs:n(),source:o()}}}(i,r,s,n,o,a,d)}globalThis.BASE_RTB_REQUEST={};class So{static fromObject(e,t,i=globalThis.HYPRNetworkController,r=globalThis.HYPRTimerController){return o(oe.BANNER,e.type)?new oo(e.id,e.name,e.type,e.inventory_check_url,t,Ao(globalThis.BASE_RTB_REQUEST,e.placement_rtb_request),i,r):o(oe.REWARDED,e.type)||o(oe.INTERSTITIAL,e.type)?new ni(e.id,e.name,e.type,e.inventory_check_url,t,e.cancellation_dialog,i,r):(console.error(`PlacementFactory received unknown placement type ${e.type}`),new ae(e.id,e.name,e.type,e.inventory_check_url,t,i,r))}static deepCopy(e){const t=new e.constructor;for(const i in e)t[i]=e[i];return t}}class To{constructor(e,t=globalThis.consentController,i=globalThis.preloadController){if(this.placementMap=new Map,this.preloadController=i,console.debug(`[PC] Placement Controller initialized with ${JSON.stringify(e)}`),Array.isArray(e))for(const t of e)this.placementMap.set(t.name,So.fromObject(t,this));else void 0!==e&&"object"==typeof e&&this.placementMap.set(e.name,So.fromObject(e,this));t.setConsentChangedListener(this),globalThis.HYPRBiddingController=new ro(this)}getPlacements(){return this.placementMap}getBannerPlacements(){return[...this.placementMap.values()].filter((e=>e.isBannerAdType()))}getPlacement(e){const t=this.placementMap.get(e);return void 0!==t&&void 0===t.placementListener&&(t.placementListener=this),this.placementMap.get(e)}isAdAvailable(e){const t=this.getPlacement(e);return void 0===t?(console.debug(`[PC] PlacementController.isAdAvailable(${e}) reports undefined placement. Returning false.`),!1):t.isAdAvailable()}clearAllPlacementsAdStateAndTimers(){this.placementMap.forEach(((e,t,i)=>{e.clearAdAndStopAdAvailableTimer()}))}startAdRefresh(e,t=void 0){console.debug(`[PC] PlacementController - Start Ad Refresh for context: ${e} placementName: ${t}`);const i={context:e};void 0===t?this.placementMap.forEach((t=>{t.handleRefresh(e,i)})):this.getPlacement(t).handleRefresh(e,i)}async loadAd(e,t={}){const i=this.getPlacement(e);if(void 0===i)return console.debug("[PC] PlacementController loadAd reports undefined placement."),!1;const{success:r,error:s}=await i.loadAd(t);return this.onLoadAdResponse(i,s),r}handlePreloading(e){this.preloadController.handleMraidAdToPreload(e),this.preloadController.handleUIComponentsToPreloadResponse(e.ui_components)}onLoadAdResponse(e,t){void 0!==t?(console.debug(`PlacementController loadAd failure ${t}`),wo((()=>{HYPRPlacementListener.onLoadAdFailure(e.name,t)}))):(wo((()=>{HYPRPlacementListener.onLoadAdSuccess(e.name,e.isAdAvailable())})),this.handlePreloading(e))}onRefreshAdResponse(e,t){void 0===t&&this.handlePreloading(e)}onPlacementAdExpired(e){console.debug(`[PC] Ad expired for ${e}`),HYPRPlacementListener.onAdExpired(e.name)}adImpression(e){console.debug(`[PC] adImpression for ${e}`),HYPRPlacementListener.adImpression?.(e.name)}onConsentChanged(){console.debug("[PC] Consent status changed.  Clearing all ad state."),this.startAdRefresh(si)}}globalThis.PlacementController=To;class Co{constructor(e=Date.now){this.timeReporter=e,this.duration=0,this.isActive=!1,this.startTime=0}start(){this.isActive||(this.isActive=!0,this.startTime=this.timeReporter())}pause(){this.isActive&&(this.isActive=!1,this.duration+=this.timeReporter()-this.startTime)}}class Eo{constructor(e,t=new Co,i=new Co,r=new Co,s=new Co){this.trackingUrl=e,this.startTimeStamp=void 0,this.timeDuration=0,this.loadingRecorder=t,this.loadingInBackgroundRecorder=i,this.onPageRecorder=r,this.onPageBackgroundRecorder=s,this.isLoading=!1,this.isOnPage=!1,this.inBackground=!1,this.reason=""}startPageLoadingTimer(e){this.isLoading=!0,this.inBackground=e,this.notifyTimers(this.inBackground,this.loadingRecorder,this.loadingInBackgroundRecorder)}stopPageLoadingTimer(e){this.isLoading&&(this.isLoading=!1,this.reason=e,this.loadingInBackgroundRecorder.pause(),this.loadingRecorder.pause())}startOnPageTimer(e){this.isOnPage=!0,this.inBackground=e,this.notifyTimers(e,this.onPageRecorder,this.onPageBackgroundRecorder)}stopOnPageTimer(){this.isOnPage&&(this.isOnPage=!1,this.onPageRecorder.pause(),this.onPageBackgroundRecorder.pause())}setBackGroundState(e){this.inBackground=e,this.isLoading&&this.notifyTimers(e,this.loadingRecorder,this.loadingInBackgroundRecorder),this.isOnPage&&this.notifyTimers(e,this.onPageRecorder,this.onPageBackgroundRecorder)}notifyTimers(e,t,i){e?(t.pause(),i.start()):(t.start(),i.pause())}onForegrounded(){this.setBackGroundState(!1)}onBackgrounded(){this.setBackGroundState(!0)}stopTracking(){this.loadingRecorder.pause(),this.loadingInBackgroundRecorder.pause(),this.onPageRecorder.pause(),this.onPageBackgroundRecorder.pause()}}const Ro="CLICK_REPORTING_URL";class ko extends Eo{constructor(e,t=globalThis.HYPRNetworkController){super(e),this.networkRequestController=t}onBrowserClosed(){if(this.stopTracking(),console.debug(`onBrowserClosed with time ${this.onPageRecorder.duration}`),!a(this.trackingUrl))return void console.error("Invalid BrowserTrackingDurationUrl");const e=this.trackingUrl.replace("TIME_ON_SITE",this.onPageRecorder.duration);this.networkRequestController.get(e)}}const xo="NONE",No="STARTED",Oo="COMPLETED",Io={_audioAdState:xo,setAudioAdState(e){if(e!==this._audioAdState){if(e===No)this.audioEventPublisher?.audioStarted();else if(this._audioAdState===No)this.audioEventPublisher?.audioEnded();else if(e===Oo)return void console.error(`[BVM] Audio state cannot be set to complete.  Currently set to ${this._audioAdState}`);this._audioAdState=e}},audioEvent(e){if("complete"===e)console.debug("[BVM] Ending audio on complete audio event"),this.setAudioAdState(Oo);else if("start"===e){console.debug("[BVM] starting audio on start audio event"),this.setAudioAdState(No);const{outputVolume:e,isMuted:t}=Ee();this.audioStatusManager?.onVolumeChange(e),this.audioStatusManager?.onMuteChange(t)}else console.error(`[BVM] Unknown audio event received: ${e}`)}},Mo={_omSessionActive:!1,startOMSession(e=(()=>{})){console.debug("[BOMM] startOMSession."),this._omSessionActive?console.debug("[BOMM] OM Session already active, ignoring."):(this._omSessionActive=!0,e())},finishOMSession(e=(()=>{})){this._omSessionActive?(console.debug("[BOMM] finishOMSession."),this._omSessionActive=!1,e()):console.debug("[BOMM] OM Session not active, cannot finish. Ignoring.")},clearOMSession(e=(()=>{})){console.debug("[BOMM] clearOMSession."),this.finishOMSession(e)}},Vo=4;let Do,Fo=3;function Bo({message:e,severity:t,type:i}={},r=globalThis.HYPRRequestParameterManager,s=globalThis.HYPRNetworkController){const n={errorMessage:e||"",errorTypeKey:i||"shared_js_error"},o=t||Vo;if(console.debug(`Client Error Capture [level: ${o}] error: ${JSON.stringify(n)}`),void 0===Do||o<=Fo)return;const a={...r.getErrorParams(),...n};"function"==typeof console.messages&&(a.value=console.messages()),s.post(Do,a)}globalThis.HYPRErrorController={sendClientErrorCapture(e,t,i){Bo({message:e,severity:i,type:t})}};const Uo="\x3c!--PROPS_TEMPLATE--\x3e";function $o(e,t,i,r,s,n=null,o=null){console.debug("[DPF] setting up props");let a="";if(function(e){try{return"string"==typeof JSON.parse(e)?.steps?.[0]?.adm}catch(e){return!1}}(t)){console.debug("[DPF] props using provided JSON Props");const i=JSON.parse(t);i.placementType=e,a=JSON.stringify(i)}else{console.debug(`[DPF] props using HTML template. Placement type is ${e}`);const l=Li.encode(t);console.log(`[DPF] base64AdMarkup is ${l}`);const d={placement_type:e,steps:[{adm:`${l}`}],os:i,os_version:r,msdkv:s,shared_version:globalThis.version};null!==n&&null!==o&&(d.w=n,d.h=o),a=JSON.stringify(d)}return console.debug(`[DPF] props set with ${a}`),a}globalThis.PLAYER_AD_DISPLAY_TEMPLATE="";class Lo{constructor(e={},t=so){if(0===Object.keys(e).length)return;const i=e.seatbid||[];if(i.length<1)return;const r=i[0]||[];if(r.length<1)return;const s=r.bid[0]||{};this.id=s.id,this.impid=s.impid,n(s.adm)?this.ad_html="":this.ad_html=s.adm,this.hyprAd=void 0!==s.ext?.hyprmx;const o=s.ext?.hyprmx||{};this.audioAd=o?.audio_ad||!1,this.offerId=o?.offer_id||"",this.clickMode=o?.click?.mode||t,this.onPageJS=o?.click?.on_page_load_js||"",this.clickReportingUrl=o?.click_reporting_url,this.timeOnSiteUrl=o?.time_on_site_url,this.acceptableAdSizeVariance=o.acceptable_ad_size_variance||1,this.isHyprAd()?(console.debug("[BA] Hypr ad detected."),this.impressionUrl=s.burl):(console.debug("[BA] Prebid ad detected."),this.impressionUrl=s.ext?.prebid?.events?.imp,this.winUrl=s.ext?.prebid?.events?.win,console.debug(`[BA] Prebid ad.  imp url is ${this.impressionUrl}`),console.debug(`[BA] Prebid ad.  win url is ${this.winUrl}`))}updateAdConfiguration({click:e={},time_on_site_url:t,click_reporting_url:i}={}){const{mode:r,on_page_load_js:s}=e;this.clickMode=r||this.clickMode,this.onPageJS=s||this.onPageJS,this.timeOnSiteUrl=t||this.timeOnSiteUrl,this.clickReportingUrl=i||this.clickReportingUrl,console.debug(`[BA] Updated ad configuration.\n      click mode is ${this.clickMode}\n      on page js is ${this.onPageJS}\n      time on site url is ${this.timeOnSiteUrl}\n      click reporting url is ${this.clickReportingUrl}`)}isHyprAd(){return this.hyprAd}hasImpressionId(){return"string"==typeof this.impid&&this.impid.length>0}getImpressionUrl(){return this.impressionUrl}getWinUrl(){return this.winUrl}getClickReportingUrl(){return this.clickReportingUrl}getTimeOnSiteUrl(){return this.timeOnSiteUrl}hasAd(){return"string"==typeof this.ad_html&&this.ad_html.length>0}shouldAppStoreUseOverlay(){return!1}openClickInNativeBrowser(){return"native"===this.clickMode}getOfferName(){return this.offerId}getClickMode(){return this.clickMode||"webview"}isAudioAd(){return this.audioAd}}class Wo extends lt{constructor(e,t){super(),this.inventoryCheckURL=e,this.rtbClickMode=t}async loadAd(e,t=globalThis.HYPRNetworkController){const{imp:i}=e;try{console.debug(`[RAL] rtb request started for: ${i.id}`);const{promise:r,canceller:s}=t.cancellableAsyncPost(this.inventoryCheckURL,e);this.canceller=s;const{code:n,body:o,error:a}=await r;return this.canceller=void 0,{...this.processResponse(n,o,a),imp:i}}catch(e){return console.debug(`[RAL] rtb request aborted for: ${i.id} with error: ${e}`),{error:e}}}processResponse(e,t,i){let r=i;void 0!==r?console.debug(`[BP] Loading ads received error for placement: ${this} with status code ${e} and error: ${r}`):K.validResponseStatus(e)?console.debug(`[BP] Loading ads completed for placement: ${this}`):(console.debug(`[BP] Loading ads received invalid status code for placement: ${this} with status code ${e}`),r=`Invalid status code ${e}`);const s=se.parseJSON(t);let n;return K.validResponseStatus(e)&&void 0===r&&void 0!==s&&(n=new Lo(s,this.rtbClickMode)),{ad:n,error:r}}}const qo="</head>",zo="PLACEMENT_DOES_NOT_EXIST",Ho="PLAYER_AD_DISPLAY_TEMPLATE_DOES_NOT_EXIST";class Jo extends tt{constructor({audioStatusManager:e,audioEventPublisher:t},i,r,s,n,...o){super(...o),console.debug(`[BVM] ${this.instanceId}`),this.ad=new Lo,this.hasFiredImpression=!1,this.hasFiredWin=!1,this.userInteracted=!1,this.visibilityRateCheck=200,this.opacityThresholdPercent=100,this.currentAdData=void 0,this.visibilityData=void 0,this.audioEventPublisher=t,this.audioStatusManager=e,this.audioStatusManager?.addObserver(this),this.impressionTracker=i(this.networkRequestController),this.winTracker=n(this.networkRequestController),this.clickReporting=r(this.networkRequestController),this.timeOnSiteFactory=s(this.networkRequestController)}get audioAdState(){return this._audioAdState}set audioAdState(e){this.setAudioAdState?.apply(this,[e])}async loadAd({definedSize:e,actualSize:t,bidResponse:i}){if(this.audioAdState=xo,this.hasFiredImpression=!1,this.hasFiredWin=!1,this.clearOMSession((()=>this.presenter.finishOMSession?.())),!this.hasPlacement())return this.presenter.loadAdFailed(zo),this.audioAdState=xo,{success:!1,error:zo};if(0===globalThis.PLAYER_AD_DISPLAY_TEMPLATE.length)return console.error("[BVM] Player Ad Display Template is empty"),this.presenter.loadAdFailed(Ho),this.audioAdState=xo,{success:!1,error:Ho};if(void 0!==i){console.debug(`[BVM] Loading adm with ${i}`);const{success:t,error:r}=this.internalLoadBidResponse(i);return this.onBannerLoadResult(this.placement,void 0,e),{success:t,error:r}}const r={definedSize:e,actualSize:t};console.debug(`[BVM] Loading ads with ${JSON.stringify(r)}`);const{success:s,error:n}=await this.internalLoadAd({definedSize:e,actualSize:t});return this.onBannerLoadResult(this.placement,n,e),{success:s,error:n}}async internalLoadAd(e){console.debug("[BP] loadAd for banner"),this.imp=void 0,console.debug(`[BP] Loading ads for ${this}`);const t=this.placement.rtbParameterBuilder(e,this.placement.id);this.placement.rtbClickMode=1===t.imp[0]?.clickbrowser?no:so,this.adLoadRequest?.cancel(),this.adLoadRequest=new Wo(this.placement.inventoryCheckURL,this.placement.rtbClickMode);const{ad:i,error:r,imp:s}=await this.adLoadRequest.loadAd(t,this.networkRequestController);return r===L?(console.debug("[BP] Request aborted"),{success:!1,error:r}):(this.adLoadRequest=void 0,this.ad=i,this.imp=s,{success:this.isAdAvailable(),error:r})}async internalLoadBidResponse(e){return console.debug("[BP] load bid response for banner"),this.imp=void 0,this.ad=function(e,t){const i=new ii(e);i.lastError&&console.log(`[BA] Ad VAST parse produced error: ${JSON.stringify(i.lastError)}`);const{bannerExtensions:r,clickMode:s}=i.getBannerExtension();console.log(`[BA] Banner adJson is ${JSON.stringify(r)}`);const n={seatbid:[{bid:[{id:t,impid:ao(),adm:e,ext:{hyprmx:{time_on_site_url:r.time_on_site_url,click_reporting_url:r.click_reporting_url}}}]}]};return s?new Lo(n,s):new Lo(n)}(e,this.id),{success:this.isAdAvailable()}}onBannerLoadResult(e,t,i){console.debug(`[BVM] Ad load complete for Banner Placement ${e}, isAdAvailable: ${this.isAdAvailable()}, error: ${t}`),void 0===t&&this.isAdAvailable()?(this.presenter.loadAdSuccess(),this.currentAdData=function(e,t,i,r,s=HYPRRequestParameterManager){const n=$o(oe.BANNER,e,r,s.nativeParams.getOSVersion(),s.nativeParams.getMSDKV(),t,i),o=globalThis.PLAYER_AD_DISPLAY_TEMPLATE.replace(Uo,`window.props = ${n}`);return console.debug(`[DPF] generated html ${o}`),o}(this.ad.ad_html,i.width,i.height,this.configuration.platform,this.requestParameterManager),this.isViewable()||this.setCurrentUrl("about:blank"),this.attemptToShowAd()):(this.audioAdState=xo,this.currentAdData=void 0,this.setCurrentUrl("about:blank"),this.presenter.loadAdFailed("NO_FILL"))}hasPlacement(){return void 0!==this.placement}getMraidEnabledAdHTML(){return this.ad.ad_html.replace(qo,Se.getMraidJSTag()+qo)}onParentViewChangeEvent(e){super.onParentViewChangeEvent(e),this.hasParentView||(this.audioAdState=Oo,this.finishOMSession((()=>this.presenter.finishOMSession?.()))),this.updateVisibilityTracking()}containerVisibleChange(e){super.containerVisibleChange(e),this.updateVisibilityTracking()}onWebViewLoadData(){}onModalClosed(){super.onModalClosed()}fireBannerImpressionAttemptIfReady(){if(this.hasFiredImpression||!this.hasParentView||!1===this.visible)return!1;const e={width:0,height:0,...this.currentSizeData};if(e.width<=0&&e.height<=0)return console.debug(`[BVM] Container size not set for ${this.instanceId} when attempting impression`),!1;this.hasFiredImpression=!0,console.debug(`[BVM] Firing Impression attempt for placement: ${this.placement.name} with id ${this.instanceId}`);const t=this.getBannerImpressionSize();return this.presenter.adImpression?.(),this.validateContainerSize(t,e),this.impressionTracker(this.getAdModel().getImpressionUrl(),this.placement.name),!0}getBannerImpressionSize(){return void 0!==this.imp&&this.imp[0]?this.imp[0].banner:{}}isAdAvailable(){return void 0!==this.ad&&this.ad.hasImpressionId()&&this.ad.hasAd()}fireBannerWinAttemptIfReady(){return!(this.hasFiredWin||!this.hasParentView||!1===this.visible)&&(this.hasFiredWin=!0,console.debug(`[BVM] Firing Win attempt for placement: ${this.placement.name} with id ${this.instanceId}`),this.winTracker(this.getAdModel().getWinUrl(),this.placement.name),!0)}addContainerToSegment(e={}){if(!(e.user?.data&&e.user.data[0]&&e.user.data[0].segment&&e.user.data[0].segment[0]))return;const t=e.user?.data[0]?.segment[0],i={width:0,height:0,...this.currentSizeData};t.banner_container_width=i.width,t.banner_container_height=i.height}validateContainerSize(e,t){const i=this.ad.acceptableAdSizeVariance;(i<e.w-t.width||i<e.h-t.height)&&Bo(ti.getBannerContainerSizeMismatchedError(`Mismatched banner size on impression(${this.instanceId}).  Expected container size (${e.w}x${e.h}) found (${t.width}x${t.height})`))}javaScriptAlertAttempt(e){return this.userInteracted}permissionRequest(e){this.denyPermissionRequest(e)}shouldAllowWindowOpenEvent(e){return this.onBannerClicked(),!0}nativeBrowserWillPresent(e){super.nativeBrowserWillPresent(e),this.fireClickTraffic(e.initialUrl)}fireClickTraffic(e){this.clickReporting(this.ad?.getClickReportingUrl(),e)}onBannerClicked(){this.presenter.onAdClicked()}captureImage(){return!1}generateTimeOnSiteTracking(){return new ko(this.ad?.getTimeOnSiteUrl())}scrollingEnabled(){return!1}shouldScrollBounce(){return!1}allowsWebViewLinkPreview(){return!1}webViewAlpha(){return"00"}isPinchEnabled(){return!1}setUserInteracted(e){void 0!==e.interacted&&(this.userInteracted=e.interacted)}onVisibleEvent(e){const t=this.isViewable();this.visibilityData=e,this.attemptToShowAd(),t!==this.isViewable()&&this.reportVisibilityChanged()}reportVisibilityChanged(){super.reportVisibilityChanged(),this.publishCustomEvent(He.EVENT_NAME,this.isViewable()?He.EVENT_VIEWABLE:He.EVENT_NOT_VIEWABLE)}updateVisibilityTracking(){console.debug(`[BVM] updateVisibilityTracking ${this.visible} ${this.hasParentView}`),this.visible&&this.hasParentView?this.presenter.startVisibilityTracking(this.visibilityRateCheck,this.opacityThresholdPercent):(this.presenter.stopVisibilityTracking(),this.visibilityData=void 0,this.reportVisibilityChanged())}attemptToShowAd(){this.isViewable()&&void 0!==this.currentAdData&&(console.debug("[BVM] Banner ad will be shown."),this.setCurrentData(this.currentAdData),this.fireBannerImpressionAttemptIfReady(),this.fireBannerWinAttemptIfReady(),this.currentAdData=void 0,void 0===this.ad?console.debug("[BVM] Ad Undefined"):console.debug("[BVM] Ad Defined"))}isViewable(){return!(!this.visible||!this.hasParentView||this.backgrounded||!1!==this.visibilityData?.fullyOffscreen||!0!==this.visibilityData?.parentAlphaPassesThreshold||!0!==this.visibilityData?.isShown)}storePicture(e){super.storePicture(e),this.fireClickTraffic(e)}createCalendarEvent(e){this.fireClickTraffic(null),super.createCalendarEvent(e)}destroy(){this.audioAdState=Oo,this.audioStatusManager?.removeObserver(this)}handlePageFinishFromWebView(e){super.handlePageFinishFromWebView(e),console.debug(`[BVM] handlePageFinishFromWebView: ${e}`)}setNativeAdConfiguration(e){console.debug(`[BVM] setNativeAdConfiguration: ${JSON.stringify(e)}`),this.ad?.updateAdConfiguration(e)}setTrampoline(e){console.debug(`[BVM] setTrampoline: ${JSON.stringify(e)}`),void 0!==e?.nativeInterface&&this.setNativeAdConfiguration({nativeInterface:e.nativeInterface})}handleJSMessageFromWebView(e){const{name:t}=e;if("pageReady"===t)this.startOMSession((()=>this.presenter.startOMSession?.()));else super.handleJSMessageFromWebView(e)}}Object.assign(Jo.prototype,Io),Object.assign(Jo.prototype,Mo);class Yo{constructor(e,t,i,r=globalThis.HYPRNetworkController,s=HYPRRequestParameterManager){this.catalogFrameUrl=e,this.recoveryParams=void 0,this.placement=t,this.ad=i,this.requestParameterManager=s,this.networkRequestController=r,this.clickReportingUrl=void 0,this.thankYouURL=void 0,this.trampoline=void 0,this.htmlBody=void 0,this.catalogFrameError=void 0,this.preloading=!1}async getWebAd(e=!1){this.preloading=e;const t=await this.startCatalogFrameRequest();let i;i=void 0!==this.htmlBody?this.catalogFrameUrl:this.trampoline?.redirection_url;return{error:t,pageUrl:i,html:this.htmlBody}}async getTrampolineResponse(){const e=await this.startCatalogFrameRequest();console.debug("[CatalogFramePromise] completed trampoline request");const{trampoline:t}=this;return{error:e,trampoline:t}}mergeTrampoline(e){void 0===this.trampoline?(console.debug("[CatalogFrame] setting trampoline from app.js"),this.trampoline=e):void 0!==this.trampoline.viewing_id&&""!==this.trampoline.viewing_id||""===e.viewing_id?n(this.trampoline.click_reporting_url)&&""!==e.click_reporting_url&&(console.debug("[CatalogFrame] Merging click reporting url from app.js"),this.trampoline.click_reporting_url=`${e.click_reporting_url}`):(console.debug("[CatalogFrame] Merging viewing ID from app.js for preloaded mraid"),this.trampoline.viewing_id=`${e.viewing_id}`)}storeRecoveryParams(e){this.recoveryParams=e}shouldReloadCatalogFrame(e){const{url:t}=e;return t.startsWith(this.catalogFrameUrl)&&void 0!==this.recoveryParams}webtrafficSdkConfiguration(){return void 0===this.trampoline||Object.keys(this.trampoline).length<1?{}:{completion_url:this.completionUrl(),maximum_page_load_wait_time_in_seconds:this.trampoline.maximum_page_load_wait_time_in_seconds,viewing_id:this.trampoline.viewing_id,minimum_visit_time_in_seconds:this.trampoline.visit_length,urls:this.webTrafficPagesArray()}}pageUrl(){return this.trampoline?.redirection_url}completionUrl(){return void 0!==this.trampoline.redirection_url?`${this.trampoline.redirection_url}&do_completion=1&phase=thank_you&recovery=1`:""}async startCatalogFrameRequest(){this.updateCatalogFrameUrl();const{response:e,body:t,error:i,headers:r}=await this.networkRequestController.postAsync(this.catalogFrameUrl,this.requestParams(),Yo.requestConfig());let s;if(void 0===i&&K.validResponseStatus(e)&&void 0!==r){if(K.validHtmlType(r)&&void 0!==t)return void(this.htmlBody=t);K.validJSONType(r)||(s="Unparsable catalog frame response")}else console.error(`catalogFrame error received: ${i}`),s=`CatalogFrame error: ${i}, status Code: ${e}`;return void 0!==s?(this.catalogFrameError=s,s):(s=this.handleTrampolineBody(t),void 0!==s&&(this.catalogFrameError=s),s)}requestParams(e=this.placement,t=this.ad){const i=this.requestParameterManager.getCatalogFrameParams(),r=e.compileRequestParamsFromParams(i,!1,t);return $.compact(r)}updateCatalogFrameUrl(){void 0!==this.recoveryParams&&(this.catalogFrameUrl=`${this.catalogFrameUrl.split("?")[0]}?${this.recoveryParams}`,this.recoveryParams=void 0)}handleTrampolineBody(e){console.debug("CatalogFrame.handleTrampolineBody()");const t=se.parseJSON(e);return"object"==typeof t&&(0===Object.keys(t).length?"No trampoline keys":!1===this.preloading&&void 0===t.token?"No token parameter":void 0===t.reward_token?"No reward_token parameter":!1===this.preloading&&void 0===t.viewing_id?"No viewing_id":void(this.trampoline=t))}webTrafficDynamicPageArray(e){const t=this.webTrafficPagesArray();return 1!==t.length?(console.error(`Unexpected webtraffic dynamic page length: ${t.length}`),t):"placeholder"!==t[0].url?(console.error(`webtraffic dynamic page missing expected token, found url: ${t[0].url}`),t):(t[0].url=e,t)}webTrafficPagesArray(){const e="object"==typeof this.trampoline.page_load_js?this.trampoline.page_load_js:{},t=e.map,i=e.js,r=Array.isArray(this.trampoline.wtu_ids)&&this.trampoline.urls.length===this.trampoline.wtu_ids.length?this.trampoline.wtu_ids:void 0,s=[];for(const e in this.trampoline.urls)if(this.trampoline.urls.hasOwnProperty(e)){const n=this.trampoline.urls[e];let o;void 0!==t&&void 0!==i&&(o=i[t[e]]),void 0===o&&(o="");const a={url:n,on_page_load_js:[o]};void 0!==r&&(a.wtu_id=r[e]),s.push(a)}return s}impressionURLs(){const e=[];if(this.trampoline.tracking_impression_html.length>0){const t=this.trampoline.tracking_impression_html.replace(/"/g,"'").split("'");for(const i of t)se.urlValidation(i)&&e.push(i)}return e}static requestConfig(){return new x(!0,I,M,{"Content-Type":O,Accept:N})}}const jo="HYPR_AD_PROGRESS_STORAGE_KEY";class Ko{constructor(e,t,i,r){const s=[e,t,i,r];for(const n of s)if("string"!=typeof n||0===n.length){return Bo(ti.getAdProgressInvalidSetUpError(e,t,i,r)),void(this.data=void 0)}this.data={},this.data.ad_progress_state=C.IN_PROGRESS,this.data.ad_closed_action=E.UNKNOWN,this.data.viewing_id=e,this.data.distributor_id=t,this.data.user_id=i,this.data.offer_type=r,this.send(),this.store(),this.adClosedActionSent=!1}send(){if(void 0!==this.data){this.data.ad_progress_timestamp=(new Date).toISOString();const e=JSON.stringify(this.data),t=Ko.generateEventCallbackFunction(e);globalThis.HYPREventController.sendAdProgressTracking(e,t)}}store(){let e="";if(void 0!==this.data){const t=JSON.parse(JSON.stringify(this.data));t.ad_closed_action=E.CRASHED,e=JSON.stringify(t),Ko.updateStorage(e)}return e}static updateStorage(e=""){hyprMXLocalStorage.setItem(jo,e)}setProgressState(e){if(this.adClosedActionSent)return void console.debug(`[APT] Ad progress state change (${e}) received after ad finished. Ignoring.`);if(void 0===this.data)return void console.debug("Cannot update progress state.  Data undefined");if(this.dataUpdateError(e))return;let t=e;void 0!==this.completionState&&e===C.IN_PROGRESS&&(t=this.completionState),this.data.ad_progress_state=t,this.send(),e===C.BACKGROUNDED?Ko.updateStorage():this.store(),e!==C.COMPLETED&&e!==C.PAYOUT_COMPLETE||(this.completionState=e)}dataUpdateError(e,t=!1){const i=t?"closed action":"progress state",r=` (value: ${e}, viewing ID: ${this.data?.viewing_id})`,s=t?"InvalidCloseContext":"InvalidProgressContext",n=t?"InvalidCloseValue":"InvalidProgressValue";let o=`${i} error`,a=0;if(void 0===this.data?(o+=" -- session data undefined",a=Zt[s]):t&&void 0!==this.data&&this.data.ad_closed_action!==E.UNKNOWN&&(o+=` -- ad_closed_action already set: ${this.data.ad_closed_action}`,a=Zt[s]),(!t&&void 0===C[e]||t&&(void 0===E[e]||e===E.UNKNOWN))&&(o+=" -- invalid value",a=Zt[n]),a>0){o+=r;return Bo(ti.getAdProgressUpdateError(o,a)),!0}return!1}setClosedAction(e){this.adClosedActionSent?console.debug("[APT] Ad closed tracking already sent"):(this.adClosedActionSent=!0,this.dataUpdateError(e,!0)||(this.data.ad_closed_action=e,this.send(),Ko.updateStorage()))}static checkStoredData(){const e=hyprMXLocalStorage.getItem(jo);if("string"==typeof e&&e.length>0){console.debug("[APT] checkStoredData");const t=Ko.generateEventCallbackFunction(e);globalThis.HYPREventController.sendAdProgressTracking(e,t),Ko.updateStorage()}}static generateEventCallbackFunction(e){return(t,i)=>{const r=`sent ad progress tracking: ${e}, response: ${JSON.stringify(t)}, error: ${i}`;return console.debug(`[APT] ${r}`),r}}}class Go extends tt{constructor(e,t,i,r={},...s){super(...s),this.pageReadyController=t,this.pageReadyController.pageReadyListener=this,this.presentationListener=e,this.customData=r,this.clickReporting=i(this.networkRequestController),void 0!==this.placement&&(r.placementId=this.placement.id),this.catalogFrame=void 0,this.impressionFired=!1,this.recoveryParams=void 0,this.presenter=void 0,this._adCompleted=!1,void 0!==this.placement&&(this.ad=this.placement.ad),this.thankYouUrl=void 0,this.viewingId=void 0,this.queryParams=void 0,this._payoutComplete=!1,this.storedProgressStates=[],this.closable=this.ad?.show_close_button||!1,this.backButtonEnabled=!1,this.presenterSubscriptions.push("closable"),this.presenterSubscriptions.push("backButtonEnabled"),this.closableWithoutDialog=!1,this._terminatedWebviewCount=0}get closable(){return this._closable}set closable(e){this._closable=e,this.breadcrumb={state:"set_closable",value:e},this.presenter?.setClosable(e)}get adCompleted(){return this._adCompleted}set adCompleted(e){!1!==e&&e!==this._adCompleted&&(this.breadcrumb="ad_complete_received",this.updateDiagnosticFlag(We.AD_COMPLETED),this._adCompleted=e)}get payoutComplete(){return this._payoutComplete}set payoutComplete(e){!1!==e&&e!==this._payoutComplete&&(this.breadcrumb="payout_complete_received",this.updateDiagnosticFlag(We.AD_REWARDED),this._payoutComplete=e)}get terminatedWebviewCount(){return this._terminatedWebviewCount}set terminatedWebviewCount(e){this._terminatedWebviewCount=e,this.progressAnalytic?.addMetaData({terminatedWebviewCount:e},!0)}get backButtonEnabled(){return this._backButtonEnabled}set backButtonEnabled(e){this._backButtonEnabled=e,this.presenter?.setBackButtonEnabled(e)}beginFullScreenPresentation(e){if(this.ad=e,void 0!==this.ad){if(this.userAgent=e.user_agent||"",this.progressAnalytic=(new qe).setViewModelMetaData(this),void 0!==this.ad.bidResponse){const t=this.ad.bidResponse,i=this.ad.type,{platform:r}=this.configuration.platform,s=function(e,t,i,r=HYPRRequestParameterManager){const s=$o(t,e,i,r.nativeParams.getOSVersion(),r.nativeParams.getMSDKV()),n=globalThis.PLAYER_AD_DISPLAY_TEMPLATE.replace(Uo,`window.props = ${s}`);return console.debug(`[DPF] generated html ${n}`),n}(t,i,r,this.requestParameterManager);this.setCurrentData(s),this.closable=!1,this.presentationListener.onDisplayAd(this.instanceId,e.getAdType(),e.getAdString())}else this.catalogFrame=this.getCatalogFrame(),this.presentAdForPlacement(this.placement,this.ad),this.closable=void 0!==this?.ad?.show_close_button&&this.ad.show_close_button;this.pageReadyController.beginPageReadyTimer(this.computePageReadyTime())}else this.presentNoAdForPlacement(this.placement)}presentNoAdForPlacement(e){console.debug(`[FSVM] PresentationController.showFullscreenAd(${e.name}) has no ad to show`),this.pageReadyController.stopPageReadyTimer(),this.eventController.sendNoAdTracking(e),this.breadcrumb="no_ad_page",this.presentationListener.showNoAd(e.getUIComponentsString())}presentAdForPlacement(e,t){if(void 0===t)return console.debug(`[FSVM] PresentationController.presentAdForPlacement(${e.name}) has no ad to show`),void this.presentNoAdForPlacement(e);console.debug(`[FSVM] PresentationController.presentAdForPlacement(${e.name}) to show ${t.getAdType()} offer`),t.hasAd()?(this.presentationListener.onDisplayAd(this.instanceId,t.getAdType(),t.getAdString()),this.loadPageFromCatalogFrame()):(console.debug(`[FSVM] PresentationController.presentAdForPlacement(${e.name}) has no ad to show`),this.presentNoAdForPlacement(e))}handleJSMessageFromWebView(e){const{name:t,body:i}=e;switch(t){case"pageReady":this.breadcrumb="page_ready_received",this.pageReadyController.onPageReadyFinished(),this.presenter.reportPowerState();break;case"setRecoveryPostParameters":this.catalogFrame?.storeRecoveryParams(i);break;case"payoutComplete":this.payoutComplete=!0,this.updateAdProgressState(C.PAYOUT_COMPLETE);break;case"setClosable":this.closable=!0;break;case"close":case"closeAd":this.updateAdClosedAction("close"===t?E.MRAID_CLOSE:E.CLOSE_AD),this.adCompleted||void 0===this.placement.cancellationDialog?this.presenter.closeAdExperience():this.presenter.showCancelDialog(this.placement.cancellationDialog.message,this.placement.cancellationDialog.exit,this.placement.cancellationDialog.continue);break;case"adDidComplete":this.updateAdProgressState(C.COMPLETED),this.closable=!0,this.adCompleted=!0,this.presenter.dismissOfferCancellationDialog();break;case"presentDialog":this.presenter.showDialog(i);break;case"abort":"presentDialog"===i?this.updateAdClosedAction(E.PRESENT_DIALOG_OK):this.updateAdClosedAction(E.ABORT),this.presenter.closeAdExperience();break;case"startOMSession":this.presenter.startOMSession?.(i);break;case"endOMSession":this.presenter.endOMSession();break;case"useCustomClose":this.adCompleted?console.error("[FSVM] useCustomClose invoked after ad completed"):this.presenter.useCustomClose("true"===i);break;default:super.handleJSMessageFromWebView(e)}}setTrampoline(e){console.debug(`[FSVM] setTrampoline ${JSON.stringify(e)}`),this.getCatalogFrame().mergeTrampoline(e),this.onCatalogFrameSuccess()}getCatalogFrame(){return void 0===this.catalogFrame&&(this.catalogFrame=new Yo(this.ad?.catalog_frame_url,this.placement,this.ad)),this.catalogFrame}async loadPageFromCatalogFrame(){console.debug("[FSVM] loadPageFromCatalogFrame() started"),this.breadcrumb="load_catalogFrame";const{error:e,pageUrl:t,html:i}=await this.catalogFrame.getWebAd();if(void 0!==e)return this.updateDiagnosticFlag(We.CATALOG_FRAME_ERR),void this.onShowError(e);void 0!==i?(this.breadcrumb="set_catalog_frame_html",this.setCurrentData(i,t)):this.setCurrentUrl(t),this.onCatalogFrameSuccess()}urlNavigationAttempt(e){const{url:t}=e;return this.catalogFrame?.shouldReloadCatalogFrame(e)?(this.breadcrumb="catalog_frame_reload",console.debug(`[FSVM] CatalogFrame Reload for placement: ${this.placement.name} params: ${this.catalogFrame?.recoveryParams}`),this.loadPageFromCatalogFrame(),JSON.stringify(new le(ce,t))):super.urlNavigationAttempt(e)}shouldAllowWindowOpenEvent(e){return!1===this.hasBecomeVisible?(console.error("[FSVM] rejecting Window.open attempt before Ad was displayed"),!1):super.shouldAllowWindowOpenEvent(e)}nativeBrowserWillPresent(e){super.nativeBrowserWillPresent(e),this.fireClickTraffic(e.initialUrl)}fireClickTraffic(e){void 0!==this.clickReporting?this.clickReporting(this.clickReportingUrl,e):console.debug(`[FSVM] Click reporting will be ignore for ${this.placement.name}.`)}javaScriptAlertAttempt(e){return!1===this.hasBecomeVisible?(console.error("[FSVM] rejecting javaScriptAlertAttempt before Ad was displayed"),!1):(this.breadcrumb="javascript_alert_display",super.javaScriptAlertAttempt(e))}openMeasurementCustomData(){return JSON.stringify(this.customData)}shouldScrollBounce(){return!0}webViewBackground(){return this.ad.getAdType()===g?"ffffff":"000000"}playbackRequiresUserAction(){return void 0===this.ad?super.playbackRequiresUserAction():this.ad.video_requires_user_action||super.playbackRequiresUserAction()}onShowError(e){console.debug(`[FSVM] onShowError: ${e}`),this.presenter.showErrorDialog("There was an error displaying the ad.")}onCatalogFrameSuccess(){if(void 0===this.catalogFrame.trampoline)return void console.debug("[FSVM] onCatalogFrameSuccess cannot proceed.  No trampoline");console.debug(`[FSVM] Attempting Catalog Frame response from onCatalogFrameSuccess callback${JSON.stringify(this.catalogFrame.trampoline)}`);const e={viewingID:this.catalogFrame.trampoline.viewing_id,distributorID:this.catalogFrame.trampoline.distributor_id,userID:this.catalogFrame.trampoline.uid,offerType:this.ad.getAdType()};this.viewingId=this.catalogFrame.trampoline.viewing_id,this.thankYouUrl=this.catalogFrame.trampoline.redirection_url,this.clickReportingUrl=this.catalogFrame.trampoline.click_reporting_url,this.progressAnalytic?.addMetaData({viewingId:this.viewingId},!0),this.startAdProgressTracking(e)}computePageReadyTime(){return void 0===this.ad?8:void 0!==this.ad.preloaded_mraid_page_ready_timeout&&void 0!==this.preloadInstanceId?this.ad.preloaded_mraid_page_ready_timeout:this.ad.offer_initiation_timeout_in_seconds||8}onClose(){this.adWillClose()}onWebViewTermination(){this.updateDiagnosticFlag(We.WEBVIEW_TERMINATION),this.terminatedWebviewCount+=1,this.breadcrumb={state:"webpage_crash",value:this.currentTrackedUrl,count:this.terminatedWebviewCount,payoutComplete:this.payoutComplete,adCompleted:this.adCompleted,closable:this.closable};const e=void 0!==this.ad?.enable_webview_reload?this.ad.enable_webview_reload:super.onWebViewTermination();return!1===e?(this.breadcrumb={state:"webpage_crash_closure",value:this.url},console.error("[FSVM] Webview crashed. Closing ad abruptly."),this.updateAdClosedAction(E.WEBVIEW_CRASH),this.presenter.closeAdExperience()):this.breadcrumb={state:"webpage_crash_reload",value:this.url},e}permissionRequest(e){if(!1===this.hasBecomeVisible)return console.error("[FSVM] rejecting permissionRequest attempt before Ad was displayed"),void this.denyPermissionRequest(e);super.permissionRequest(e)}createCalendarEvent(e){!1!==this.hasBecomeVisible?super.createCalendarEvent(e):console.error("[FSVM] rejecting createCalendarEvent attempt before Ad was displayed")}storePicture(e){!1!==this.hasBecomeVisible?(this.userAction="store_picture",super.storePicture(e)):console.error("[FSVM] rejecting storePicture attempt before Ad was displayed")}captureImage(){return!1===this.hasBecomeVisible?(console.error("[FSVM] rejecting captureImage attempt before Ad was displayed"),!1):(this.userAction="capture_image",super.captureImage())}isPageReadyActiveOrFinished(){return this.pageReadyController.isPageReadyActiveOrFinished()}isPageReady(){return this.pageReadyController.pageReady}onPageReadyFinished(){}onPageReadyExpired(){this.updateDiagnosticFlag(We.PAGE_READY_EXP),console.debug("[FSVM] onPageReadyExpired. Setting ad closable"),this.closable=!0,this.closableWithoutDialog=!0}shouldScaleViewport(){return void 0!==this.getAdModel()?.scale_viewport?this.getAdModel().scale_viewport:super.shouldScaleViewport()}startAdProgressTracking(e){let t="";const i=Object.keys(e);for(const r of["viewingID","distributorID","userID","offerType"])i.includes(r)&&"string"==typeof e[r]||(t+=`Valid ${r} missing from parameters. `);if(t.length>0)return console.debug(`[FSVM] error with startAdProgressTracking() - ${t}`),t;const{viewingID:r,distributorID:s,userID:n,offerType:o}=e;return void 0!==this.adProgress?"Ad Progress already in progress.":(this.adProgress=new Ko(r,s,n,o),this.storedProgressStates.forEach((e=>this.updateAdProgressState(e))),null)}updateAdProgressState(e){if(console.debug(`[FSVM] updateAdProgressState to ${e}`),void 0!==this.adProgress||e!==C.IN_PROGRESS)return void 0===this.adProgress?(console.debug(`[FSVM] updateAdProgressState before adProgress set ${e}`),void this.storedProgressStates.push(e)):void this.adProgress.setProgressState(e);console.debug("[FSVM] Ad Progress set to IN_PROGRESS before ad started.  Ignoring.")}updateAdClosedAction(e){this.breadcrumb={state:"close",value:e},console.debug(`[FSVM] updateAdClosedAction to ${JSON.stringify(e)}`),void 0!==this.adProgress?(this.progressAnalytic?.report(),this.adProgress.setClosedAction(e)):console.debug(`[FSVM] updateAdClosedAction before adProgress set ${e}`)}getPresenterPromise(){return new Promise((e=>{this.resolvePresenter=()=>{console.debug("[FSVM] [CatalogFramePromise] resolving presenter"),e(void 0!==this.presenter)}}))}async waitForTrampolineAndPresenter(){this.catalogFrame=this.getCatalogFrame();const e=this.catalogFrame.getTrampolineResponse(),t=this.getPresenterPromise();console.debug("[FSVM] [CatalogFramePromise] will start promise"),this.breadcrumb="start_catalog_frame";const[{error:i,trampoline:r},s]=await Promise.all([e,t]);return this.breadcrumb="complete_catalog_frame",console.debug("[FSVM] [CatalogFramePromise] completed promise"),s&&void 0===i?(console.debug("[FSVM] [CatalogFramePromise] success"),r):(console.debug("[FSVM] [CatalogFramePromise] error"),void this.onShowError(i))}setPresenter(e){super.setPresenter(e),"function"==typeof this.resolvePresenter&&(console.debug("[FSVM] [CatalogFramePromise] will resolve presenter promise"),this.resolvePresenter(),this.resolvePresenter=void 0)}onForegroundTransition(){this.breadcrumb="foreground_transition",this.progressAnalytic?.save(),super.onForegroundTransition(),this.updateAdProgressState(C.IN_PROGRESS)}onBackgroundTransition(){this.breadcrumb="background_transition",this.progressAnalytic?.save(),super.onBackgroundTransition(),this.updateAdProgressState(C.BACKGROUNDED)}nativeClosePressed(){this.exitAdExperience(E.NATIVE_CLOSE_BUTTON)}cancelDialogExitPressed(){this.updateAdClosedAction(E.CANCELLATION_DIALOG_OK),this.presenter.closeAdExperience()}onErrorDialogOKPressed(){this.updateAdClosedAction(E.ERROR_DIALOG_OK),this.presenter.closeAdExperience()}unknownErrorOccurred(e){this.breadcrumb={state:"native_sdk_error",value:e},this.progressAnalytic?.addMetaData({native_error_message:e},!0),console.error(`[FSVM] Unknown error occurred:  ${e}. Closing Ad.`),this.updateAdClosedAction(E.UNKNOWN),this.onShowError(e)}onBackButtonPressed(){if(console.debug("[FSVM] onBackButtonPressed"),this.webViewHistory?.canNavigateBack)return console.debug("[FSVM] Navigating Back"),void this.navigateBack();this.closable||this.adCompleted?this.exitAdExperience(E.BACK_PRESS):console.debug("[FSVM] This ad is non-closable.")}exitAdExperience(e){console.debug(`[FSVM] exitAdExperience ${e}`),this.adCompleted||this.closableWithoutDialog||void 0===this.placement.cancellationDialog?(console.debug("[FSVM] closeAdExperience"),this.updateAdClosedAction(e),this.presenter.closeAdExperience()):(console.debug("[FSVM] showCancelDialog"),this.breadcrumb="show_cancel_dialog",this.presenter.showCancelDialog(this.placement.cancellationDialog.message,this.placement.cancellationDialog.exit,this.placement.cancellationDialog.continue))}internetLossDetected(){this.updateDiagnosticFlag(We.INTERNET_LOSS),this.closable=!0}onWebViewHistoryChanged(e){super.onWebViewHistoryChanged(e),this.backButtonEnabled=e.canNavigateBack}}const Zo={viewModelMap:new Map,baseAdIdentifierIndex:(new Date).valueOf(),removeViewModel(e){if(console.debug(`[VMC] removeViewModel ${e}`),this.viewModelMap.has(e)){console.debug(`[VMC] ViewModel found for ${e} and will be destroyed`);const t=this.viewModelMap.get(e);t.webViewPresenter=null,t.presenter=null,this.viewModelMap.delete(e),t.destroy()}},getViewModel(e){if(this.viewModelMap.has(e))return this.viewModelMap.get(e);throw new Error(`No matching viewModel for id: ${e}`)},getFullScreenViewModelForPlacementName(e){console.debug(this.toContentString());for(const[,t]of this.viewModelMap.entries())if(t.placement.name===e&&t instanceof Go)return console.debug(`[VMC] ViewModel found for placement: ${e}`),t;console.debug(`[VMC] ViewModel not found for placement: ${e}`)},storeViewModel(e,t){this.viewModelMap.has(e)&&console.debug(`[VMC] ViewModel already found for identifier: ${e}.  Replacing VM in store`),this.viewModelMap.set(e,t)},generateUniqueId(){const e=`ViewModel-${this.baseAdIdentifierIndex}`;return this.baseAdIdentifierIndex+=1,e},publishEvent(e,t,i){try{const r=this.getViewModel(e);return r[t].apply(r,i)}catch(e){return`publishEventError: ${e.toString()}`}},reset(){this.viewModelMap=new Map,this.baseAdIdentifierIndex=0},toContentString(){const e=[];for(const[t,i]of this.viewModelMap.entries()){let r="unknown";i instanceof Go?r="FullscreenWebAdViewModel":i instanceof rt?r="HyprMXBrowserViewModel":i instanceof Jo&&(r="BannerViewModel"),e.push(`${t}: type ${r}, placement: ${i?.placement?.name}`)}return JSON.stringify(e)}};globalThis.ViewModelController=Zo;class Xo{constructor(e){this.timerController=e,this.pageReadyListener=void 0,this.pageReady=!1,this.pageReadyTimer=void 0}beginPageReadyTimer(e){if(void 0===this.pageReadyListener)throw new Error("PageReadyController.beginPageReadyTimer called with no pageReadyListener set");return this.pageReady?(console.log("[pageReady] already complete.  Not starting timer."),!1):this.isPageReadyTimerActive()?(console.log("[pageReady] already active.  Not starting timer."),!1):e<=0?(console.log(`[pageReady] Invalid time ${e}.  Not starting timer.`),!1):(console.debug(`[pageReady] initiating timer for ${e}s`),this.pageReadyTimer=this.timerController.startTimer(1e3*e,(()=>{this.onPageReadyExpired()})),!0)}onPageReadyExpired(){console.debug("[pageReady] timer expired"),this.pageReadyTimer=void 0,this.pageReadyListener.onPageReadyExpired()}onPageReadyFinished(){console.debug("[pageReady] onPageReadyFinished"),this.pageReady=!0,this.stopPageReadyTimer(),this.pageReadyListener.onPageReadyFinished()}stopPageReadyTimer(){console.debug("[pageReady] stopPageReadyTimer"),this.isPageReadyTimerActive()&&(console.debug("[pageReady] stopping timer"),this.timerController?.stopTimer(this.pageReadyTimer),console.debug("[pageReady] stopped timer"),this.pageReadyTimer=void 0)}isPageReadyTimerActive(){return void 0!==this.pageReadyTimer}isPageReady(){return this.pageReady}isPageReadyActiveOrFinished(){return this.isPageReady()||this.isPageReadyTimerActive()}}class Qo extends Eo{constructor(e,t=globalThis.HYPREventController){super(e),this.eventController=t}sendTracking(){void 0!==this.trackingUrl&&(this.stopTracking(),this.eventController.sendWebTrafficTimeSpent(this.trackingUrl,JSON.stringify(this.getTimeSpent())),this.trackingUrl=void 0)}getTimeSpent(){return{reason:this.reason,page_load_time:{foreground:this.loadingRecorder.duration,background:this.loadingInBackgroundRecorder.duration},time_on_page:{foreground:this.onPageRecorder.duration,background:this.onPageBackgroundRecorder.duration}}}}const ea="not_started",ta="waiting_on_catalog",ia="proscenium",ra="wt_start_experience",sa="wt_loading",na="wt_counting",oa="wt_waiting_on_next",aa="thank_you",la="offer_completion";class da extends Go{constructor(...e){super(...e),this.currentStepIndex=0,this.webtrafficConfiguration=void 0,this.currentTrackingSession=void 0,this._state=ea,this.hasStartedWTExperience=!1,this.webTrafficDynamicUrl=void 0,this.maxWaitTimeTimer=void 0,this.delayedWT=!1,this._forwardButtonEnabled=!1,this.presenterSubscriptions.push("forwardButtonEnabled")}get state(){return this._state}set state(e){this.breadcrumb=e,this._state=e}get forwardButtonEnabled(){return this._forwardButtonEnabled}set forwardButtonEnabled(e){this._forwardButtonEnabled=e,this.presenter?.setForwardButtonEnabled(e)}async presentAdForPlacement(e,t){if(console.debug(`[WTVM] WebTrafficViewModel.presentAdForPlacement(${e.name}) to show ${t.getAdType()} offer`),this.presentationListener.onDisplayAd(this.instanceId,t.getAdType(),t.getAdString()),this.updateWebTrafficHeader(),!0!==t.skip_proscenium)return;this.state=ta;void 0!==await this.waitForTrampolineAndPresenter()&&(this.pageReadyController.onPageReadyFinished(),this.startWebTraffic(),this.onCatalogFrameSuccess())}setPresenter(e){super.setPresenter(e),!1===this.ad.skip_proscenium&&this.showProscenium()}showProscenium(){this.state===ea&&(this.state=ia,this.loadPageFromCatalogFrame())}startWebTraffic(){if(this.backgrounded)return this.delayedWT=!0,this.breadcrumb="start_webtraffic_delayed",void console.debug("[WTVM] delaying startWebTraffic until foregrounded");if(console.debug("[WTVM] startWebTraffic"),this.hasStartedWTExperience)return console.debug("[WTVM] Webtraffic Experience has already started."),void(this.breadcrumb="start_webtraffic_debounced");if(void 0!==this.presenter){if(void 0===this.webtrafficConfiguration&&(this.webtrafficConfiguration=this.catalogFrame.webtrafficSdkConfiguration(),this.progressAnalytic?.addMetaData({webtrafficSteps:this.webtrafficConfiguration?.urls?.length||-1},!0)),void 0===this.webtrafficConfiguration)return this.updateDiagnosticFlag(We.INVALID_WEBTRAFFIC_CONFIG),void console.debug("[WTVM] webtrafficConfiguration not set.  Cannot start.");this.url=void 0,this.hasStartedWTExperience=!0,this.state=ra,this.updateWebTrafficHeader(),this.sendDurationUpdateTracking(),this.fireImpressionUrls(),this.loadNextPageOfWebTraffic()}else console.debug("[WTVM] WTVM presenter not attached.  Cannot start.")}updateWebTrafficHeader(){this.state===ra&&(this.breadcrumb="show_wt_header",this.presenter.showWebTrafficHeader(this.webtrafficConfiguration.urls.length))}sendDurationUpdateTracking(){this.state===ra&&this.ad.skip_proscenium&&(this.breadcrumb="wt_viewing_duration",this.eventController.sendDurationUpdateTracking(this.catalogFrame.trampoline.token,"0",this.webtrafficConfiguration.viewing_id))}fireImpressionUrls(){this.state===ra&&this.ad.skip_proscenium&&(this.breadcrumb="wt_pixels",this.eventController.sendPixelTrackingEvents(this.catalogFrame.impressionURLs()))}loadNextPageOfWebTraffic(){this.breadcrumb={state:"next_wt_index",value:this.currentStepIndex};const{url:e,wtu_id:t}=this.webtrafficConfiguration.urls[this.currentStepIndex];this.maxWaitTimeTimer=this.timerController.startTimer(1e3*this.webtrafficConfiguration.maximum_page_load_wait_time_in_seconds,(()=>{this.webTrafficPageLoadTimeout()})),this.state=sa,this.backButtonEnabled=!1,this.forwardButtonEnabled=!1,this.presenter.loadWebTrafficPage(e,this.currentStepIndex,this.userAgent),this.breadcrumb={state:"loading_wt_page",value:e},this.eventController.sendWebTrafficVisitEvent(e,this.webtrafficConfiguration?.viewing_id,t),this.currentTrackingSession=new Qo(e),this.currentTrackingSession.startPageLoadingTimer(this.backgrounded)}executeJS(){if(this.state===na||this.state===sa||this.state===oa){this.breadcrumb="on_page_js";for(const e of this.webtrafficConfiguration.urls[this.currentStepIndex].on_page_load_js)console.debug("[WTVM] Attaching onPage JS"),this.publishASyncScriptEvent(e)}else console.debug("[WTVM] Cannot insert JS.  Not on WT Page")}didTapNext(){this.currentTrackingSession.sendTracking(),this.currentStepIndex+=1,this.loadNextPageOfWebTraffic()}didTapFinish(){this.currentTrackingSession.sendTracking(),this.finishAd()}didTapClose(){console.debug("[WTVM] didTapClose"),(this.adCompleted||this.closableWithoutDialog||void 0===this.placement.cancellationDialog)&&void 0!==this.maxWaitTimeTimer&&this.timerController.stopTimer(this.maxWaitTimeTimer),this.exitAdExperience(E.NATIVE_CLOSE_BUTTON)}finishAd(){this.ad.skip_thank_you_screen?this.state===la?(this.breadcrumb="wt_completion_debounce",console.debug("[WTVM] Debounced finish Ad Call")):(this.state=la,console.debug("[WTVM] Skipping thank you page"),this.offerCompletionRequest()):(console.debug("[WTVM] Loading thank you"),this.breadcrumb="wt_loading_thank_you",this.state=aa,this.presenter.loadThankYouPage(this.webtrafficConfiguration.completion_url))}handleJSMessageFromWebView(e){const{name:t,body:i}=e;if("startWebtraffic"===t)this.webtrafficConfiguration=JSON.parse(i),void 0!==this.webtrafficConfiguration.user_agent&&(this.userAgent=this.webtrafficConfiguration.user_agent),this.adHtml=void 0,this.startWebTraffic();else super.handleJSMessageFromWebView(e)}handlePageFinishFromWebView(e){super.handlePageFinishFromWebView(e),void 0!==this.maxWaitTimeTimer&&(this.timerController.stopTimer(this.maxWaitTimeTimer),this.maxWaitTimeTimer=void 0),this.transitionToCountdown(k.LOADED)}onWebViewHistoryChanged(e){this.backButtonEnabled=e.canNavigateBack,this.forwardButtonEnabled=e.canNavigateForward}webTrafficPageLoadTimeout(){console.debug("[WTVM] webview maximum page load wait time hit"),this.updateDiagnosticFlag(We.WT_PAGE_LOAD_TIMEOUT),this.transitionToCountdown(k.TIMED_OUT)}transitionToCountdown(e){this.breadcrumb={state:"transition_to_countdown",value:e},this.executeJS(),this.state===sa&&(this.state=na,this.presenter.startCountDownTimer(this.webtrafficConfiguration.minimum_visit_time_in_seconds),this.currentTrackingSession.stopPageLoadingTimer(e),this.currentTrackingSession.startOnPageTimer(),this.backgrounded&&this.presenter.pauseCountDownTimer())}webTrafficPageMinTimeComplete(){this.state=oa,this.currentStepIndex<this.webtrafficConfiguration.urls.length-1?this.presenter.showNextButton():(this.presenter.showFinishButton(),this.closable=!1)}async offerCompletionRequest(){console.debug("[WTVM] offerCompletionRequest");let e=!0;try{const{code:t,body:i,error:r}=await this.networkRequestController.postAsync(globalThis.COMPLETION_URL,this.getCompletionParams(),F);console.debug("[WTVM] offerCompletionRequest response received"),void 0===r&&K.validResponseStatus(t)||(console.error(`[WTVM] offerCompletionRequest error received: ${r}`),this.updateDiagnosticFlag(We.COMPLETION_ERR),this.breadcrumb={state:"webtraffic_completion_error",value:`${r}`},e=!1)}catch(t){console.error(`[WTVM] offerCompletionRequest error: ${t}`),this.updateDiagnosticFlag(We.COMPLETION_ERR),this.breadcrumb={state:"webtraffic_completion_exception",value:`${t}`},e=!1}this.skipThankYouPage(e)}skipThankYouPage(e){this.payoutComplete=e,this.adCompleted=!0,e&&(this.updateAdProgressState(C.COMPLETED),this.updateAdProgressState(C.PAYOUT_COMPLETE)),this.updateAdClosedAction(E.COMPLETE_NO_THANK_YOU),this.presenter.closeAdExperience()}getCompletionParams(){const e={};return e[R.USER_ID]=HYPRRequestParameterManager?.getUserId(),e[R.TOKEN]=this.catalogFrame?.trampoline?.token,e[R.VIEWING_ID]=this.webtrafficConfiguration?.viewing_id,e[R.REWARD_TOKEN]=this.catalogFrame?.trampoline?.reward_token,e[R.DISTRIBUTOR_ID]=HYPRRequestParameterManager?.getDistributorID(),e}restoreState(){this.breadcrumb="wt_restore_state",this.state===la||this.state===aa?this.finishAd():(this.updateAdClosedAction(E.UNKNOWN),this.presenter.closeAdExperience())}onForegroundTransition(){super.onForegroundTransition(),this.state===na&&void 0===this.browserInstance&&this.presenter.resumeCountDownTimer(),console.debug("[WTVM] TimeOnSite resuming from foreground event"),this.currentTrackingSession?.setBackGroundState(!1),this.delayedWT&&(this.delayedWT=!1,this.startWebTraffic())}onBackgroundTransition(){super.onBackgroundTransition(),this.state===na&&this.presenter.pauseCountDownTimer(),console.debug("[WTVM] TimeOnSite pausing from background event"),this.currentTrackingSession?.setBackGroundState(!0)}onModalClosed(){super.onModalClosed(),console.debug("[WTVM] Resuming TimeOnSite from Presentation"),this.currentTrackingSession?.setBackGroundState(!1)}nativeBrowserWillPresent(e){super.nativeBrowserWillPresent(e),console.debug("[WTVM] Pausing TimeOnSite for Presentation"),this.currentTrackingSession?.setBackGroundState(!0)}shouldAllowWindowOpenEvent(e){const{url:t}=e;return this.state!==ia||!this.ad.isNavigationRuleMatch(t)||(this.notifyWindowOpenURLBlock(t),!1)}onNavBarButtonTapped(e){this.userAction=`wt_footer_icon_${e?.index}_tap`,console.debug(`[WTVM] onNavBarButtonTapped: ${JSON.stringify(e)}`);const t=this.webtrafficConfiguration?.daa_url||this.ad.footer.images[e.index].image.link;this.windowOpenAttempt({url:t,navBarTap:!0})}onWebViewTermination(){let e;switch(console.error("[WTVM] Webview crashed!"),this.terminatedWebviewCount+=1,this.breadcrumb={state:"webpage_crash",value:this.currentTrackedUrl,count:this.terminatedWebviewCount,wtstate:this.state,payoutComplete:this.payoutComplete,adCompleted:this.adCompleted,closable:this.closable},this.state){case aa:e=We.THANK_YOU_PAGE_TERMINATION;break;case ia:e=We.PROSCENIUM_TERMINATION;break;default:e=We.WT_PAGE_TERMINATION}this.updateDiagnosticFlag(e);const t=this.ad?.enable_webview_reload??!1;return t?this.breadcrumb={state:"webpage_crash_reload",value:this.url}:(this.breadcrumb={state:"webpage_crash_abandon",value:this.url},console.error("[WTVM] Webview crashed."),this.state===ia?(console.error("[WTVM] Webview crashed on Proscenium. Closing ad."),this.breadcrumb={state:"wt_proscenium_crash_close_ad",value:this.url},this.updateAdClosedAction(E.WEBVIEW_CRASH),this.presenter.closeAdExperience()):this.state===aa&&(console.error("[WTVM] Webview crashed on Thank You. Closing ad."),this.breadcrumb={state:"wt_thank_you_crash_close_ad",value:this.url},this.skipThankYouPage(!0))),t}}class ca extends Go{presentAdForPlacement(e,t){console.debug(`[MRVM] PresentationController.presentAdForPlacement(${e.name}) to show ${t.getAdType()} offer`),this.presentationListener.onDisplayAd(this.instanceId,t.getAdType(),t.getAdString())}setWebViewPresenter(e){console.debug("[MRVM] mraid setWebViewPresenter."),super.setWebViewPresenter(e),this.lazyLoadCatalogFrame()}setPresenter(e){console.debug("[MRVM] mraid setPresenter."),super.setPresenter(e),void 0===this.catalogFrame?.catalogFrameError?this.pageReadyController.beginPageReadyTimer(this.computePageReadyTime()):this.onShowError(this.catalogFrame?.catalogFrameError)}getCatalogFrame(){let e;return console.debug("[MRVM] presenter status: "+typeof this.presenter),void 0===this.presenter&&void 0!==this.ad?.preload_player_url?(console.debug("[MRVM] selected preload_player_url"),e=this.ad.preload_player_url):(console.debug("[MRVM] selected catalog_frame_url"),e=this.ad?.catalog_frame_url),void 0===this.catalogFrame&&(this.catalogFrame=new Yo(e,this.placement,this.ad)),this.catalogFrame}async lazyLoadCatalogFrame(){if(void 0!==this.catalogFrame&&void 0!==this.catalogFrame?.trampoline||(console.debug("[MRVM] setting catalogFrame."),this.catalogFrame=void 0,this.catalogFrame=this.getCatalogFrame()),console.debug("[MRVM] lazyLoadCatalogFrame."),void 0===this.catalogFrame.trampoline){console.debug(`[MRVM] starting catalog frame load to url: ${this.catalogFrame?.catalogFrameUrl}`);const{pageUrl:e}=await this.catalogFrame.getWebAd(void 0===this.presenter);console.debug("[MRVM] finished catalog frame load."),void 0!==e?(console.debug("[MRVM] setPageUrl()."),this.url=e):console.debug("[MRVM] lazyLoadCatalogFrame - undefined pageUrl.")}void 0!==this.presenter&&void 0!==this.catalogFrame?.catalogFrameError&&this.onShowError(this.catalogFrame?.catalogFrameError)}onCheckMraidReady(){console.debug("[MRVM] onCheckMraidReady()")}handleJSMessageFromWebView(e){const{name:t}=e;if("pageReady"===t)console.debug("[MRVM] pageReady()."),this.pageReadyController.onPageReadyFinished(),this.presenter?.reportPowerState(),this.onCheckMraidReady();else super.handleJSMessageFromWebView(e)}shouldScrollBounce(){return!1}}class ha extends da{constructor(e,t,i,r,...s){super(...s),this.engagementTimer=void 0,this.clickEngagement=e,this.windowOpenEngagement=t,this.scrollEngagement=i,this.scrollDepth=r}startCountdownTimer(){console.debug(`[WTEVM] startCountdownTimer ${this.state}`),this.state!==na?(this.engagementTimer&&(console.debug("[WTEVM] startCountdownTimer clearing engagement timer"),this.timerController.stopTimer(this.engagementTimer),this.engagementTimer=void 0),this.state===sa&&(console.debug("[WTEVM] startCountdownTimer starting timer"),this.state=na,this.presenter.startCountDownTimer(this.webtrafficConfiguration.minimum_visit_time_in_seconds),this.backgrounded&&this.presenter.pauseCountDownTimer())):console.debug("[WTEVM] startCountdownTimer already counting")}onPageStarted({url:e}){console.debug(`[WTEVM] onPageStarted ${e}`),this.trackEngagement(this.clickEngagement,this.scrollEngagement,this.scrollDepth),super.onPageStarted({url:e})}transitionToCountdown(e){if(console.debug(`[WTEVM] transitionToCountdown ${e} state: ${this.state}`),this.breadcrumb={state:"wtengagement_transition_to_countdown",value:e},this.state===sa&&"timed_out"===e)return console.debug("[WTEVM] transitionToCountdown starting countdown because of timeout"),this.state=na,this.presenter.startCountDownTimer(this.webtrafficConfiguration.minimum_visit_time_in_seconds),this.currentTrackingSession.stopPageLoadingTimer(e),this.currentTrackingSession.startOnPageTimer(),void(this.backgrounded&&this.presenter.pauseCountDownTimer());this.executeJS(),this.currentTrackingSession.stopPageLoadingTimer(e),this.currentTrackingSession.startOnPageTimer()}shouldAllowWindowOpenEvent(e){return console.debug(`[WTEVM] shouldAllowWindowOpenEvent: ${JSON.stringify(e)}`),!0===e.navBarTap?(console.debug("[WTEVM] navBarTap for window open. Opening window."),!0):(this.windowOpenEngagement&&this.state===sa&&(console.debug(`[WTEVM] attempting to start countdown: ${this.state}`),this.startCountdownTimer()),this.setCurrentUrl(e.url),!1)}urlNavigationAttempt(e){const t=e?.url,i=t.startsWith("tel:");return console.debug(`[WTEVM] state: ${this.state}`),console.debug(`[WTEVM] urlNavigationAttempt to url ${t}`),console.debug(`[WTEVM] isNavigationRuleMatch: ${this.ad.isNavigationRuleMatch(t)}`),console.debug(`[WTEVM] isTel: ${i}`),i&&(this.windowOpenEngagement||this.clickEngagement)&&this.state===sa?(console.debug("[WTEVM] attempting to start countdown  from tel url"),this.startCountdownTimer(),super.urlNavigationAttempt(e)):this.state===ia&&this.ad.isNavigationRuleMatch(t)?(console.debug("[WTEVM] Navigation blocked by navigation rule"),this.notifyWindowOpenURLBlock(t),this.state=sa,JSON.stringify(new le(ce,t))):(console.debug("[WTEVM] Navigation deferred to base controller for decision"),super.urlNavigationAttempt(e))}handleJSMessageFromWebView(e){const{name:t,body:i}=e;let r;if(console.debug(`[WTEVM] handleJSMessageFromWebView: ${t}`),"setNativeAdConfiguration"===t){console.debug(`[WTEVM] setNativeAdConfiguration: ${i}`);try{r=JSON.parse(i).event}catch(e){console.error(`[WTEVM] Error parsing body of setNativeAdConfiguration: ${e}`)}(this.clickEngagement&&"click"===r||this.scrollEngagement&&"scroll"===r)&&this.startCountdownTimer()}else super.handleJSMessageFromWebView(e)}trackEngagement(e,t,i){if(console.debug(`[WTEVM] trackEngagement state: ${this.state}`),this.state!==sa)return void console.debug(`[WTEVM] trackEngagement not in loading state: ${this.state}`);const r=this.placement.type===oe.REWARDED?15:5;this.engagementTimer=this.timerController.startTimer(1e3*r,(()=>{console.debug("[WTEVM] transitionToCountdown timer fired"),this.startCountdownTimer()}));let s="";e&&(s+=this.getClickEngagementScript()),t&&(s+=this.getScrollEngagementScript(i)),console.debug(`[WTEVM] Running Engagement Script: ${s}`),this.publishASyncScriptEvent(s)}getClickEngagementScript(){return`\n    (function() {\n      "use strict";\n      let clickReported = false;\n      document.addEventListener('click', function() {\n        if (clickReported) { return; }; \n        console.debug("document clicked");\n        clickReported = true;\n          ${globalThis.IS_IOS?'window.webkit.messageHandlers?.["setNativeAdConfiguration"]?.postMessage(\'{"event":"click"}\');':'AndroidOfferViewerJavascriptInterface?.setNativeAdConfiguration(\'{"event":"click"}\');'}\n        });\n      })();\n      `}getScrollEngagementScript(e){return`\n      (function() {\n        "use strict";\n        let scrollReported = false;\n        document.addEventListener('scroll', function() {\n          if (scrollReported) { return; };\n          console.debug("scrolled: " + window.scrollY);\n          if (window.scrollY > ${e}) {\n            console.debug("scroll depth reached");\n            scrollReported = true;\n            console.debug("scroll depth reported");\n          ${globalThis.IS_IOS?'window.webkit.messageHandlers?.["setNativeAdConfiguration"]?.postMessage(\'{"event":"scroll"}\');':'AndroidOfferViewerJavascriptInterface?.setNativeAdConfiguration(\'{"event":"scroll"}\');'}\n          }\n        });\n      })();  \n      `}}function ua(e,t,i,r){K.validResponseStatus(t)&&void 0===r?console.debug(`[BVM] ${e} Attempt completed with body: ${i}`):console.debug(`[BVM] ${e} Attempt completed with status code ${t} and with error: ${r}`)}function pa(e,t,i){i.get(t,((t,i,r)=>{ua(e,t,i,r)}))}function ga(e){return(t,i)=>{if(n(t))return void ua("ClickThrough",400,void 0,"No ClickThrough URL found.");if(!t.includes(Ro))return void ua("ClickThrough",400,void 0,"No replacement token found on ClickThrough URL.");const r=t.replace(Ro,encodeURIComponent(i));e.get(r,((e,t,i)=>{ua("ClickReporting",e,t,i)}))}}function ma(e){return ga(e)}class fa{static viewModel(e,t,i,r,s,n,o=ma){const a=new Xo(globalThis.HYPRTimerController),l={"Click below to start the timer":{clickEngagement:!1,windowOpenEngagement:!0,scrollEngagement:!1,scrollDepth:0},"Click below to finish faster":{clickEngagement:!0,windowOpenEngagement:!0,scrollEngagement:!1,scrollDepth:0},"Scroll the page to start the timer":{clickEngagement:!1,windowOpenEngagement:!1,scrollEngagement:!0,scrollDepth:250},"Engage with the content to start the timer":{clickEngagement:!0,windowOpenEngagement:!0,scrollEngagement:!0,scrollDepth:250}};switch(t){case g:if(s?.title in l){const{clickEngagement:t,windowOpenEngagement:d,scrollEngagement:c,scrollDepth:h}=l[s?.title];return new ha(t,d,c,h,r,a,o,s,e,n,i)}return new da(r,a,o,s,e,n,i);case p:return new ca(r,a,o,s,e,n,i);default:return new Go(r,a,o,s,e,n,i)}}}class ba{constructor(e=globalThis.HYPRAudioEventPublisherNative){this.listener=e,this.currentAudioStreams=0}audioStarted(){this.currentAudioStreams+=1,console.debug(`[AEP] audioStarted with ${this.currentAudioStreams} streams`),1===this.currentAudioStreams&&(console.debug("[AEP] calling onAudioStart native"),this.listener.onAudioStart())}audioEnded(){this.currentAudioStreams-=1,console.debug(`[AEP] audioEnded with ${this.currentAudioStreams} streams`),0===this.currentAudioStreams&&(console.debug("[AEP] calling onAudioEnd native"),this.listener.onAudioEnd())}}class _a{constructor(e,t=globalThis.HYPRNativeAudioListener){this.isActive=!1,this.muteCheckRate=e,this.listener=t,this.observers=[]}activate(e){this.isActive=e,this.listener.setActive(this.isActive,this.muteCheckRate)}addObserver(e){this.observers.push(e)}removeObserver(e){this.observers=this.observers.filter((t=>t!==e))}onVolumeChange(e,t=new ke){console.debug(`[ASM] New volume value: ${e}`),this.observers.forEach((i=>t.execute(e,i)))}onMuteChange(e,t=new xe){this.observers.forEach((i=>t.execute(e,i)))}onAudioCategoryChange(e,t=new Ne){console.debug(`[ASM] New audio category: ${e}`),this.observers.forEach((i=>t.execute(e,i)))}}function va(){return void 0===globalThis.HYPRAudioStatusManager&&(globalThis.HYPRAudioStatusManager=new _a(1,globalThis.HYPRNativeAudioListener)),void 0===globalThis.HYPRAudioEventPublisher&&(globalThis.HYPRAudioEventPublisher=new ba(globalThis.HYPRAudioEventPublisherNative)),{audioStatusManager:globalThis.HYPRAudioStatusManager,audioEventPublisher:globalThis.HYPRAudioEventPublisher}}class wa{constructor(e,t,i,r,s=globalThis.HYPREventController){this.placement=e,this.nativeListener=r,this.eventController=s,this.setInfo(t),this.uiComponents=globalThis.defaultUIComponents||{},this.setUiComponents(i)}setInfo(e=[]){this.info=e}setUiComponents(e){void 0!==e&&(this.uiComponents=e)}hasQuestions(){return this.info.length>0}count(){return this.info.length}presentRequiredInfo(){const e=JSON.stringify(this.info);this.setInfo(),console.debug(`PresentationController.showFullscreenAd(${this.placement.name}) showing ReqInfo`),this.eventController.sendUserInfoTrackingEvent(this.placement,e,this.placement.ad),this.nativeListener.showRequiredInfo(e,JSON.stringify(this.uiComponents))}async reloadPlacement(e){console.debug("[Presentation][RIVM] start placement reload");const t=So.deepCopy(this.placement);console.debug("[Presentation][RIVM] copied placement");const{success:i,error:r}=await t.loadAd(e);if(console.debug(`[Presentation][RIVM] reloaded with success = ${i}`),console.debug("[Presentation][RIVM] reload network request completed"),void 0!==r)return void console.debug(`[Presentation][RIVM] Error received on loading Ad: ${r}`);const{ad:s,requiredInfo:n,uiComponents:o}=t.popAdData();return this.setInfo(n),this.setUiComponents(o),console.debug("[Presentation][RIVM] prequal state updated"),s}}class ya{constructor(e,t,i=globalThis.HYPREventController){this.placement=e,this.impressionFired=!1,this.eventController=i;const{ad:r,requiredInfo:s,uiComponents:n}=e?.popAdData?.apply(e)||{};this.ad=r,this.requiredInfoViewModel=new wa(e,s,n,t)}questionCount(){return this.requiredInfoViewModel.count()}isSession(e){return this.getPlacementName()===e}isValid(){return void 0!==this.placement&&this.placement instanceof ni}getPlacementName(){return this.placement?.name}getAdType(){return this.ad?.getAdType()||""}getAdRewardText(){return this.ad?.getAdRewardText()||""}getAdRewardQuantity(){return this.ad?.getAdRewardQuantity()||0}isRewarded(){return"rewarded"===this.placement?.type}fireImpressionOnce(){!this.impressionFired&&(void 0!==this.ad||this.questionCount()>0)&&(this.placement.adImpression(),this.eventController.sendAdImpressionTrackingEvent(this.placement,this.ad),this.impressionFired=!0)}async performReload(e){this.ad=await this.requiredInfoViewModel.reloadPlacement(e)}presentRequiredInfo(){this.requiredInfoViewModel.presentRequiredInfo()}showViewModel(e){this.instanceId=e.instanceId,e.beginFullScreenPresentation(this.ad)}}function Pa(e){return(t,i)=>{console.debug(`[BE] Impression Attempt for placement: ${i} with url: ${t}`),n(t)?ua("Impression",400,void 0,"No impression URL found."):pa("Impression",t,e)}}function Aa(e){return(t,i)=>{console.debug(`[BE] Win Attempt for placement: ${i} with url: ${t}`),n(t)?ua("Win",400,void 0,"No Win URL found."):pa("Win",t,e)}}function Sa(e){return ga(e)}function Ta(e){return t=>{if(!n(t))return new ko(t,e)}}const Ca="PresentationController already locked by";class Ea{constructor(e={},t=globalThis.HYPREventController,i=HYPRPresentationListener,r=globalThis.preloadController,s=globalThis.HYPRPlacementController,n=Zo){this.args=e,this.listener=i,this.eventController=t,this.preloadController=r,this.placementController=s,this.initConfiguration=globalThis.initializationController?.getConfiguration(),this.vmController=n,this.presentedSession=void 0}getFullscreenViewModel(e,t=void 0){let i,r;try{i=t||this.presentedSession.getAdType(),console.debug(`[Presentation] retreiving viewModel for placement: ${e}, ad type: ${i}`),r=this.vmController.getFullScreenViewModelForPlacementName(e)}catch(e){const t=`Error accessing viewModelMap: ${e}\nCurrent Contents: ${this.vmController.toContentString()}`,i="shared_js.PresentationController.getFullscreenViewModel";console.error(t),Bo({message:t,type:i})}if(void 0!==r)return r;const s=this.placementController.getPlacement(e);if(void 0===s)return;this.args.title=this.presentedSession?.ad?.title;const n=this.vmController.generateUniqueId();return r=fa.viewModel(s,i,n,this.listener,this.args,this),this.vmController.storeViewModel(n,r),r}getPreloadedViewModel(e){try{return this.vmController.getViewModel(e)}catch(t){return void console.error(`Error getting preloaded ViewModel: ${e} error: ${t}`)}}removePreloadedViewModel(e){e!==this.presentedSession?.instanceId?(console.debug(`[PresentationControler] removing instance from map: ${e}`),this.vmController.removeViewModel(e)):console.error("Error - trying to remove a ViewModel being presented")}showFullscreenAd(e){if(console.debug(`[Presentation] request to show for ${e}`),lo.canPrompt(this.initConfiguration)){console.debug("PresentationController will prompt for TransparencyTracking approval");try{return void lo.prompt(`HYPRPresentationController.showFullscreenAd('${e}')`)}catch(t){console.error(`PresentationController.showFullscreenAd(${e}) error displaying prompt.`)}}const t=this.placementController.getPlacement(e),i=new ya(t,this.listener);i.isValid()?this.isPresentationLocked()?this.listener.adDisplayError(e,`PresentationController already showing ad for placement ${e}.`):this.beginPresentation(i):this.adFailedToDisplay(e,"Placement not a valid fullscreen Ad.")}beginPresentation(e){console.debug(`[Presentation] transition to beginPresentation to lock display ${e.getPlacementName()}`);try{this.lockPresentationWithSession(e)}catch(t){return this.adFailedToDisplay(e.getPlacementName(),`SDK reported presentation error: ${t.message}`),void(t.message.includes(Ca)||this.endPresentation(!1))}this.presentedSession.fireImpressionOnce(),this.onDisplayQuestions()}onDisplayQuestions(){if(!this.presentedSession)return console.error("[Presentation] Error presenting questions, no session"),void this.endPresentation(!1);console.debug(`[Presentation] transition to onDisplayQuestions with ${this.presentedSession.questionCount()} questions to show`),this.presentedSession.questionCount()>0?this.presentedSession.presentRequiredInfo():this.onDisplayAd()}onDisplayAd(){if(!this.presentedSession)return console.error("[Presentation] Error presenting ad, no session"),void this.endPresentation(!1);console.debug(`[Presentation] transition to onDisplayAd for placement ${this.presentedSession.getPlacementName()}`);const e=this.getFullscreenViewModel(this.presentedSession.getPlacementName());this.presentedSession.showViewModel(e)}endPresentation(e){if("object"!=typeof this.presentedSession)return void console.debug("[Presentation] endPresentation called without a presentedSession (see PLAYER-15335)");const t=this.presentedSession.getPlacementName();console.debug(`[Presentation] transition endPresentation for placement ${t}`),this.placementController.startAdRefresh("refresh"),console.debug(`[Presentation] will remove viewModel instance: ${this.presentedSession.instanceId}`),this.clearFullscreenViewModel(this.presentedSession.instanceId),this.presentedSession=void 0,e?this.listener.adFinished(t):this.listener.adCanceled(t)}clearFullscreenViewModel(e){this.vmController.removeViewModel(e)}lockPresentationWithSession(e){const t=e.getPlacementName();if(this.isPresentationLockedWithAnotherPlacement(t))throw new Error(`${Ca} ${this.presentedSession.getPlacementName()}`);this.placementController.getPlacement(t).stopAdAvailableTimer(),this.isPresentationLocked()||(console.debug(`[Presentation] PresentationController.lockPresentationWithPlacement(${t})`),this.listener.adStarted(t),this.presentedSession=e)}adFailedToDisplay(e,t){console.debug(t),this.presentedSession=void 0,this.listener.adStarted(e),this.listener.adDisplayError(e,t),this.listener.adFinished(e)}isPresentationLockedWithAnotherPlacement(e){return void 0!==this.presentedSession&&!this.presentedSession.isSession(e)}isPresentationLocked(){return void 0!==this.presentedSession}bindBannerViewModel(e){let t=this.placementController.getPlacement(e);"object"==typeof t&&t.isBannerAdType()||(console.error(`error binding Banner for placement: ${e}`),t=void 0);const i=this.vmController.generateUniqueId(),r=new Jo(va(),Pa,Sa,Ta,Aa,t,this,i);return this.vmController.storeViewModel(i,r),i}initializeBrowserViewModel(e,t,i,r){let s,n;const o=i.getAdModel();void 0!==o&&(s=o.getClickMode(),n=o.onPageJS);const a=this.vmController.generateUniqueId();console.debug(`Initialize BrowserViewModel for requester ${e} creating vm ${a}`);const l=i.generateTimeOnSiteTracking(),d=new rt(t.initialUrl,s,n,i,l,r,this,a);return this.vmController.storeViewModel(a,d),i.browserInstance=d,a}destroyBrowserViewModel(e){this.vmController.removeViewModel(e)}async requiredInfoPresentationCompletedWithParams(e){console.debug("[Presentation] Prequal form finished with questions answered"),e.context="userInfoSubmission",await this.presentedSession.performReload(e),console.debug("[Presentation] Reload of placement completed"),this.onDisplayQuestions()}requiredInfoPresentationCancelled(){console.debug("[Presentation] Prequal form was cancelled"),this.onDisplayQuestions()}adDismissed(e){console.debug(`[Presentation] adDismissed(${e})`),this.endPresentation(e)}adRewarded(){this.presentedSession.isRewarded()&&(console.debug(`Ad Rewarded for ${this.presentedSession.getPlacementName()}`),this.listener.adRewarded(this.presentedSession.getPlacementName(),this.presentedSession.getAdRewardText(),this.presentedSession.getAdRewardQuantity()))}presentationSceneBackgrounded(){this.isPresentationLocked()&&console.debug(`Ad Window backgrounded for ${this.presentedSession.getPlacementName()}`)}presentationSceneForegrounded(){this.isPresentationLocked()&&console.debug(`Ad Window foregrounded for ${this.presentedSession.getPlacementName()}`)}preloadedWebViewPageReadyExpired(e){this.preloadController.clearMraidPreload(e)}static attributesForWebtrafficText(e){return e===_||e===v?JSON.stringify({Color:"FFFFFFFF",Font:{fontName:"Helvetica Neue",size:13.33},NSKern:0,NSParagraphStyle:{alignment:"left"},NSStrokeWidth:0}):e===w?JSON.stringify({Color:"3A3A3AFF",Font:{fontName:"Helvetica Neue",size:13.33},NSKern:0,NSParagraphStyle:{alignment:"left"},NSStrokeWidth:0}):e===y?JSON.stringify({Color:"5D5D5DFF",Font:{fontName:"HelveticaNeue-Bold",size:18.67},NSKern:0,NSParagraphStyle:{alignment:"left",minimumLineHeight:17},NSStrokeWidth:0}):"{}"}}globalThis.PresentationController=Ea;class Ra{constructor(e){this.version=Ra.osVersion(e.device_os_version),this.platform=Ra.devicePlatform(e.device_type),this.orientations=Ra.supportedInterfaceSettings(e.supported_interface_settings),this.sdkVersion=e.sdk_version||"0",this.msdkv=e.msdkv}isIos(){return"iOS"===this.platform}isAndroid(){return"Android"===this.platform}isPortraitSupported(){return this.version>=14||this.orientations.indexOf("portrait")>-1}static osVersion(e){return void 0===e||-1===e.indexOf(".")?0:parseFloat(e.match(/[0-9]*.[0-9]*/)[0])}static devicePlatform(e){return void 0===e?"unknown":e.includes("iP")||e.toLowerCase().includes("mac")?"iOS":e.toLowerCase().includes("android")?"Android":"unknown"}static supportedInterfaceSettings(e){const t=[];return void 0===e||e.forEach((e=>{const i=e.split("UIInterfaceOrientation")[1];void 0!==i&&t.push(i.toLowerCase())})),t}}class ka{constructor(e){return console.debug("[IC] Returning pre-initialized InitController"),void 0!==e&&(globalThis.initializationController.host=e),globalThis.initializationController}}globalThis.InitializationController=ka;class xa{constructor(e){console.debug("[IC] Initializing"),this._host=e,this.initialized=!1,this.configuration=void 0,this.deviceConfiguration=void 0,this.failureCount=0}get host(){const e=HYPRRequestParamListener.isTestModeEnabled?.()??!1?"test-":"";if(this._host)return`${e}${this._host}`;const t=this.deviceConfiguration?.platform?.toLowerCase(),i=this.deviceConfiguration?.msdkv;return`${e}${`marketplace-${t}-b${i}.hyprmx.com`}`}set host(e){this._host=e}get initializationURL(){return e=this.host,re.test(e)?`${this.host}/v1/initialization`:`https://${this.host}/v1/initialization`;var e}initFromNative(e,t){console.debug(`[IC] Initializing from native ${t}`),void 0!==e&&(this.host=e),this.failureCount=t,this.initialize()}initialize(e={},t=globalThis.HYPRNetworkController,i=globalThis.preloadController,r=HYPRRequestParameterManager){!function(e,t,i,r=500,s=globalThis.HYPRTimerController){const n=function(e,t){return 0===e?0:t*2**(e-1)}(i,r);console.warn(`[BM] ${e} has been delayed ${n} millis.`),0!==n?s.startTimer(n,(async()=>{t()})):t()}("networkRequestController.initialize",(()=>{console.debug("[IC] Attempting to initialize"),this.init(e,t,i,r)}),this.failureCount)}init(e={},t=globalThis.HYPRNetworkController,i=globalThis.preloadController,r=HYPRRequestParameterManager){this.preloadController=i,this.networkRequestController=t,this.requestParameterManager=r,this.initialized=!1,this.configuration=void 0,this.requestParameterManager.setPreloadController(this.preloadController);const s=this.requestParameterManager.getInitializationParams();this.deviceConfiguration=new Ra(s),globalThis.IS_IOS=this.deviceConfiguration.isIos();const n=JSON.parse(hyprMXLocalStorage.getItem(u)),o=hyprMXLocalStorage.getItem(h);console.debug(`oldPersistentId: ${o}`),console.debug(`oldOptedOut: ${n}`),(void 0!==s[u]&&null!=n&&n!==s[u]||void 0!==s[h]&&null!=o&&o!==s[h])&&(console.debug("Persistent Id reset detected"),s.reset_user_data=!0),this.networkRequestController.post(this.initializationURL,s,((e,t,i)=>{this.response(e,t,i,(()=>{void 0!==s[u]&&hyprMXLocalStorage.setItem(u,s[u].toString()),void 0!==s[h]&&hyprMXLocalStorage.setItem(h,s[h].toString())}))}))}response(e,t,i,r=(()=>{})){const s=se.parseJSON(t);if(K.validResponseStatus(e)&&void 0===i&&this.validateResponse(s)){if(r(),this.configuration={...Me,...s},void 0!==HYPRInitListener.setEnableAllLogs&&Ve("enable_all_logs",this.configuration)&&HYPRInitListener.setEnableAllLogs(!0),n=s.error_reporting_endpoint,o=s.error_severity_level,Do=n,Fo=o,this.updateDefaultUIComponents(s.ui_components),function(e){Oe=new Ie(e)}(s),void 0!==s.new_mobile_js)this.updateJavascript(s);else{this.initializeNativeControllers(s),Ko.checkStoredData();const e=qe.restore();void 0!==e&&(console.debug("Restored ad progress analytic"),e.report())}if(void 0!==s.open_measurement){const e=s.open_measurement;HYPRInitListener.initializeOMSDK(e.omsdk_url,e.partner_name,e.api_version)}void 0!==s.app_user_token&&(mo.APP_USER_TOKEN=s.app_user_token)}else this.initialized=!1,console.error(`Initialization Failed Response: ${t} code ${e} error: ${i}`),HYPRInitListener.initializationFailed(`${e}`);var n,o}validateResponse(e){return void 0!==e&&se.hasRequiredKeys(e,["sharing_endpoint","completion_endpoint","ad_impression_tracking_endpoint","user_info_tracking_endpoint","duration_update_endpoint","error_reporting_endpoint","webtraffic_visit_endpoint","no_ad_tracking_endpoint","ad_progress_endpoint"],"url")&&se.hasRequiredKeys(e,["placements"],"object")}javascriptUpgradeFailed(e){this.initializeNativeControllers(this.configuration)}initializeNativeControllers(e){this.initialized=!0;const t=JSON.stringify(e.placements);var i;globalThis.COMPLETION_URL=e.completion_endpoint,globalThis.BASE_RTB_REQUEST=e.base_rtb_request,void 0!==e.available_for&&(globalThis.AVAILABLE_FOR=e.available_for),globalThis.OMIDPN=e.open_measurement?.partner_name,globalThis.OMIDPV=e.open_measurement?.api_version,wo((()=>{globalThis.OMIDPN=void 0,globalThis.OMIDPV=void 0})),(i=this.networkRequestController,e=>{0!==e.length?i.get(e,((t,i,r,s)=>{console.debug(`[DPF] responded with ${t} and response: ${i}`),K.validResponseStatus(t)&&void 0===r?(console.debug(`[DPF] Requesting ad display for ${e} completed with response.`),globalThis.PLAYER_AD_DISPLAY_TEMPLATE=i):console.debug(`[DPF] Requesting ad display for ${e} failed with error: ${r}`)})):console.debug("[DPF] Requesting ad display url is blank.  Template not downloaded.")})(Oe.playerAdDisplayIndex),So.BASE_RTB_REQUEST=e.base_rtb_request,void 0!==e.banner_html_wrapper_tag&&(Lo.wrapperHtml=e.banner_html_wrapper_tag),this.createEventController(e),globalThis.HYPRStorePresentationController=new be(this.deviceConfiguration,e.skadnetwork_signature_endpoint),globalThis.HYPRPlacementController=new To(e.placements),globalThis.HYPRPresentationController=new Ea({userId:this.requestParameterManager.getUserId()}),globalThis.preloadController.setPresentationController(globalThis.HYPRPresentationController);const{audioStatusManager:r}=va();r?.activate(!0),HYPRInitListener.initializationSuccessWithPlacements(t,globalThis.version()),this.preloadController.handleUIComponentsToPreloadResponse(e.ui_components)}createEventController(e){globalThis.HYPREventController=new ne(e.ad_impression_tracking_endpoint,e.user_info_tracking_endpoint,e.webtraffic_visit_endpoint,e.error_reporting_endpoint,e.error_severity_level,e.no_ad_tracking_endpoint,e.ad_progress_endpoint,e.duration_update_endpoint)}updateJavascript(e){let t=8;void 0!==e.new_mobile_js.timeout&&(t=e.new_mobile_js.timeout),HYPRInitListener.updateJavascript(e.new_mobile_js.url,e.new_mobile_js.version,t)}isInitialized(){return this.initialized}allowsInitialization(){return"object"!=typeof HYPRPresentationController||!HYPRPresentationController.isPresentationLocked()}requestInitializationAllowed(e={}){const t=this.allowsInitialization();return HYPRInitListener.initializationIsAllowed?.(this.allowsInitialization(),JSON.stringify(e)),t}getConfiguration(){return this.configuration}updateDefaultUIComponents(e){void 0!==e&&"object"==typeof JSON.parse(JSON.stringify(e))&&(globalThis.defaultUIComponents=e)}}const Na="IABConsent_CMPPresent",Oa="IABConsent_SubjectToGDPR",Ia="IABConsent_ConsentString",Ma="IABConsent_ParsedPurposeConsents",Va="IABConsent_ParsedVendorConsents",Da=[Na,Oa,Ia,Ma,Va];class Fa{constructor(e,t){if(void 0!==globalThis.consentController)return globalThis.consentController;this._sharedDataController=t,this._nativeConsentController=e}get sharedDataController(){return void 0===this._sharedDataController&&void 0!==globalThis.HYPRSharedDataController&&(this._sharedDataController=HYPRSharedDataController),this._sharedDataController}get nativeConsentController(){return void 0===this._nativeConsentController&&void 0!==globalThis.HYPRNativeConsentController&&(this._nativeConsentController=HYPRNativeConsentController),this._nativeConsentController}setConsentChangedListener(e){this.consentListener=e,this.consentStatus=this.nativeConsentController?.getConsentStatus?.();for(const e of Da)this.sharedDataController?.monitorSharedValue?.("HYPRConsentController",e)}consentStatusChanged(e){this.consentStatus!==e?(this.consentStatus=e,console.debug(`[CC] Consent status changed to ${Object.keys(T)[e]}`),void 0!==this.consentListener&&this.consentListener.onConsentChanged()):console.debug("[CC] Consent status has not changed.  Ignoring.")}onValueChanged(e){console.debug(`[CC] Monitored consent string ${e.key} changed to ${e.value}`),void 0!==this.consentListener&&this.consentListener.onConsentChanged()}getConsentParameters(){const e={},t=this.nativeConsentController?.getConsentStatus?.();t!==T.CONSENT_STATUS_UNKNOWN&&(e.is_consent_given=t===T.CONSENT_GIVEN);const i=JSON.parse(this.sharedDataController?.getSharedValue?.(Na)).value;void 0!==i&&(e.iab_consent_cmppresent=i);const r=JSON.parse(this.sharedDataController?.getSharedValue?.(Oa)).value;void 0!==r&&(e.iab_consent_subject_to_gdpr=r);const s=JSON.parse(this.sharedDataController?.getSharedValue?.(Ia)).value;void 0!==s&&(e.iab_consent_string=s);const n=JSON.parse(this.sharedDataController?.getSharedValue?.(Ma)).value;void 0!==n&&(e.iab_consent_parsed_purpose_consents=n);const o=JSON.parse(this.sharedDataController?.getSharedValue?.(Va)).value;return void 0!==o&&(e.iab_consent_parsed_vendor_consents=o),console.debug(`[CC] ${JSON.stringify(e)}`),e}}globalThis.ConsentController=Fa;class Ba{constructor(e,t,i){this.timerId=t,this.callback=i,this.setExpirationDate(e)}setExpirationDate(e){const t=1e3*e;this.expirationDate=new Date((new Date).getTime()+t)}timeLeft(){const e=this.expirationDate-new Date;return e<=0?0:e/1e3}}class Ua{constructor(){this.timerMap=new Map,this.requestId=0}startTimer(e,t){const i=this.requestId.toString();this.requestId+=1,HYPRNativeTimer.startNativeTimer(i,e,`HYPRTimerController.timeoutComplete('${i}')`);const r=new Ba(e,i,t);return this.timerMap.set(i,r),i}updateTimeRemaining(e,t){HYPRNativeTimer.updateTimer(e,t);this.timerMap.get(e).setExpirationDate(t)}getTimeLeft(e){if(!this.timerMap.has(e))return;return this.timerMap.get(e).timeLeft()}stopTimer(e){HYPRNativeTimer.stopTimer(e),this.timerMap.delete(e)}timeoutComplete(e){console.debug(`Timeout complete for id ${e}`);const t=this.timerMap.get(e),i=t?.callback;this.timerMap.delete(e),"function"==typeof i&&i()}}globalThis.TimerController=Ua;const $a={mraidPreloadMap:new Map,receivedPreloadRequest(e){console.debug(`[PreloadController] receivedPreloadRequest: ${e.name}`);const t=e.ad?.webview_timeout,i=e.name;let r;try{let t=this.presentationController.getFullscreenViewModel(i,p);console.debug(`[PreloadController] found viewModel: ${t?.instanceId}`),t.getAdModel()?.reward_token!==e.ad?.reward_token&&(console.debug(`[PreloadController] viewModel offer id's do not match: ${t?.instanceId}`),this.removePreload(r),t=this.presentationController.getFullscreenViewModel(i,p)),r=t?.instanceId}catch(e){return void console.error(`[PreloadController] caught error getting viewModel instance: ${e}`)}console.debug(`[PreloadController] setting up preload for instance: ${r}`);const s=this.setupTimer(r,t);console.debug(`[PreloadController] storing timerId: ${s} for instance:${r} `),this.mraidPreloadMap.set(r,s),this.storeNativePreload(r)},setupTimer(e,t){const i=1e3*t;if(this.mraidPreloadMap.has(e)){const t=this.mraidPreloadMap.get(e);return console.debug(`[PreloadController] storing timerId: ${t}`),this.timerController.updateTimeRemaining(t,i),this.mraidPreloadMap.get(e)}const r=this.timerController.startTimer(i,(()=>{console.debug(`[PreloadController] preload ttl timer ended for instance:${e} `),this.removeNativePreload(e)}));return console.debug(`[PreloadController] created new timerId: ${r}`),r},removePreload(e){console.debug(`[PreloadController] will remove preload for instance: ${e} `);try{this.presentationController.removePreloadedViewModel(e)}catch(e){console.error(`[PreloadController] caught error releasing viewModel instance: ${e}`)}if(this.mraidPreloadMap.has(e)){console.debug(`[PreloadController] removing instance:${e} from timer map`);const t=this.mraidPreloadMap.get(e);void 0!==t?this.timerController.stopTimer(t):console.error("[PreloadController] Could not find timer id in preloaded map."),this.mraidPreloadMap.delete(e)}},getPreloadedMraidAds(){const e=[];return this.mraidPreloadMap.forEach(((t,i)=>{const r=this.timerController.getTimeLeft(t),s=this.presentationController.getPreloadedViewModel(i),n={ad_id:s?.getAdModel()?.id,placement_id:s?.placement.id,time_to_expiration:r};e.push(n)})),e}};class La{constructor(e=0,t=0,i=globalThis.HYPRCacheListener,r=globalThis.HYPRTimerController,s=globalThis.HYPRRequestParamListener){if(void 0!==globalThis.preloadController)return globalThis.preloadController;this._nativeCacheListener=i,this.presentationController=void 0,this.timerController=r,this.mraidPreloadMap=new Map,this._nativeParams=s}get nativeParams(){return void 0===this._nativeParams&&(this._nativeParams=globalThis.HYPRRequestParamListener),this._nativeParams}get nativeCacheListener(){return void 0===this._nativeCacheListener&&(this._nativeCacheListener=globalThis.HYPRCacheListener),this._nativeCacheListener}get width(){return this.nativeParams?.getDeviceWidth()}get height(){return this.nativeParams?.getDeviceHeight()}setPresentationController(e){this.presentationController=e}handleUIComponentsToPreloadResponse(e){void 0!==e&&void 0!==this.nativeCacheListener&&this.preloadImages(e)}preloadImages(e){if(void 0===e||void 0===this.nativeCacheListener)return;for(const t in e)if(e.hasOwnProperty(t))if("image"!==t&&"submit_button_image"!==t&&"close_button_image"!==t||e[t]instanceof Array)"object"==typeof e[t]&&this.preloadImages(e[t]);else{const i=e[t];i.hasOwnProperty("portrait_url")?(console.debug(`Requesting image to preload for (url = ${i.portrait_url}, height=${i.height}, width=${i.width}, fill_screen_width=${i.fill_screen_width})`),this.nativeCacheListener.preloadPortraitImage(i.portrait_url,i.height,i.width,i.fill_screen_width)):i.hasOwnProperty("url")&&(console.debug(`Requesting image to preload for (url = ${i.url}, height=${i.height}, width=${i.width}, scale=${i.scale}, tiled=${i.tiled}, x=${i.x}, y=${i.y})`),this.nativeCacheListener.preloadUIImage(i.url,i.height,i.width,i.scale,i.tiled,i.x,i.y))}}handleMraidAdToPreload(e){void 0!==e&&void 0!==this.nativeCacheListener&&"mraid"===e.getAdType()&&void 0!==e.ad.preload_player_url&&"number"==typeof e.ad.webview_timeout&&(e.ad.webview_timeout<1?this.removeNativePreload(e):this.receivedPreloadRequest(e))}storeNativePreload(e){console.debug(`[PreloadController] requesting native storage for: ${e}`),this.nativeCacheListener.storeInstance(e)}removeNativePreload(e){console.debug(`[PreloadController] requesting native to remove storage for: ${e}`),this.nativeCacheListener.removeInstance(e)}nativePreloadDidRemove(e){console.debug(`[PreloadController] notified: ${e} was removed by native`),this.removePreload(e)}}Object.assign(La.prototype,$a),globalThis.PreloadController=La,globalThis.HYPRNetworkController=new K,globalThis.HYPRTimerController=new Ua,globalThis.dispatchCEC=Bo,globalThis.consentController=new Fa,globalThis.HYPRConsentController=globalThis.consentController,globalThis.callAsync=function(e,t,i=globalThis,r=[],s=((...e)=>{globalThis.NativeContinuationController.resume(...e)}),n=((...e)=>{globalThis.NativeContinuationController.resumeWithError(...e)})){console.debug(`[CC] starting async task ${e}...`),(async()=>i[t].apply(i,r))().then((t=>{console.debug(`[CC] successfully completed task ${e}`),s(e,"object"!=typeof t?t:JSON.stringify(t))})).catch((t=>{console.debug(`[CC] async task ${e} error: ${t}`),n(e,t)}))},globalThis.initializationController=new xa,globalThis.HYPRInitializationController=globalThis.initializationController,globalThis.preloadController=new La,globalThis.HYPRPreloadController=globalThis.preloadController,e.AD_CLOSED_ACTION=E,e.AD_CLOSED_ACTION_KEY="action",e.AD_PROGRESS_STATE=C,e.APPSTORE_URL_FALLBACK_PRESENT_BROWSER=!0,e.BANNER_OFFER=m,e.CONSENT_STATUS=T,e.ConsentController=Fa,e.DISPLAY_OFFER=f,e.HYPR_BANNER_ENCODING=S,e.HYPR_BANNER_MIME_TYPE=A,e.HYPR_COUNTDOWN_TEXT_KEY=y,e.HYPR_DEFAULT_ACCEPTABLE_BANNER_SIZE_VARIANCE=1,e.HYPR_FINISH_BUTTON_TEXT_KEY=v,e.HYPR_NEXT_BUTTON_TEXT_KEY=_,e.HYPR_TITLE_TEXT_KEY=w,e.HYPR_WEB_VIEW_PROTOCOLS=P,e.InitController=xa,e.InitializationController=ka,e.KEYS=R,e.MRAID_OFFER=p,e.OptedOutKey=u,e.PAGE_LOADING_STATE=k,e.PLACEMENT_TYPE=oe,e.PersistentIdKey=h,e.Placement=ae,e.PlacementController=To,e.PreloadController=La,e.PresentationController=Ea,e.RequestParameterManager=mo,e.SKAdNetworkItemsKey="SKAdNetworkItems",e.TimerController=Ua,e.VIEW_MODEL_PREFIX={BASE:"HyprMXAd",WEBVIEW:"HyprMXWebView",BROWSER:"HyprMXBrowser"},e.VPAID_OFFER=b,e.WEB_TRAFFIC_OFFER=g,e.addToArray=function(e,t){void 0!==t&&(Array.isArray(t)?e.push(...t):e.push(t))},e.cdnDomain=i,e.deepClone=l,e.defaultAdAvailableFor=s,e.defaultWebViewReleaseSeconds=0,e.dispatch=function(e,t,i){t.apply(e,i)},e.equalsIgnoreCase=o,e.initializationPath=r,e.isNullOrEmpty=n,e.isObject=d,e.isValidUrl=a,e.mergeDeep=c,e.numberOrZero=function(e){const t=parseFloat(e);return Number.isNaN(t)?0:t},Object.defineProperty(e,"__esModule",{value:!0})}));
